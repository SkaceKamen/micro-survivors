function microSurvivors(I=document.body,c=400,s=400){let L=["WASD to move","Mouse to aim","Survive","Kill end boss"],o=c/2,p=s/2,{floor:n,ceil:C,random:_,round:Q,cos:q,sin:F,min:Z,hypot:m,abs:z,atan2:U,PI:J,max:ee,tan:ae}=Math,i=2*J;var e="Press ENTER to ";let W=e+"restart",r="center",l="top",h="left",B="right",M="middle",g="#fff",N="#aaa",K="#ccc",t="#faa",Y="#0ac",d="#999",re=.3,te=new AudioContext,v=(e=1,a=.05,r=220,t=0,s=0,n=.1,d=0,B=1,o=0,p=0,l=0,i=0,c=0,M=0,m=0,N=0,h=0,g=1,v=0,u=0,f=0)=>{let R=2*J,k=44100,K=o*=500*R/k/k,w=r*=(1-a+2*a*_(a=[]))*R/k,b=0,Y=0,x=0,S=1,G=0,H=0,D=0,A=f<0?-1:1,y=R*A*f*2/k,P=q(y),E=F,O=E(y)/4,T=1+O,$=-2*P/T,j=(1-O)/T,I=(1+A*P)/2/T,V=-(A+P)/T,X=I,L=0,C=0,U=0,W=0;for(t=k*t+9,v*=k,s*=k,n*=k,h*=k,p*=500*R/k**3,m*=R/k,l*=R/k,i*=k,c=k*c|0,e*=re,A=t+v+s+n+h|0;x<A;a[x++]=D*e)++H%(100*N|0)||(D=d?1<d?2<d?3<d?E(b**3):ee(Z(ae(b),1),-1):1-(2*b/R%2+2)%2:1-4*z(Q(b/R)-b/R):E(b),D=(c?1-u+u*E(R*x/c):1)*(D<0?-1:1)*z(D)**B*(x<t?x/t:x<t+v?1-(x-t)/v*(1-g):x<t+v+s?g:x<A-h?(A-x-h)/n*g:0),D=h?D/2+(h>x?0:(x<A-h?1:(A-x)/h)*a[x-h|0]/2/e):D,f&&(D=W=X*L+V*(L=C)+I*(C=D)-j*U-$*(U=W))),y=(r+=o+=p)*q(m*Y++),b+=y+y*M*E(x**5),S&&++S>i&&(r+=l,w+=l,S=0),!c||++G%c||(r=w,o=K,S=S||1);(e=te.createBuffer(1,A,k)).getChannelData(0).set(a),(r=te.createBufferSource()).buffer=e,r.connect(te.destination),r.start()},u={Ne:[3,,42,.01,.01,.02,3,2,,2,,,,,193,.6,,.53,.02],Ue:[.2,,577,,.05,.09,,3.6,,,,,,,,,,.64,.03,,-1499],We:[.6,,599,.06,.11,.17,,1.2,-1,-5,254,.06,.1,.1,12,,,.86,.25,,-972],Be:[.3,,142,,.23,.5,1,,-2.6,-24,,,.09,,,,,.1,.06],Ce:[.7,,480,.02,.04,.18,3,2.3,,,,,,.6,,.4,,.85,.01,,99]},G=(e,a=2,r="0")=>e.toString().padStart(a,r),H=e=>G(n(e/60))+":"+G(n(e%60)),$=e=>f(e*(180/J))+"Â°",f=(e,a=0)=>e?.toFixed(a)??"",j=e=>f(e,2),V=(e,a,r,t)=>m(r-e,t-a),X=(e,a)=>{for(var r=[];e.length&&a--;){var t=se(e);r.push(e[t].A),e.splice(t,1)}return r},se=r=>{var e=r.map(e=>e.weight).reduce((e,a)=>e+a),t=_()*e;for(let e=0,a=0;;e++)if(t<=(a+=r[e].weight))return e},ne=e=>e[Q(_()*(e.length-1))],de=e=>k.fillStyle=e,R={rect(e,a,r,t,s,n){k[n?"strokeStyle":"fillStyle"]=s,k[n?"strokeRect":"fillRect"](e,a,r,t)},t(e="#000d"){de(e),k.fillRect(0,0,c,s)},o(e,a,r,t){de(t),k.fillRect(e-r/2,a-r/2,r,r)},m(e,a,r,t){de(t),k.beginPath(),k.moveTo(e,a-r/2),k.lineTo(e-r/2,a+r/2),k.lineTo(e+r/2,a+r/2),k.fill()},text(e,a,r,t,s=h,n=l,d=14){k.font=d+"px monospace",de(t),k.textAlign=s,k.textBaseline=n,k.fillText(r,e,a)},i(e,a,r,t){de(t),k.beginPath(),k.arc(e,a,r,0,i),k.fill()},Se(e){k.globalAlpha=e}},oe=(e,a,r,t,s,n=!0)=>{var d,o,p=a,l=n?r/2:r;n&&15*(s.length-1)<=t&&(e+=r/4);for([d,o]of s)(d||o)&&(R.text(e,a,d+":",N),R.text(e+l-5,a,""+o,g,B)),p+t<(a+=15)&&(a=p,e+=l)},pe=(e,a,r)=>{e=k.createRadialGradient(o,p,e,o,p,o);return e.addColorStop(0,a),e.addColorStop(1,r),e},le=document.createElement("canvas"),k=(le.width=c,le.height=s,le.getContext`2d`),ie={arrowup:"up",arrowdown:"down",arrowleft:h,arrowright:B,w:"up",s:"down",a:h,d:B,enter:"enter",escape:"pause",p:"pause"},w={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1,targetX:0,targetY:0,touched:!1,touchX:0,touchY:0},b={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1},ce=(e,a)=>{e=ie[e.key.toLowerCase()];e&&(w[e]=a,b[e]=a)};onkeydown=e=>ce(e,!0),onkeyup=e=>ce(e,!1),onmousemove=e=>{var a=le.getBoundingClientRect();w.targetX=e.clientX-a.left,w.targetY=e.clientY-a.top};e=e=>{let r=e[0],t=[e[0]];return e.forEach((e,a)=>{r={...r,...e},t[a]=r}),t};let me=0,he=(e,a,r,t=20)=>{e.T-=a,e.P=.1,t&&(e.U=q(r)*t,e.B=F(r)*t),me++<4&&v(...u.Be),E.I+=a};var a={l:"Orbs",q:"Orbiting orbs",u:e([{h:10,g:50,v:J/1.5,R:.1,Ee:1,S:10},{Ee:2},{h:15,v:J/1.25},{v:+J,S:15},{Ee:3},{h:20},{Ee:4}]),D(e,a){var r=a.h+y.C.h.A,t=a.S*y.C.g.A,s=e.D*(a.v*y.C.$.A),n=i/a.Ee;for(let e=0;e<a.Ee;e++){var d,o=s+n*e,p=y.x+q(o)*a.g,l=y.y+F(o)*a.g;for(d of O)V(d.x,d.y,p,l)<t/2+d.type.S+2&&he(d,r,o)}},N(e,a){var r=i/a.Ee,t=e.D*(a.v*y.C.$.A),s=a.S*y.C.g.A;for(let e=0;e<a.Ee;e++){var n=t+r*e,d=y.x+q(n)*a.g,n=y.y+F(n)*a.g;R.i(d,n,s/2,g)}},O:(e,a,r)=>[["damage",x(a.h,r?.h)],["range",x(a.g,r?.g)],["speed",x(a.v,r?.v),e=>$(e)+"/s"],["count",x(a.Ee,r?.Ee)],["size",x(a.S,r?.S)]]};let x=(e,a)=>a?a-e:e;var S={l:"Sword",q:"melee weapon",u:e([{h:8,angle:J/4,g:80,R:.5},{h:13},{angle:J/4*1.2,g:90},{h:18},{h:23},{h:28,angle:J/4*1.5},{h:33,angle:J/4*1.7,g:120}]),D(e,a){var r,t=a.h+y.C.h.A,s=a.g*y.C.g.A,a=a.angle/2,n=y.L-a,d=y.L+a;for(r of O){var o=r.x-y.x,p=r.y-y.y,l=U(p,o),o=m(o,p),p=U(r.type.S/2,o);n<l+p&&l-p<d&&o-r.type.S/2<s&&he(r,t,l)}},N(e,a){var r=a.R*y.C.$.A,t=a.g*y.C.g.A,e=.2*(e.M/r);0<e&&(r=a.angle/2,de(`rgba(255,255,255,${e})`),k.beginPath(),k.moveTo(y.x,y.y),k.lineTo(y.x+q(y.L-r)*t,y.y+F(y.L-r)*t),k.arc(y.x,y.y,t,y.L-r,y.L+r),k.lineTo(y.x,y.y),k.fill())},O:(e,a,r)=>[["damage",x(a.h,r?.h)],["range",x(a.g,r?.g)],["angle",x(a.angle,r?.angle),$]]},e={l:"Barbed Wire",q:"area damage",u:e([{g:40,h:2,R:.75},{g:60},{h:3},{g:70},{g:80},{h:4}]),D(e,a){var r,t=a.h+y.C.h.A,s=a.g*y.C.g.A;for(r of O)V(y.x,y.y,r.x,r.y)<s&&he(r,t,0,0)},N(e,a){var r=a.R*y.C.$.A,a=a.g*y.C.g.A,e=e.M/r,r=.15+.04*q(2*e*J);R.i(y.x,y.y,a,`rgba(255,0,0,${r})`)},O:(e,a,r)=>[["damage",x(a.h,r?.h)],["range",x(a.g,r?.g)]]};let ge=e=>({K:e,D:0,M:0,W:0}),ve=[{l:"Warrior",Ke:S,C:{T:50,G:45,H:.05,V:50,h:0,$:1,j:.01,De:1,g:1},ye:{G:.2,H:.025,h:.3},N:(e,a)=>R.o(e,a,10,g)},{l:"Monk",Ke:e,C:{T:50,G:60,H:.05,V:50,h:0,$:1,j:.01,De:0,g:1},ye:{H:.03,V:1,g:.025},N:(e,a)=>R.m(e,a,10,g)},{l:"Magic Man",Ke:a,C:{T:50,G:45,H:.05,V:50,h:0,$:1,j:.01,De:0,g:1},ye:{G:.2,$:-.026,H:.03,De:.25,g:.02},N:(e,a)=>R.i(e,a,5,g)}],ue=100;var D=t=>{let s;return{l:t.l,q(){var e,a,r=s?.F??y.Y.find(e=>e.K===t);return r?s?.W===r.W?s.q:(a=r.K.u[r.W],e=r.K.u[r.W+1],a=r.K.O(r,a,e).filter(e=>!!e[1]).map(([e,a,r=f])=>`+${r(a)} `+e).join(", "),s={W:r.W,F:r,q:a},a):t.q},X(){var e=y.Y.find(e=>e.K===t);e?e.W++:y.Y.push(ge(t))},Ae:()=>y.Y.some(e=>e.K===t)?ue:25,_:t.u.length-1}};let fe=[{l:"Speed boost",q:"+5% speed",X(){y.C.G.J+=.05}},{l:"Speed base",q:"+1 base speed",X(){y.C.G.Z+=1}},{l:"Max health",q:"+25 max health, +5 health",X(){y.C.T.Z+=25,y.T+=5}},{l:"Health drop",q:"+1% health drop chance",X:()=>{y.C.j.Z+=.01}},{l:"Regen",q:"+0.05/s health regen",X:()=>y.C.H.Z+=.05},{l:"Regen boost",q:"+10% health regen",X:()=>y.C.H.J+=.1},{l:"Pickup range",q:"+10 pickup range",X:()=>y.C.V.Z+=10},{l:"Damage",q:"+1 damage",X:()=>y.C.h.Z+=1},{l:"Attack speed",q:"+5% attack speed",X:()=>y.C.$.Z-=.05},{l:"Armor",q:"+1 armor",X:()=>y.C.De.Z+=1},{l:"Area",q:"+10% area",X:()=>y.C.g.Z+=.1},D(a),D(S),D(e)],A=(e=0,a=0,r=1)=>({Z:e,J:r,get A(){return(this.Z+y.W*a)*this.J}}),Re=e=>({K:e,x:0,y:0,W:0,re:0,te:5,T:e.C.T,se:0,ne:0,oe:0,L:0,C:{T:A(e.C.T,e.ye.T),H:A(e.C.H,e.ye.H),De:A(e.C.De,e.ye.De),h:A(e.C.h,e.ye.h),$:A(e.C.$,e.ye.$),g:A(e.C.g,e.ye.g),G:A(e.C.G,e.ye.G),V:A(e.C.V,e.ye.V),j:A(e.C.j,e.ye.j)},me:[],Y:[ge(e.Ke)]}),y=Re(ve[0]),P={Oe:0,de:1,ie:2,le:3,Le:4,pe:5,Pe:6},ke={ce:-1,Te:0,I:0,ue:0,he:0,me:[],Ie:0,Me:0},E={ge:P.pe,...ke},we=e=>Object.assign(y,Re(e));var a=e=>({...e,M:1,S:10}),S=(e,n)=>(r,t,s)=>e.map((e,a)=>R.o(r+a,t+a,n,s??e)),D=(e,n)=>(r,t,s)=>e.map((e,a)=>R.m(r+a,t+a,n,s??e)),e=(e,n)=>(r,t,s)=>e.map((e,a)=>R.i(r+a,t+a,n,s??e)),be=a({T:10,G:26,h:10,re:1,N:S([N],10)}),xe=a({T:50,G:26,h:20,re:2,N:S([N,t],10)}),Se=a({T:100,G:30,h:30,re:3,N:S([N,t,"#4a4"],10)}),S=a({T:1e3,G:30,h:30,re:100,S:20,N:S([t],20),ve:!0}),De=a({T:20,G:35,h:10,re:2,N:D([d],10)}),Ae=a({T:40,G:35,h:20,re:3,N:D([d,Y],10)}),ye=a({T:60,G:35,h:40,re:4,N:D([d,Y,"#966"],10)}),D=a({T:3e3,G:35,h:40,re:200,ve:!0,Re:80,S:20,N:D([t],20)}),Pe=a({T:10,G:40,h:10,re:3,N:e([d],5)}),Ee=a({T:20,G:40,h:20,re:4,N:e([d,Y],5)}),Oe=a({T:50,G:40,h:40,re:5,N:e([d,Y,"#4ca"],5)}),e=a({T:5e3,G:40,h:50,re:300,ve:!0,Re:80,S:16,N:e([t],8)}),a=a({T:8e3,G:60,h:100,re:0,ve:!0,Re:1e3,S:50,N(e,a,r){R.i(e,a,25,r??t),R.o(e,a,25,r??Y),R.m(e,a,23,r??t)}});let Te=(r,e,t=1)=>Array.from({length:n((e-r)/t)}).map((e,a)=>a*t+r);var Ie,Le=r=>()=>{var e=Te(y.x-o,y.x+o,2*r.S),a=Te(y.y-p,y.y+p,2*r.S);e.map(e=>Be(e,y.y-p,r)),e.map(e=>Be(e,y.y+p,r)),a.map(e=>Be(y.x-o,e,r)),a.map(e=>Be(y.x+o,e,r))};let Ce=[{be:[be],xe:.2},{be:[be,De],xe:.2},{be:[be,De],xe:.2},{be:[De],xe:.2,ve:S},{be:[De,Pe],xe:.2},{be:[De,Pe],xe:.2},{be:[xe],xe:.2,ke:Le(xe)},{be:[xe,Ae,Pe],xe:.2},{be:[Ae,Pe],ve:D,xe:.2},{be:[Ae,Ee,xe],xe:.2},{be:[Ee,Se],xe:.2,ke:(Ie=Ee,()=>{var e=i/40;Te(0,i,e).map(e=>{var a=y.x+q(e)*o,e=y.y+F(e)*p;Be(a,e,Ie)})})},{be:[Se,ye],xe:.2},{be:[Se,ye],xe:.2},{be:[Se,ye,Oe],xe:.2},{be:[Se,ye],ve:e,xe:.2},{be:[Se,ye,Oe],xe:.1,ke:Le(ye)},{be:[],xe:0,ve:a}],Ue=600,We=Ue/(Ce.length-1),Be=(e,a,r)=>O.push({x:e,y:a,type:r,T:r.T,M:0,U:0,B:0,P:0,ve:!!r.ve}),O=[],Me=[],T=50,Ne=2*T,Ke=()=>{var e=n((y.x-o)/T)*T,r=n((y.y-p)/T)*T,t=C((y.x+o)/T)*T,s=C((y.y+p)/T)*T;for(let a=e;a<t;a+=T)for(let e=r;e<s;e+=T)R.rect(a,e,T,T,a%Ne==0?e%Ne==0?"#000":"#111":e%Ne==0?"#111":"#000")},Ye=()=>{for(var e of y.Y)e.K.N(e,e.K.u[e.W]);y.K.N(y.x,y.y)},Ge=()=>{for(var e of O){var a=e.type;a.N(e.x,e.y,0<e.P?g:void 0),a.ve&&(R.rect(e.x-20,e.y+15,40,3,"#333"),R.rect(e.x-20,e.y+15,e.T/a.T*40,3,"#f33"))}},He=()=>{for(var e of Me)R.o(e.x-3,e.y-3,10<=(e.re??0)?8:6,0<(e.T??0)?"#0c0":(e.re??0)<10?"#05f":"#ff0")},$e={h:"Base damage",$:"Attack speed",g:"Area",T:"Health",H:"Regen",De:"Armor",G:"Speed",j:"Health Drop",V:"Pickup Distance"},je={$:e=>j(2-e),T:n,g:j,G:j,H:e=>j(e)+"/s",j:e=>f(100*e)+"%"},Ve=e=>e+"/level",Xe=(e,a)=>{var r,t=Object.entries(e.C).map(([e,a])=>[$e[e],(je[e]??f)(a.A)]),s=t.push.bind(t);a&&(s([]),s(...Object.entries(e.K.ye).map(([e,a])=>[$e[e],Ve(f(z(a),2))])),s([]));for(r of e.Y){let t=r.K.l;s([t+" level",r.W+1],...r.K.O(r,r.K.u[r.W]).map(([e,a,r=f])=>[t+" "+e,r(a)]))}return t},_e=(e,a,r)=>{var t=Xe(y);oe(e,a,r,s-a-40,t)},qe=(e,a,r)=>{var t;for(t of[["Survived",H(E.Te)],["Level",""+(y.W+1)],["Damage",f(E.I)],["DPS",""+f(E.I/E.Te,2)],["Kills",""+E.ue]])R.text(e+r/2-5,a,t[0],K,B),R.text(e+r/2+5,a,t[1],g,h),a+=15;return a},Fe=()=>{if(R.rect(50,0,c-50,20,"#600"),R.rect(50,0,y.T/y.C.T.A*(c-50),20,"#f66"),R.text(52,10,n(y.T)+"/"+n(y.C.T.A),g,h,M),R.rect(50,20,c-50,12,d),R.rect(50,20,y.re/y.te*(c-50),12,g),R.text(52,27,y.re+"/"+y.te,"#000",h,M),R.rect(0,0,50,32,"#000"),R.text(25,2,"level","#666",r,l),R.text(25,18,""+(y.W+1),g,r,l),R.text(o,35,H(E.Te),g,r),E.Te<20){let e=s-30-15*L.length;for(var a of L)R.text(10,e,a,g,h,l),e+=15}},ze=(a,r,t,s,n,d)=>{for(let e=0;e<d.length;e++)R.rect(a,r,t,s,e===E.Ie?"#333":"#222"),R.rect(a,r,t,s,e===E.Ie?"#aa3":"#444",!0),n(a,r,d[e]),r+=s+5;return r},Je={[P.de](){var e;R.t(),R.text(o,100,"YOU'RE DEAD!","#f88",r,l,24),e=qe(50,145,c-100),e+=30,R.text(o,e,W,g,r)},[P.le](){R.t(),R.text(o,40,"PAUSED",g,r,M),_e(20,80,c-40)},[P.Pe](){R.t(),R.text(o,10,"PICK CLASS",g,r,l),ze(20,50,100,20,(e,a,r)=>{r.N(e+10,a+10),R.text(e+20,a+10,r.l,g,h,M)},ve);var e=Xe(y,!0);oe(140,30,c-140-20,s-60,e,!1)},[P.ie](){R.t(),R.text(o,10,"LEVEL UP",g,r,l),ze(20,50,c-40,40,(e,a,r)=>{var t,s=y.me.filter(e=>e===r).length;R.text(e+5,a+5,r.l,g),R.text(e+5,a+22,"function"==typeof(t=r.q)?t():t,K),R.text(e+c-50,a+20,s+"/"+(r._??5),K,B,M)},E.me),_e(20,210,c-40)},[P.pe](){R.t(),R.text(o,p-40,"MICRO",g,r,"bottom",68),R.text(o,p-40,"SURVIVORS",g,r,l,38),R.text(o,s-5,"by Kamen",K,r,"bottom",10),R.Se(.75+.25*q(performance.now()/1e3*5)),R.text(o,p+50,"Press ENTER to start",g,r),R.Se(1)},[P.Le](){R.t(),R.text(o,100,"YOU WON",g,r,M);var e=qe(100,130,c-200);e+=30,R.text(o,e,W,g,r)}},Qe=()=>{E.ge!==P.pe&&E.ge!==P.Pe&&Fe(),Je[E.ge]?.()},Ze=()=>{var e=Z(1,y.ne/.5),e=(0<e&&(e=pe(80,"#f000",`rgba(255,0,0,${e})`),R.t(e)),Z(1,y.oe/.1));0<e&&(e=pe(130,"#fff0",`rgba(255,255,255,${.15*e})`),R.t(e))},ea=r=>{let t=0;var s,n=[];for(s of O){var d=s.type;if(s.T<=0)Me.push({x:s.x,y:s.y,re:d.re}),_()<y.C.j.A&&Me.push({x:s.x-5+10*_(),y:s.y-5+10*_(),T:2}),E.ue+=1,n.push(t);else{0<s.P&&(s.P-=r);let e=s.U*r,a=s.B*r;var o,p=y.x-s.x,l=y.y-s.y,i=m(p,l);!s.ve&&3*c<i?n.push(t):(s.M<=0?(i<s.type.S-2&&(y.T-=ee(0,d.h-y.C.De.A),y.ne=.5,s.M=d.M,v(...u.Ce)),o=d.G*r,e+=p/i*o,a+=l/i*o):s.M-=r,s.x+=e,s.y+=a,p=(0<s.U?-1:1)*r*(d.Re??20),z(p)>z(s.U)?s.U=0:s.U+=p,p=(0<s.B?-1:1)*r*(d.Re??20),z(p)>z(s.B)?s.B=0:s.B+=p)}t++}let a=0;for(let e of n)O.splice(e-a,1),a+=1},aa=e=>{var a=_()*i,r=ee(c,s)/2,r=m(r,r)+15*_();Be(y.x+q(a)*r,y.y+F(a)*r,e)},ra=e=>{we(e),Object.assign(E,ke),E.ge=P.Oe,O.length=0,Me.length=0},ta=()=>{b.up&&0<E.Ie&&(E.Ie--,v(...u.Ne)),b.down&&E.Ie<E.Me&&(E.Ie++,v(...u.Ne))},sa=e=>{switch(E.ge){case P.Oe:E.Te+=e,b.pause&&(E.ge=P.le),y.T<=0&&(E.ge=P.de);var a=n(E.Te/We),r=Ce[a];if(E.Te>Ue&&0===O.length&&(E.ge=P.Le),r){for(a!==E.ce&&(E.ce=a,r.ve&&aa(r.ve),r.ke?.());r.xe&&E.he>r.xe;)0<r.be.length&&aa(ne(r.be)),E.he-=r.xe;E.he+=e}break;case P.Le:case P.de:case P.pe:w.enter&&(E.Ie=0,E.Me=ve.length-1,we(ve[0]),E.ge=P.Pe,v(...u.Ne));break;case P.Pe:ta();a=ve[E.Ie];y.K!==a&&we(a),b.enter&&(ra(ve[E.Ie]),v(...u.Ne));break;case P.ie:ta(),b.enter&&((a=E.me[E.Ie]).X(),y.me.push(a),E.ge=P.Oe,v(...u.Ne));break;case P.le:(b.pause||b.enter)&&(E.ge=P.Oe)}},na=()=>{for(var e in b)b[e]=!1},da=e=>{let a=me=0,r=0;w.up&&--r,w.down&&(r+=1),w.left&&--a,w.right&&(a+=1);var t,s,n=y.C.G.A*e,d=m(a,r);0<d&&(y.x+=a/d*n,y.y+=r/d*n),y.L=U(w.targetY-o,w.targetX-p),y.re>=y.te&&(y.W+=1,y.re-=y.te,y.te+=10,d=fe.filter(a=>!(a.cond&&!a.cond()||y.me.filter(e=>e===a).length>=(a._??5))).map(e=>({A:e,weight:e.Ae?.()??ue})),E.me=X(d,3),0<E.me.length&&(E.ge=P.ie,E.Ie=0,E.Me=E.me.length-1),v(...u.We),y.T+=5),0<y.ne&&(y.ne-=e),0<y.oe&&(y.oe-=e),y.T=Z(y.C.T.A,y.T+y.C.H.A*e);for(t of y.Y)t.D+=e,t.M<=0?(s=t.K.u[t.W],t.K.D(t,s),t.M=s.R*y.C.$.A):t.M-=e},oa=e=>{let a=0;var r,t=[];for(r of Me){var s,n=y.x-r.x,d=y.y-r.y,o=m(n,d);o<10?(y.T=Z(y.C.T.A,y.T+(r.T??0)),y.re+=r.re??0,y.oe=.1,v(...u.Ue),t.push(a)):o<y.C.V.A&&(s=(y.C.V.A+10-o)*e*2,r.x+=n/o*s,r.y+=d/o*s),a++}let p=0;for(let e of t)Me.splice(e-p,1),p+=1},pa=0,la=e=>{requestAnimationFrame(la);var a=(e-pa)/1e3;pa=e,k.reset(),k.clearRect(0,0,c,s),k.translate(-y.x+o,-y.y+p),Ke(),He(),Ye(),Ge(),k.resetTransform(),Ze(),Qe(),e=a,sa(e),E.ge===P.Oe&&(ea(e),oa(e),da(e)),na()};return I.appendChild(le),requestAnimationFrame(la),[y,E]}