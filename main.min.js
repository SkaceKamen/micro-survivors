function microSurvivors(U=document.body,p=400,s=400){let W=["WASD to move","Mouse to aim","Survive","Kill end boss"],o=p/2,i=s/2,{floor:n,ceil:C,random:c,round:K,cos:l,sin:h,min:Y,hypot:u,abs:g,atan2:$,PI:t}=Math,f=2*t;var e="Press ENTER to ";let G=e+"start",j=e+"restart",r="center",m="top",v="left",H="right",d="middle",R="#fff",V="#aaa",X="#ccc",k="#faa",q="#0ac",b="#999",F=(e,a=2,r="0")=>e.toString().padStart(a,r),_=e=>F(n(e/60))+":"+F(n(e%60)),z=e=>w(e*(180/t))+"Â°",w=(e,a=0)=>e?.toFixed(a)??"",J=e=>w(e,2),Q=(e,a,r,t)=>u(r-e,t-a),Z=(e,a)=>{for(var r=[];e.length&&a--;){var t=(r=>{var e=r.map(e=>e.weight).reduce((e,a)=>e+a),t=c()*e;for(let e=0,a=0;;e++)if(a+=r[e].weight,t<=a)return e})(e);r.push(e[t].A),e.splice(t,1)}return r};let ee=e=>e[K(c()*(e.length-1))],S=e=>D.fillStyle=e,x={rect(e,a,r,t,s,n){D[n?"strokeStyle":"fillStyle"]=s,D[n?"strokeRect":"fillRect"](e,a,r,t)},t(e="#000000e5"){S(e),D.fillRect(0,0,p,s)},o(e,a,r,t){S(t),D.fillRect(e-r/2,a-r/2,r,r)},m(e,a,r,t){S(t),D.beginPath(),D.moveTo(e,a-r/2),D.lineTo(e-r/2,a+r/2),D.lineTo(e+r/2,a+r/2),D.fill()},text(e,a,r,t,s=v,n=m,d=14){D.font=d+"px monospace",S(t),D.textAlign=s,D.textBaseline=n,D.fillText(r,e,a)},i(e,a,r,t){S(t),D.beginPath(),D.arc(e,a,r,0,f),D.fill()},Se(e){D.globalAlpha=e}},ae=(e,a,r,t,s,n=!0)=>{var d,o,i=a,m=n?r/2:r;n&&15*(s.length-1)<=t&&(e+=r/4);for([d,o]of s)(d||o)&&(x.text(e,a,d+":",V),x.text(e+m-5,a,""+o,R,H)),i+t<(a+=15)&&(a=i,e+=m)},re=(e,a,r)=>{e=D.createRadialGradient(o,i,e,o,i,o);return e.addColorStop(0,a),e.addColorStop(1,r),e},te=document.createElement("canvas"),D=(te.width=p,te.height=s,te.getContext`2d`),se={arrowup:"up",arrowdown:"down",arrowleft:v,arrowright:H,w:"up",s:"down",a:v,d:H,enter:"enter",escape:"pause",p:"pause"},A={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1,targetX:0,targetY:0,touched:!1,touchX:0,touchY:0},y={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1},ne=(e,a)=>{e=se[e.key.toLowerCase()];e&&(A[e]=a,y[e]=a)};onkeydown=e=>ne(e,!0),onkeyup=e=>ne(e,!1),onmousemove=e=>{var a=te.getBoundingClientRect();A.targetX=e.clientX-a.left,A.targetY=e.clientY-a.top};var e=e=>{let r=e[0],t=[e[0]];return e.forEach((e,a)=>{r={...r,...e},t[a]=r}),t},a={l:"Saw Blades",q:"Spinning blades",u:e([{h:10,g:50,v:t/1.5,R:.1,k:1,S:10},{k:2},{h:15,v:t/1.25},{v:+t,S:15},{k:3},{h:20},{k:4}]),D(e,a){var r=a.h+M.C.h.A,t=a.S*M.C.g.A,s=e.D*(a.v*M.C.$.A),n=f/a.k;for(let e=0;e<a.k;e++){var d,o=s+n*e,i=M.x+l(o)*a.g,m=M.y+h(o)*a.g;for(d of N)Q(d.x,d.y,i,m)<t/2+d.type.S+2&&(d.T-=r,d.P=.1,d.U=20*l(o),d.B=20*h(o),B.I+=r)}},N(e,a){var r=f/a.k,t=e.D*(a.v*M.C.$.A),s=a.S*M.C.g.A;for(let e=0;e<a.k;e++){var n=t+r*e,d=M.x+l(n)*a.g,n=M.y+h(n)*a.g;x.i(d,n,s/2,R)}},O:(e,a,r)=>[["damage",P(a.h,r?.h)],["range",P(a.g,r?.g)],["speed",P(a.v,r?.v),e=>z(e)+"/s"],["blades",P(a.k,r?.k)],["size",P(a.S,r?.S)]]};let P=(e,a)=>a?a-e:e;var E={l:"Sword",q:"melee weapon",u:e([{h:8,angle:t/4,g:80,R:.5},{h:13},{angle:t/4*1.2,g:90},{h:18},{h:23},{h:28,angle:t/4*1.5},{h:33,angle:t/4*1.7,g:120}]),D(e,a){var r,t=a.h+M.C.h.A,s=a.g*M.C.g.A,a=a.angle/2,n=M.L-a,d=M.L+a;for(r of N){var o=r.x-M.x,i=r.y-M.y,m=$(i,o),o=u(o,i),i=$(r.type.S/2,o);n<m+i&&m-i<d&&o-r.type.S/2<s&&(r.T-=t,r.P=.1,r.U=25*l(m),r.B=25*h(m),B.I+=t)}},N(e,a){var r=a.R*M.C.$.A,t=a.g*M.C.g.A,e=.2*(e.M/r);0<e&&(r=a.angle/2,S(`rgba(255,255,255,${e})`),D.beginPath(),D.moveTo(M.x,M.y),D.lineTo(M.x+l(M.L-r)*t,M.y+h(M.L-r)*t),D.arc(M.x,M.y,t,M.L-r,M.L+r),D.lineTo(M.x,M.y),D.fill())},O:(e,a,r)=>[["damage",P(a.h,r?.h)],["range",P(a.g,r?.g)],["angle",P(a.angle,r?.angle),z]]},e={l:"Barbed Wire",q:"area damage",u:e([{g:40,h:2,R:.75},{g:60},{h:3},{g:70},{g:80},{h:4}]),D(e,a){var r,t=a.h+M.C.h.A,s=a.g*M.C.g.A;for(r of N)Q(M.x,M.y,r.x,r.y)<s&&(r.T-=t,r.P=.1,B.I+=t)},N(e,a){var r=a.R*M.C.$.A,a=a.g*M.C.g.A,e=e.M/r,r=.15+.04*l(2*e*t);x.i(M.x,M.y,a,`rgba(255,0,0,${r})`)},O:(e,a,r)=>[["damage",P(a.h,r?.h)],["range",P(a.g,r?.g)]]};let de=e=>({K:e,D:0,M:0,W:0}),oe=e=>()=>M.W*e,ie=[{l:"Warrior",Y:[E],C:{T:[50],G:[45],H:[.05],V:[50],h:[0],$:[1],j:[.01],De:[1],g:[1]},ye:{G:.2,H:.025,h:.3},N:(e,a)=>x.o(e,a,10,R)},{l:"Monk",Y:[e],C:{T:[50],G:[60],H:[.05],V:[50],h:[0],$:[1],j:[.01],De:[0],g:[1]},ye:{H:.03,V:1,g:.025},N:(e,a)=>x.m(e,a,10,R)},{l:"Magic Man",Y:[a],C:{T:[50],G:[45],H:[.05],V:[50],h:[0],$:[1],j:[.01],De:[0],g:[1]},ye:{G:.2,$:-.026,H:.03,De:.25,g:.02},N:(e,a)=>x.i(e,a,5,R)}],me=100;var I=t=>{let s;return{l:t.l,q(){var e,a,r=s?.F??M.Y.find(e=>e.K===t);return r?s?.W===r.W?s.q:(a=r.K.u[r.W],e=r.K.u[r.W+1],a=r.K.O(r,a,e).filter(e=>!!e[1]).map(([e,a,r=w])=>`+${r(a)} `+e).join(", "),s={W:r.W,F:r,q:a},a):t.q},X(){var e=M.Y.find(e=>e.K===t);e?e.W++:M.Y.push(de(t))},Ae:()=>M.Y.some(e=>e.K===t)?me:25,_:t.u.length-1}};let le=[{l:"Speed boost",q:"+5% speed",X(){M.C.G.J.push(.05)}},{l:"Speed base",q:"+1 base speed",X(){M.C.G.Z.push(1)}},{l:"Max health",q:"+25 max health, +5 health",X(){M.C.T.Z.push(25),M.T+=5}},{l:"Health drop",q:"+1% health drop chance",X:()=>{M.C.j.Z.push(.01)}},{l:"Regen",q:"+0.05/s health regen",X:()=>M.C.H.Z.push(.05)},{l:"Regen boost",q:"+10% health regen",X:()=>M.C.H.J.push(.1)},{l:"Pickup range",q:"+10 pickup range",X:()=>M.C.V.Z.push(10)},{l:"Damage",q:"+1 damage",X:()=>M.C.h.Z.push(1)},{l:"Attack speed",q:"+5% attack speed",X:()=>M.C.$.Z.push(-.05)},{l:"Armor",q:"+1 armor",X:()=>M.C.De.Z.push(1)},{l:"Area",q:"+10% area",X:()=>M.C.g.Z.push(.1)},I(a),I(E),I(e)],pe=e=>"function"==typeof e?e():e,T=(e=[],a=[])=>({Z:[...e],J:[...a],ee:null,get A(){var e;return this.ee?.Z===this.Z&&this.ee?.J===this.J&&this.ee?.ae===M.W?this.ee.value:(e=this.Z.reduce(e=(e,a)=>e+pe(a),0)*this.J.reduce(e,1),this.ee={Z:this.Z,J:this.J,ae:M.W,value:e},e)}}),L=(e,a)=>[...e,...a?[oe(a)]:[]],ce=e=>({K:e,x:0,y:0,W:0,re:0,te:5,T:pe(e.C.T[0]),se:0,ne:0,oe:0,L:0,C:{h:T(L(e.C.h,e.ye.h)),$:T(L(e.C.$,e.ye.$)),g:T(L(e.C.g,e.ye.g)),G:T(L(e.C.G,e.ye.G)),T:T(L(e.C.T,e.ye.T)),H:T(L(e.C.H,e.ye.H)),De:T(L(e.C.De,e.ye.De)),V:T(L(e.C.V,e.ye.V)),j:T(L(e.C.j,e.ye.j))},me:[],Y:e.Y.map(e=>de(e))}),M=ce(ie[0]),O={RUNNING:0,de:1,ie:2,le:3,WIN:4,pe:5,Pe:6},he={ce:-1,runtime:0,I:0,ue:0,he:0,me:[],selectedIndex:0},B={ge:O.pe,...he},ue=e=>Object.assign(M,ce(e));var a=e=>({...e,M:1,S:10}),E=(e,n)=>(r,t,s)=>e.map((e,a)=>x.o(r+a,t+a,n,s??e)),I=(e,n)=>(r,t,s)=>e.map((e,a)=>x.m(r+a,t+a,n,s??e)),e=(e,n)=>(r,t,s)=>e.map((e,a)=>x.i(r+a,t+a,n,s??e)),ge=a({T:10,G:26,h:10,re:1,N:E([V],10)}),fe=a({T:50,G:26,h:20,re:2,N:E([V,k],10)}),ve=a({T:100,G:30,h:30,re:3,N:E([V,k,"#4a4"],10)}),E=a({T:1e3,G:30,h:30,re:100,S:20,N:E([k],20),ve:!0}),Re=a({T:20,G:35,h:10,re:2,N:I([b],10)}),ke=a({T:40,G:35,h:20,re:3,N:I([b,q],10)}),be=a({T:60,G:35,h:40,re:4,N:I([b,q,"#966"],10)}),I=a({T:3e3,G:35,h:40,re:200,ve:!0,Re:80,S:20,N:I([k],20)}),we=a({T:10,G:40,h:10,re:3,N:e([b],5)}),Se=a({T:20,G:40,h:20,re:4,N:e([b,q],5)}),xe=a({T:50,G:40,h:40,re:5,N:e([b,q,"#4ca"],5)}),e=a({T:5e3,G:40,h:50,re:300,ve:!0,Re:80,S:16,N:e([k],8)}),a=a({T:8e3,G:60,h:100,re:0,ve:!0,Re:1e3,S:50,N(e,a,r){x.i(e,a,25,r??k),x.o(e,a,25,r??q),x.m(e,a,23,r??k)}});let De=(r,e,t=1)=>Array.from({length:n((e-r)/t)}).map((e,a)=>a*t+r);var Ae,ye=r=>()=>{var e=De(M.x-o,M.x+o,2*r.S),a=De(M.y-i,M.y+i,2*r.S);e.map(e=>Ee(e,M.y-i,r)),e.map(e=>Ee(e,M.y+i,r)),a.map(e=>Ee(M.x-o,e,r)),a.map(e=>Ee(M.x+o,e,r))};let Pe=[{we:0,be:[ge],xe:.2},{we:30,be:[ge,Re],xe:.2},{we:80,be:[ge,Re],xe:.2},{we:120,be:[Re],xe:.2,ve:E},{we:150,be:[Re,we],xe:.2},{we:180,be:[Re,we],xe:.2},{we:210,be:[fe],xe:.2,ke:ye(fe)},{we:240,be:[fe,ke,we],xe:.2},{we:270,be:[ke,we],ve:I,xe:.2},{we:300,be:[ke,Se,fe],xe:.2},{we:330,be:[Se,ve],xe:.2,ke:(Ae=Se,()=>{var e=f/40;De(0,f,e).map(e=>{var a=M.x+l(e)*o,e=M.y+h(e)*i;Ee(a,e,Ae)})})},{we:380,be:[ve,be],xe:.2},{we:400,be:[ve,be],xe:.2},{we:450,be:[ve,be,xe],xe:.2},{we:400,be:[ve,be],ve:e,xe:.2},{we:550,be:[ve,be,xe],xe:.1,ke:ye(be)},{we:600,be:[],xe:0,ve:a}],Ee=(e,a,r)=>N.push({x:e,y:a,type:r,T:r.T,M:0,U:0,B:0,P:0,ve:!!r.ve}),N=[],Ie=[],Te=()=>{var e=50*n((M.x-o)/50),r=50*n((M.y-i)/50),t=50*C((M.x+o)/50),s=50*C((M.y+i)/50);for(let a=e;a<t;a+=50)for(let e=r;e<s;e+=50)x.rect(a,e,50,50,a%100==0?e%100==0?"#000":"#111":e%100==0?"#111":"#000")},Le=()=>{for(var e of M.Y)e.K.N(e,e.K.u[e.W]);M.K.N(M.x,M.y)},Me=()=>{for(var e of N){var a=e.type;a.N(e.x,e.y,0<e.P?R:void 0),a.ve&&(x.rect(e.x-20,e.y+15,40,3,"#333"),x.rect(e.x-20,e.y+15,e.T/a.T*40,3,"#f33"))}},Oe=()=>{for(var e of Ie)x.o(e.x-3,e.y-3,10<=(e.re??0)?8:6,0<(e.T??0)?"#0c0":(e.re??0)<10?"#05f":"#ff0")},Be={h:"Base damage",$:"Attack speed",g:"Area",T:"Health",H:"Regen",De:"Armor",G:"Speed",j:"Health Drop",V:"Pickup Distance"},Ne={$:e=>J(2-e),T:n,g:J,G:J,H:e=>J(e)+"/s",j:e=>w(100*e)+"%"},Ue=e=>e+"/level",We=(e,a)=>{var r,t=Object.entries(e.C).map(([e,a])=>[Be[e],(Ne[e]??w)(a.A)]),s=t.push.bind(t);a&&(s([]),s(...Object.entries(e.K.ye).map(([e,a])=>[Be[e],Ue(w(g(a),2))])),s([]));for(r of e.Y){let t=r.K.l;s([t+" level",r.W+1],...r.K.O(r,r.K.u[r.W]).map(([e,a,r=w])=>[t+" "+e,r(a)]))}return t},Ce=(e,a,r)=>{var t=We(M);ae(e,a,r,s-a-40,t)},Ke=(e,a,r)=>{var t;for(t of[["Survived",_(B.runtime)],["Level",""+(M.W+1)],["Damage",w(B.I)],["DPS",""+w(B.I/B.runtime,2)],["Kills",""+B.ue]])x.text(e+r/2-5,a,t[0],X,H),x.text(e+r/2+5,a,t[1],R,v),a+=15;return a},Ye=()=>{if(x.rect(50,0,p-50,20,"#600"),x.rect(50,0,M.T/M.C.T.A*(p-50),20,"#f66"),x.text(52,10,n(M.T)+"/"+n(M.C.T.A),R,v,d),x.rect(50,20,p-50,12,b),x.rect(50,20,M.re/M.te*(p-50),12,R),x.text(52,27,M.re+"/"+M.te,"#000",v,d),x.rect(0,0,50,32,"#000"),x.text(25,2,"level","#666",r,m),x.text(25,18,""+(M.W+1),R,r,m),x.text(o,35,_(B.runtime),R,r),B.runtime<20){let e=s-30-15*W.length;for(var a of W)x.text(10,e,a,R,v,m),e+=15}},$e=(a,r,t,s,n,d)=>{for(let e=0;e<d.length;e++)x.rect(a,r,t,s,e===B.selectedIndex?"#333":"#222"),x.rect(a,r,t,s,e===B.selectedIndex?"#aa3":"#444",!0),n(a,r,d[e]),r+=s+5;return r},Ge=()=>{switch(B.ge!==O.pe&&Ye(),B.ge){case O.de:x.t(),x.text(o,100,"YOU'RE DEAD!","#f88",r,m,24),e=Ke(50,145,p-100),e+=30,x.text(o,e,j,R,r);break;case O.ie:x.t(),x.text(o,10,"LEVEL UP",R,r,m),$e(20,50,p-40,40,(e,a,r)=>{var t=M.me.filter(e=>e===r).length;x.text(e+5,a+5,r.l,R),x.text(e+5,a+22,pe(r.q),X),x.text(e+p-50,a+20,t+"/"+(r._??5),X,H,d)},B.me),Ce(20,210,p-40);break;case O.Pe:x.t(),x.text(o,10,"PICK CLASS",R,r,m),$e(20,50,100,20,(e,a,r)=>{r.N(e+10,a+10),x.text(e+20,a+10,r.l,R,v,d)},ie);var e=ie[B.selectedIndex],e=(M.K!==e&&ue(e),We(M,!0));ae(140,30,p-140-20,s-60,e,!1);break;case O.le:x.t(),x.text(o,40,"PAUSED",R,r,d),Ce(20,80,p-40);break;case O.WIN:x.t(),x.text(o,100,"YOU WON",R,r,d);e=Ke(100,130,p-200);e+=30,x.text(o,e,j,R,r);break;case O.pe:x.t(),x.text(o,i-40,"MICRO",R,r,"bottom",68),x.text(o,i-40,"SURVIVORS",R,r,m,38),x.text(o,s-5,"by Kamen",X,r,"bottom",10),x.Se(.75+.25*l(performance.now()/1e3*5)),x.text(o,i+50,G,R,r),x.Se(1)}},je=()=>{var e=Y(1,M.ne/.5),e=(0<e&&(e=re(80,"#f000",`rgba(255,0,0,${e})`),x.t(e)),Y(1,M.oe/.1));0<e&&(e=re(130,"#fff0",`rgba(255,255,255,${.15*e})`),x.t(e))},He=r=>{let t=0;var s,n=[];for(s of N){var d=s.type;if(s.T<=0)Ie.push({x:s.x,y:s.y,re:d.re}),c()<M.C.j.A&&Ie.push({x:s.x-5+10*c(),y:s.y-5+10*c(),T:2}),B.ue+=1,n.push(t);else{0<s.P&&(s.P-=r);let e=s.U*r,a=s.B*r;var o,i=M.x-s.x,m=M.y-s.y,l=u(i,m);!s.ve&&3*p<l?n.push(t):(s.M<=0?(l<s.type.S-2&&(M.T-=Math.max(0,d.h-M.C.De.A),M.ne=.5,s.M=d.M),o=d.G*r,e+=i/l*o,a+=m/l*o):s.M-=r,s.x+=e,s.y+=a,!(.1<g(s.U))||(i=(0<s.U?-1:1)*r*(d.Re??20),g(i)>g(s.U))?s.U=0:s.U+=i,!(.1<g(s.B))||(m=(0<s.B?-1:1)*r*(d.Re??20),g(m)>g(s.B))?s.B=0:s.B+=m)}t++}let a=0;for(let e of n)N.splice(e-a,1),a+=1},Ve=e=>{var a=c()*f,r=Math.max(p,s)/2,r=u(r,r)+15*c();Ee(M.x+l(a)*r,M.y+h(a)*r,e)},Xe=e=>{ue(e),Object.assign(B,he),B.ge=O.RUNNING,N.length=0,Ie.length=0},qe=e=>{switch(B.ge){case O.RUNNING:B.runtime+=e,y.pause&&(B.ge=O.le),M.T<=0&&(B.ge=O.de);var a=Pe.findIndex(e=>e.we>B.runtime)-1,r=Pe[a<0?Pe.length-1:a];if(-2==a&&0===N.length&&(B.ge=O.WIN),r){for(a!==B.ce&&(B.ce=a,r.ve&&Ve(r.ve),r.ke?.());r.xe&&B.he>r.xe;)0<r.be.length&&Ve(ee(r.be)),B.he-=r.xe;B.he+=e}break;case O.WIN:case O.de:case O.pe:A.enter&&(B.selectedIndex=0,ue(ie[0]),B.ge=O.Pe);break;case O.Pe:y.enter&&Xe(ie[B.selectedIndex]),y.up&&0<B.selectedIndex&&B.selectedIndex--,y.down&&B.selectedIndex<ie.length-1&&B.selectedIndex++;break;case O.ie:y.up&&0<B.selectedIndex&&B.selectedIndex--,y.down&&B.selectedIndex<B.me.length-1&&B.selectedIndex++,y.enter&&((a=B.me[B.selectedIndex]).X(),M.me.push(a),B.ge=O.RUNNING);break;case O.le:(y.pause||y.enter)&&(B.ge=O.RUNNING)}},Fe=()=>{for(var e in y)y[e]=!1},_e=e=>{let a=0,r=0;A.up&&--r,A.down&&(r+=1),A.left&&--a,A.right&&(a+=1);var t,s,n=M.C.G.A*e,d=u(a,r),d=(0<d&&(M.x+=a/d*n,M.y+=r/d*n),o),n=i;M.L=$(A.targetY-n,A.targetX-d),M.re>=M.te&&(M.W+=1,M.re-=M.te,M.te+=10,n=le.filter(a=>!(a.condition&&!a.condition()||M.me.filter(e=>e===a).length>=(a._??5))).map(e=>({A:e,weight:e.Ae?.()??me})),B.me=Z(n,3),0<B.me.length&&(B.ge=O.ie,B.selectedIndex=0),M.T+=5),0<M.ne&&(M.ne-=e),0<M.oe&&(M.oe-=e),M.T=Y(M.C.T.A,M.T+M.C.H.A*e);for(t of M.Y)t.D+=e,t.M<=0?(s=t.K.u[t.W],t.K.D(t,s),t.M=s.R*M.C.$.A):t.M-=e},ze=e=>{let a=0;var r,t=[];for(r of Ie){var s,n=M.x-r.x,d=M.y-r.y,o=u(n,d);o<10?(M.T=Y(M.C.T.A,M.T+(r.T??0)),M.re+=r.re??0,M.oe=.1,t.push(a)):o<M.C.V.A&&(s=(M.C.V.A+10-o)*e*2,r.x+=n/o*s,r.y+=d/o*s),a++}let i=0;for(let e of t)Ie.splice(e-i,1),i+=1},Je=0,Qe=e=>{requestAnimationFrame(Qe);var a=(e-Je)/1e3;Je=e,D.reset(),D.clearRect(0,0,p,s),D.translate(-M.x+o,-M.y+i),Te(),Oe(),Le(),Me(),D.resetTransform(),je(),Ge(),e=a,qe(e),B.ge===O.RUNNING&&(He(e),ze(e),_e(e)),Fe()};return U.appendChild(te),requestAnimationFrame(Qe),[M,B]}