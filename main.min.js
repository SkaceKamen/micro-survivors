function microSurvivors(y=document.body){let s=["WASD/Arrows to move","Mouse to aim","Survive","Kill end boss"];function n(e){var a=Math.floor(e/60),e=Math.floor(e%60);return a.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0")}let c=e=>(e*(180/Math.PI)).toFixed(0),d=(e,a=0)=>e.toFixed(a),F=(e,a,t,r)=>Math.hypot(t-e,r-a);let _=e=>e[Math.round(Math.random()*(e.length-1))];let w=(e,a,t,r,s)=>{var n,i,o=a,h=t/2;15*s.length<r&&(e+=t/4);for([n,i]of s)b.text(e,a,n+":","#aaa"),b.text(e+h-5,a,""+i,"#fff","right"),o+r<(a+=15)&&(a=o,e+=h)};var o;let N=400,U=400,{canvas:u,t:k}=(r=N,e=U,(t=document.createElement("canvas")).width=r,t.height=e,r=t.getContext("2d")??(()=>{throw new Error})(),{canvas:t,t:r}),b=(o=k,{rect(e,a,t,r,s){o.fillStyle=s,o.fillRect(e,a,t,r)},i(){o.fillStyle="rgba(0,0,0,0.9)",o.fillRect(0,0,N,U)},o(e,a,t,r){o.fillStyle=r,o.fillRect(e-t/2,a-t/2,t,t)},h(e,a,t,r){o.fillStyle=r,o.beginPath(),o.moveTo(e,a-t/2),o.lineTo(e-t/2,a+t/2),o.lineTo(e+t/2,a+t/2),o.fill()},text(e,a,t,r,s="left",n="top",i=14){o.font=i+"px monospace",o.fillStyle=r,o.textAlign=s,o.textBaseline=n,o.fillText(t,e,a)},l(e,a,t,r){o.fillStyle=r,o.beginPath(),o.arc(e,a,t,0,2*Math.PI),o.fill()}}),R={arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right",w:"up",s:"down",a:"left",d:"right",enter:"enter",escape:"pause",p:"pause"},I={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1,targetX:0,targetY:0},L={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1},a=(e,a)=>{e=R[e.key.toLowerCase()];e&&(I[e]=a,L[e]=a)},O=(document.addEventListener("keydown",e=>a(e,!0)),document.addEventListener("keyup",e=>a(e,!1)),u.addEventListener("mousemove",e=>{I.targetX=e.clientX,I.targetY=e.clientY}),{g:0,m:1,M:2});var e={name:"Saw Blades",type:O.g,v:[{damage:5,range:50,u:Math.PI/2,k:.1,R:1,size:10},{damage:5,range:50,u:Math.PI/2,k:.1,R:2,size:10},{damage:10,range:50,u:Math.PI/1.5,k:.1,R:2,size:10},{damage:10,range:50,u:Math.PI/1.25,k:.1,R:2,size:15},{damage:10,range:50,u:Math.PI/1.25,k:.1,R:3,size:15},{damage:15,range:50,u:Math.PI/1.25,k:.1,R:3,size:15},{damage:15,range:50,u:Math.PI/1.25,k:.1,R:4,size:15}]},t={name:"Sword",type:O.m,v:[{damage:8,angle:Math.PI/4,range:80,S:.5},{damage:13,angle:Math.PI/4,range:80,S:.5},{damage:13,angle:Math.PI/4*1.2,range:90,S:.5},{damage:18,angle:Math.PI/4*1.2,range:90,S:.5},{damage:23,angle:Math.PI/4*1.2,range:90,S:.5},{damage:28,angle:Math.PI/4*1.5,range:90,S:.5},{damage:33,angle:Math.PI/4*1.7,range:120,S:.5}]},r={name:"Barbed Wire",type:O.M,v:[{range:40,damage:2,S:.75},{range:60,damage:2,S:.75},{range:60,damage:3,S:.75},{range:70,damage:3,S:.75},{range:80,damage:3,S:.75},{range:80,damage:4,S:.75}]};let i=e=>({type:e,T:0,D:0,level:0});var h=t=>(e,a)=>a+e.level*t,p=e=>()=>e;let H={A:[t],C:{health:[p(100),h(10)],speed:[p(45),h(.2)],healthRegen:[p(.1),h(.01)],pickupDistance:[p(50)],damage:[h(.3)],attackSpeed:[p(1)],healthDrop:[p(.01)]}};var h=(a,t)=>e=>e.C[a].push("base",(e,a)=>a+t),p=(a,t)=>e=>e.C[a].push("multiplier",(e,a)=>a*t),l=(o,e)=>{let h;return{name:e,description:()=>{var e=h?.P??$.A.find(e=>e.type===o);if(!e)return"New weapon";if(h?.level===e.level)return h.B;var a,t,r=e.type.v[e.level],s=e.type.v[e.level+1],n=[];for(a in s)s[a]!==r[a]&&(t=s[a]-r[a],t="angle"===a?c(t)+"°":d(t),n.push(`+${t} `+a));var i=n.join(", ");return h={level:e.level,P:e,B:i},i},weight:1,apply:e=>{var a=e.A.find(e=>e.type===o);a?a.level++:e.A.push(i(o))},N:o.v.length}};let J=[{name:"Speed boost",description:"+25% speed",weight:1,apply:p("speed",1.25),N:5},{name:"Speed base",description:"+1 base speed",weight:1,apply:h("speed",1),N:5},{name:"Heal",description:"+25 health",weight:1,U:e=>e.health+25<e.C.health.value,apply:e=>e.health+=25,N:5},{name:"Max health",description:"+25 max health, +5 health",weight:1,apply:e=>{e.C.health.push("base",(e,a)=>a+25),e.health+=5},N:5},{name:"Health drop",description:"+1% health drop chance",weight:1,apply:h("healthDrop",.01),N:5},{name:"Regen",description:"+0.1/s health regen",weight:1,apply:h("healthRegen",.1),N:5},{name:"Regen boost",description:"+5% health regen",weight:1,apply:p("healthRegen",1.05),N:5},{name:"Pickup range",description:"+10 pickup range",weight:1,apply:h("pickupDistance",10),N:5},{name:"Damage",description:"+1 damage",weight:1,apply:h("damage",1),N:5},{name:"Attack speed",description:"+5% attack speed",weight:1,apply:h("attackSpeed",-.05),N:5},l(e,"Saw Blades"),l(t,"Sword"),l(r,"Barbed Wire")],f=(e=[],a=[])=>({push(e,a){this[e]=[...this[e],a]},I:[...e],L:[...a],O:null,get value(){var e;return this.O?.I===this.I&&this.O?.L===this.L&&this.O?.H===$.level?this.O.value:(e=this.I.reduce((e,a)=>a($,e),0)*this.L.reduce((e,a)=>a($,e),1),this.O={I:this.I,L:this.L,H:$.level,value:e},e)}}),W=e=>({type:e,x:0,y:0,level:0,W:0,$:5,health:100,K:0,Y:0,G:0,V:0,C:{speed:f(e.C.speed),health:f(e.C.health),healthRegen:f(e.C.healthRegen),pickupDistance:f(e.C.pickupDistance),damage:f(e.C.damage),attackSpeed:f(e.C.attackSpeed),healthDrop:f(e.C.healthDrop)},X:[],A:e.A.map(e=>i(e))}),$=W(H),K={RUNNING:0,j:1,q:2,F:3,WIN:4,_:5},Y={J:-1,runtime:0,Z:0,ee:0,ae:0,X:[],te:0},G={state:K._,...Y};let g=(e,n)=>(t,r,s)=>{e.forEach((e,a)=>{b.o(t+a,r+a,n,s??e)})};var p=(e,n)=>(t,r,s)=>{e.forEach((e,a)=>{b.h(t+a,r+a,n,s??e)})},h=(e,n)=>(t,r,s)=>{e.forEach((e,a)=>{b.l(t+a,r+a,n,s??e)})},e={health:10,speed:26,damage:1,D:1,W:1,size:10,re:g(["#aaa"],10)},t={health:50,speed:26,damage:1,D:1,W:2,size:10,re:g(["#aaa","#faa"],10)},l={health:100,speed:30,damage:2,D:1,W:3,size:10,re:g(["#aaa","#faa","#4a4"],10)},r={health:20,speed:35,damage:2,D:1,W:2,size:10,re:p(["#999"],10)},m={health:40,speed:35,damage:2,D:1,W:3,size:10,re:p(["#999","#0ac"],10)},M={health:60,speed:35,damage:3,D:1,W:4,size:10,re:p(["#999","#0ac","#966"],10)},v={health:10,speed:40,damage:1,D:1,W:3,size:10,re:h(["#999"],5)},x={health:20,speed:40,damage:1,D:1,W:4,size:10,re:h(["#999","#0ac"],5)},S={health:50,speed:40,damage:1,D:1,W:5,size:10,re:h(["#999","#0ac","#4ca"],5)};let V=[{from:0,types:[e],rate:.4},{from:30,types:[e,r],rate:.4},{from:80,types:[e,r],rate:.1},{from:120,types:[r],rate:.2,se:{health:500,speed:30,damage:10,D:1,W:20,size:20,re:(e,a,t)=>g(["#faa"],20),se:!0}},{from:150,types:[r,v],rate:.3},{from:200,types:[r,v],rate:.15},{from:250,types:[t],rate:.2},{from:300,types:[t,m,v],rate:.2},{from:330,types:[m,v],se:{health:1e3,speed:35,damage:10,D:1,W:50,se:!0,ne:80,size:20,re:p(["#faa"],20)},rate:.2},{from:380,types:[m,x,t],rate:.15},{from:450,types:[x,l],rate:.15},{from:500,types:[l,M],rate:.1},{from:550,types:[l,M],rate:.1},{from:600,types:[l,M,S],rate:.1},{from:650,types:[l,M],se:{health:1e3,speed:40,damage:5,D:1,W:4,se:!0,ne:80,size:16,re:h(["#faa"],8)},rate:.15},{from:700,types:[l,M,S],rate:.1},{from:720,types:[],rate:0,se:{health:1e4,speed:55,damage:5,D:1,W:0,se:!0,ne:1e3,size:50,re:(e,a,t)=>{b.l(e,a,25,t??"#faa"),b.o(e,a,25,t??"#0ac"),b.h(e,a,23,t??"#faa")}}}],E=(e,a,t)=>({x:e,y:a,type:t,health:t.health,D:0,ie:0,oe:0,he:0,se:!!t.se}),X=[],j={ce:0,de:1},q=[];function T(e,a,t){var r,s=[["Base damage",d($.C.damage.value)],["Attack speed",d($.C.attackSpeed.value,2)],["Health",Math.floor($.C.health.value)],["Regeneration",d($.C.healthRegen.value,2)+"/s"],["Speed",d($.C.speed.value,2)],["Health Drop",d(100*$.C.healthDrop.value)+"%"]];for(r of $.A){var n=r.type.name;switch(r.type.type){case O.m:var i=r.type.v[r.level];s.push([n+" level",r.level+1]),s.push([n+" damage",d(i.damage)]),s.push([n+" range",d(i.range)]),s.push([n+" angle",c(i.angle)+"°"]);break;case O.g:i=r.type.v[r.level];s.push([n+" level",r.level+1]),s.push([n+" damage",d(i.damage)]),s.push([n+" range",d(i.range)]),s.push([n+" blades",d(i.R)]),s.push([n+" size",d(i.size)]);break;case O.M:var o=r.type.v[r.level];s.push([n+" level",r.level+1]),s.push([n+" damage",d(o.damage)]),s.push([n+" range",d(o.range)])}}w(e,a,t,U-a-20,s)}function D(e,a,t){var r;for(r of[["Survived for",n(G.runtime)],["Level",""+($.level+1)],["Damage done",d(G.Z)],["DPS",""+d(G.Z/G.runtime,2)],["Kills",""+G.ee]])b.text(e+t/2-5,a,r[0],"#ccc","right"),b.text(e+t/2+5,a,r[1],"#fff","left"),a+=15;return a}function z(){if(G.state!==K._&&(b.rect(50,0,N-50,20,"#600"),b.rect(50,0,$.health/$.C.health.value*(N-50),20,"#f66"),b.text(52,10,Math.floor($.health)+" / "+Math.floor($.C.health.value),"#fff","left","middle"),b.rect(50,20,N-50,12,"#999"),b.rect(50,20,$.W/$.$*(N-50),12,"#fff"),b.text(52,27,$.W+" / "+$.$,"#000","left","middle"),b.rect(0,0,50,32,"#000"),b.text(25,2,"level","#666","center","top"),b.text(25,18,""+($.level+1),"#fff","center","top"),b.text(N/2,35,n(G.runtime),"#fff","center"),G.runtime<20)){let e=U-30-15*s.length;for(var a of s)b.text(10,e,a,"#fff","left","top"),e+=15}switch(G.state){case K.j:b.i(),b.text(N/2,100,"YOU'RE DEAD!","#f88","center","top",24),e=D(50,145,N-100),e+=30,b.text(N/2,e,"Press ENTER to restart","#fff","center");break;case K.q:b.i(),b.text(N/2,10,"LEVEL UP","#fff","center","top");for(let e=0;e<G.X.length;e++){let a=G.X[e];var t=$.X.filter(e=>e===a).length,r=50+50*e;k.textAlign="left",k.textBaseline="top",k.fillStyle=e===G.te?"#333":"#222",k.fillRect(20,r,N-40,40),k.strokeStyle=e===G.te?"#aa3":"#444",k.strokeRect(20,r,N-40,40),k.fillStyle="#fff",k.fillText(a.name,25,5+r),k.fillStyle="#ccc",k.fillText("function"==typeof a.description?a.description():a.description,25,22+r),b.text(20+N-50,20+r,t+"/"+a.N,"#ccc","right","middle")}T(20,210,N-40);break;case K.F:b.i(),b.text(N/2,100,"PAUSED","#fff","center","middle"),T(20,110,N-40);break;case K.WIN:b.i(),b.text(N/2,100,"YOU WON","#fff","center","middle");var e=D(100,130,N-200);e+=30,b.text(N/2,e,"Press ENTER to restart","#fff","center");break;case K._:b.i(),b.text(N/2,U/2-40,"MICRO","#fff","center","bottom",68),b.text(N/2,U/2-40,"SURVIVORS","#fff","center","top",38),b.text(N/2,U-5,"by Kamen","#ccc","center","bottom",10),k.globalAlpha=.5+.5*(.5*Math.cos(performance.now()/1e3*5)+.5),b.text(N/2,U/2+50,"Press ENTER to start","#fff","center"),k.globalAlpha=1}}function A(){k.reset(),k.clearRect(0,0,u.width,u.height),k.translate(-$.x+N/2,-$.y+U/2);var e,a,t,r,s=50*Math.floor(($.x-N/2)/50),n=50*Math.floor(($.y-U/2)/50),i=50*Math.ceil(($.x+N/2)/50),o=50*Math.ceil(($.y+U/2)/50);for(let a=s;a<i;a+=50)for(let e=n;e<o;e+=50)b.rect(a,e,50,50,a%100==0?e%100==0?"#000":"#111":e%100==0?"#111":"#000");for(e of q)b.o(e.x-3,e.y-3,10<=(e.W??0)?8:6,0<(e.health??0)?"#0c0":(e.W??0)<10?"#05f":"#ff0");for(a of $.A)switch(a.type.type){case O.g:var h=a.type.v[a.level],c=2*Math.PI/h.R,d=a.T*h.u;for(let e=0;e<h.R;e++){var p=d+c*e,l=$.x+Math.cos(p)*h.range,p=$.y+Math.sin(p)*h.range;b.l(l,p,h.size/2,"#fff")}break;case O.m:var f=a.type.v[a.level],g=f.S*$.C.attackSpeed.value,g=.2*(a.D/g);0<g&&(m=f.angle/2,k.fillStyle=`rgba(255,255,255,${g})`,k.beginPath(),k.moveTo($.x,$.y),k.lineTo($.x+Math.cos($.V-m)*f.range,$.y+Math.sin($.V-m)*f.range),k.arc($.x,$.y,f.range,$.V-m,$.V+m),k.lineTo($.x,$.y),k.fill());break;case O.M:var g=a.type.v[a.level],f=g.S*$.C.attackSpeed.value,m=a.D/f,M=.15+.02*Math.cos(2*m*Math.PI);b.l($.x,$.y,g.range,`rgba(255,0,0,${M})`)}b.rect($.x-5,$.y-5,10,10,"#fff");for(t of X){var v=t.type;v.re(t.x,t.y,0<t.he?"#fff":void 0),v.se&&(b.rect(t.x-20,t.y+15,40,3,"#333"),b.rect(t.x-20,t.y+15,t.health/v.health*40,3,"#f33"))}k.resetTransform(),0<(s=Math.min(1,$.Y/.5))&&((r=k.createRadialGradient(N/2,U/2,80,N/2,U/2,N/2)).addColorStop(0,"rgba(255,0,0,0)"),r.addColorStop(1,`rgba(255,0,0,${s})`),k.fillStyle=r,k.fillRect(0,0,N,U)),0<(s=Math.min(1,$.G/.1))&&((r=k.createRadialGradient(N/2,U/2,130,N/2,U/2,N/2)).addColorStop(0,"rgba(255,255,255,0)"),r.addColorStop(1,`rgba(255,255,255,${.15*s})`),k.fillStyle=r,k.fillRect(0,0,N,U)),z()}function C(s){var e,a,t,r=s;switch(G.state){case K.RUNNING:(G.runtime+=r,L.pause)?G.state=K.F:$.health<=0?G.state=K.j:(a=V.findIndex(e=>e.from>G.runtime)-1,e=V[a<0?V.length-1:a],-2==a&&0===X.length&&(G.state=K.WIN),e&&(a!==G.J&&(G.J=a,e.se)&&Q(e.se),G.ae>e.rate?(0<e.types.length&&Q(_(e.types)),G.ae=0):G.ae+=r));break;case K.WIN:case K.j:case K._:I.enter&&(()=>{for(var e in $=W(H),Y)G[e]=Y[e];G.state=K.RUNNING,X.length=0,q.length=0})();break;case K.q:L.up&&0<G.te&&G.te--,L.down&&G.te<G.X.length-1&&G.te++,L.enter&&((a=G.X[G.te]).apply($),$.X.push(a),G.state=K.RUNNING);break;case K.F:(L.pause||L.enter)&&(G.state=K.RUNNING)}if(G.state===K.RUNNING){{var n,i=s;let t=0,r=[];for(n of X){var o=n.type;if(n.health<=0)q.push({x:n.x,y:n.y,type:j.de,W:o.W}),Math.random()<$.C.healthDrop.value&&q.push({x:n.x-5+10*Math.random(),y:n.y-5+10*Math.random(),type:j.ce,health:10}),G.ee+=1,r.push(t);else{0<n.he&&(n.he-=i);let e=n.ie*i,a=n.oe*i;var h,c=$.x-n.x,d=$.y-n.y,p=Math.sqrt(c*c+d*d);!n.se&&p>3*N?r.push(t):(n.D<=0?(p<n.type.size-2&&($.health-=o.health,$.Y=.5,n.D=o.D),h=o.speed*i,e+=c/p*h,a+=d/p*h):n.D-=i,n.x+=e,n.y+=a,!(.1<Math.abs(n.ie))||(c=(0<n.ie?-1:1)*i*(o.ne??20),Math.abs(c)>Math.abs(n.ie))?n.ie=0:n.ie+=c,!(.1<Math.abs(n.oe))||(d=(0<n.oe?-1:1)*i*(o.ne??20),Math.abs(d)>Math.abs(n.oe))?n.oe=0:n.oe+=d)}t++}let a=0;for(let e of r)X.splice(e-a,1),a+=1}{var l,f=s;let e=0,a=[];for(l of q){var g,m=$.x-l.x,M=$.y-l.y,v=Math.sqrt(m*m+M*M);if(v<10){switch(l.type){case j.ce:$.health=Math.min($.C.health.value,$.health+(l.health??0));break;case j.de:$.W+=l.W??0}$.G=.1,a.push(e)}else v<$.C.pickupDistance.value&&(g=($.C.pickupDistance.value+10-v)*f*2,l.x+=m/v*g,l.y+=M/v*g);e++}let t=0;for(let e of a)q.splice(e-t,1),t+=1}{var u=s;let e=0,a=0;I.up&&--a,I.down&&(a+=1),I.left&&--e,I.right&&(e+=1);var k,s=$.C.speed.value*u,b=Math.sqrt(e*e+a*a);0<b&&($.x+=e/b*s,$.y+=a/b*s),b=N/2,s=U/2,$.V=Math.atan2(I.targetY-s,I.targetX-b),$.W>=$.$&&($.level+=1,$.W-=$.$,$.$+=10,s=J.filter(a=>!(a.U&&!a.U($)||a.N&&$.X.filter(e=>e===a).length>=a.N)),G.X=(a=>{for(let e=a.length-1;0<=e;e--){var t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}return a})(s).slice(0,3),0<G.X.length&&(G.state=K.q),$.health+=5),0<$.Y&&($.Y-=u),0<$.G&&($.G-=u),$.health=Math.min($.C.health.value,$.health+$.C.healthRegen.value*u);for(k of $.A)switch(k.T+=u,k.type.type){case O.g:var y=k.type.v[k.level],w=y.damage+$.C.damage.value;if(k.D<=0){k.D=y.k*$.C.attackSpeed.value;var R=2*Math.PI/y.R,x=k.T*y.u;for(let e=0;e<y.R;e++){var S,E=x+R*e,T=$.x+Math.cos(E)*y.range,D=$.y+Math.sin(E)*y.range;for(S of X)F(S.x,S.y,T,D)<y.size/2+S.type.size+2&&(S.health-=w,S.he=.1,S.ie=20*Math.cos(E),S.oe=20*Math.sin(E),G.Z+=w)}}else k.D-=u;break;case O.m:0<k.D?k.D-=u:(((e,a)=>{var t,r=a.v[e.level],s=r.damage+$.C.damage.value,a=r.angle/2,n=$.V-a,i=$.V+a;for(t of X){var o=t.x-$.x,h=t.y-$.y,c=Math.atan2(h,o),o=Math.sqrt(o*o+h*h),h=Math.atan2(t.type.size/2,o);n<c+h&&c-h<i&&o-t.type.size/2<r.range&&(t.health-=s,t.he=.1,t.ie=25*Math.cos(c),t.oe=25*Math.sin(c),G.Z+=s)}})(k,k.type),k.D=k.type.v[k.level].S*$.C.attackSpeed.value);break;case O.M:if(0<k.D)k.D-=u;else{var z,A=k.type.v[k.level],C=A.damage+$.C.damage.value;for(z of X){var P=z.x-$.x,B=z.y-$.y;let e=Math.sqrt(P*P+B*B);e<A.range&&(z.health-=C,z.he=.1,G.Z+=C)}k.D=k.type.v[k.level].S*$.C.attackSpeed.value}}}}for(t in L)L[t]=!1}function Q(e){var a=Math.random()*Math.PI*2,t=Math.max(N,U)/2,t=Math.sqrt(t*t*2)+15*Math.random();X.push(E($.x+Math.cos(a)*t,$.y+Math.sin(a)*t,e))}let P=0;window.pe={le:e=>{for(var[a,t]of Object.entries(e))$[a]=t},fe:e=>{for(var[a,t]of Object.entries(e))G[a]=t}},y.appendChild(u),requestAnimationFrame(function e(a){requestAnimationFrame(e);var t=(a-P)/1e3;P=a,A(),C(t)})}