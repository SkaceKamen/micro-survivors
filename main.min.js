function microSurvivors(O=document.body,p=400,o=400){let L=["WASD/Arrows to move","Mouse to aim","Survive","Kill end boss"],m=p/2,i=o/2,{floor:d,ceil:$,random:c,round:M,cos:l,sin:h,min:K,hypot:u,abs:f,atan2:W,PI:t}=Math,g=2*t;var e="Press ENTER to ";let Y=e+"start",G=e+"restart",s="center",v="top",R="left",H="right",V="middle";e="addEventListener";let w="#fff",j="#aaa",n="#faa",q="#0ac",F=(e,a=2,r="0")=>e.toString().padStart(a,r),X=e=>F(d(e/60))+":"+F(d(e%60));let _=e=>b(e*(180/t))+"Â°",b=(e,a=0)=>e.toFixed(a),J=(e,a,r,t)=>u(r-e,t-a),Q=a=>{for(let e=a.length-1;0<=e;e--){var r=d(c()*(e+1));[a[e],a[r]]=[a[r],a[e]]}return a},Z=e=>e[M(c()*(e.length-1))],x=e=>S.fillStyle=e,k={rect(e,a,r,t,s,n){S[n?"strokeStyle":"fillStyle"]=s,S[n?"strokeRect":"fillRect"](e,a,r,t)},t(e="#000000e5"){x(e),S.fillRect(0,0,p,o)},o(e,a,r,t){x(t),S.fillRect(e-r/2,a-r/2,r,r)},m(e,a,r,t){x(t),S.beginPath(),S.moveTo(e,a-r/2),S.lineTo(e-r/2,a+r/2),S.lineTo(e+r/2,a+r/2),S.fill()},text(e,a,r,t,s=R,n=v,o=14){S.font=o+"px monospace",x(t),S.textAlign=s,S.textBaseline=n,S.fillText(r,e,a)},i(e,a,r,t){x(t),S.beginPath(),S.arc(e,a,r,0,g),S.fill()}},ee=(e,a,r,t,s)=>{var n,o,m=a,i=r/2;15*(s.length-1)<=t&&(e+=r/4);for([n,o]of s)k.text(e,a,n+":",j),k.text(e+i-5,a,""+o,w,H),m+t<(a+=15)&&(a=m,e+=i)},ae=(e,a,r)=>{e=S.createRadialGradient(m,i,e,m,i,m);return e.addColorStop(0,a),e.addColorStop(1,r),e},r=document.createElement("canvas"),S=(r.width=p,r.height=o,r.getContext("2d")??(()=>{throw new Error})()),re={arrowup:"up",arrowdown:"down",arrowleft:R,arrowright:H,w:"up",s:"down",a:R,d:H,enter:"enter",escape:"pause",p:"pause"},D={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1,targetX:0,targetY:0},y={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1},te=(e,a)=>{e=re[e.key.toLowerCase()];e&&(D[e]=a,y[e]=a)};var a=document[e],a=(a("keydown",e=>te(e,!0)),a("keyup",e=>te(e,!1)),r[e]("mousemove",e=>{var a=r.getBoundingClientRect();D.targetX=e.clientX-a.left,D.targetY=e.clientY-a.top}),e=>{let r=e[0],t=[e[0]];return e.forEach((e,a)=>{r={...r,...e},t[a]=r}),t}),e={l:"Saw Blades",h:a([{u:10,g:50,v:t/1.5,R:.1,k:1,size:10},{k:2},{u:15,v:t/1.25},{v:+t,size:15},{k:3},{u:20},{k:4}]),S(e,a){var r=a.u+P.A.u.D,t=g/a.k,s=e.S*a.v;for(let e=0;e<a.k;e++){var n,o=s+t*e,m=P.x+l(o)*a.g,i=P.y+h(o)*a.g;for(n of N)J(n.x,n.y,m,i)<a.size/2+n.type.size+2&&(n.C-=r,n.T=.1,n.P=20*l(o),n.U=20*h(o),z.B+=r)}},I(e,a){var r=g/a.k,t=e.S*a.v;for(let e=0;e<a.k;e++){var s=t+r*e,n=P.x+l(s)*a.g,s=P.y+h(s)*a.g;k.i(n,s,a.size/2,w)}},N:(e,a,r)=>[["damage",A(a.u,r?.u)],["range",A(a.g,r?.g)],["speed",A(a.v,r?.v),e=>_(e)+"/s"],["blades",A(a.k,r?.k)],["size",A(a.size,r?.size)]]};let A=(e,a)=>a?a-e:e;var E={l:"Sword",h:a([{u:8,angle:t/4,g:80,R:.5},{u:13},{angle:t/4*1.2,g:90},{u:18},{u:23},{u:28,angle:t/4*1.5},{u:33,angle:t/4*1.7,g:120}]),S(e,a){var r,t=a.u+P.A.u.D,s=a.angle/2,n=P.O-s,o=P.O+s;for(r of N){var m=r.x-P.x,i=r.y-P.y,d=W(i,m),m=u(m,i),i=W(r.type.size/2,m);n<d+i&&d-i<o&&m-r.type.size/2<a.g&&(r.C-=t,r.T=.1,r.P=25*l(d),r.U=25*h(d),z.B+=t)}},I(e,a){var r=a.R*P.A.L.D,e=.2*(e.$/r);0<e&&(r=a.angle/2,x(`rgba(255,255,255,${e})`),S.beginPath(),S.moveTo(P.x,P.y),S.lineTo(P.x+l(P.O-r)*a.g,P.y+h(P.O-r)*a.g),S.arc(P.x,P.y,a.g,P.O-r,P.O+r),S.lineTo(P.x,P.y),S.fill())},N:(e,a,r)=>[["damage",A(a.u,r?.u)],["range",A(a.g,r?.g)],["angle",A(a.angle,r?.angle),_]]},a={l:"Barbed Wire",h:a([{g:40,u:2,R:.75},{g:60},{u:3},{g:70},{g:80},{u:4}]),S(e,a){var r,t=a.u+P.A.u.D;for(r of N)J(P.x,P.y,r.x,r.y)<a.g&&(r.C-=t,r.T=.1,z.B+=t)},I(e,a){var r=a.R*P.A.L.D,e=e.$/r,r=.15+.02*l(2*e*t);k.i(P.x,P.y,a.g,`rgba(255,0,0,${r})`)},N:(e,a,r)=>[["damage",A(a.u,r?.u)],["range",A(a.g,r?.g)]]};let se=e=>({M:e,S:0,$:0,K:0});var C=e=>()=>P.K*e;let ne={W:[E],A:{C:[50,C(5)],Y:[45,C(.2)],G:[.05,C(.025)],H:[50],u:[C(.3)],L:[1],V:[.01]}};C=t=>{let s;return{l:t.l,j(){var e,a,r=s?.q??P.W.find(e=>e.M===t);return r?s?.K===r.K?s.j:(a=r.M.h[r.K],e=r.M.h[r.K+1],a=r.M.N(r,a,e).filter(e=>!!e[1]).map(([e,a,r=b])=>`+${r(a)} `+e).join(", "),s={K:r.K,q:r,j:a},a):"New weapon"},F(){var e=P.W.find(e=>e.M===t);e?e.K++:P.W.push(se(t))},X:t.h.length-1}};let oe=[{l:"Speed boost",j:"+25% speed",F(){P.A.Y._.push(.25)},X:5},{l:"Speed base",j:"+1 base speed",F(){P.A.Y.J.push(1)},X:5},{l:"Max health",j:"+25 max health, +5 health",F:()=>{P.A.C.J.push(25),P.C+=5},X:5},{l:"Health drop",j:"+1% health drop chance",F(){P.A.V.J.push(.01)},X:5},{l:"Regen",j:"+0.05/s health regen",F:()=>P.A.G.J.push(.05),X:5},{l:"Regen boost",j:"+10% health regen",F:()=>P.A.G._.push(.1),X:5},{l:"Pickup range",j:"+10 pickup range",F:()=>P.A.H.J.push(10),X:5},{l:"Damage",j:"+1 damage",F:()=>P.A.u.J.push(1),X:5},{l:"Attack speed",j:"+5% attack speed",F:()=>P.A.L.J.push(-.05),X:5},C(e),C(E),C(a)],me=e=>"function"==typeof e?e():e,T=(e=[],a=[])=>({J:[...e],_:[...a],Z:null,get D(){var e;return this.Z?.J===this.J&&this.Z?._===this._&&this.Z?.ee===P.K?this.Z.value:(e=this.J.reduce(e=(e,a)=>e+me(a),0)*this._.reduce(e,1),this.Z={J:this.J,_:this._,ee:P.K,value:e},e)}}),ie=e=>({type:e,x:0,y:0,K:0,ae:0,re:5,C:me(e.A.Y[0]),te:0,se:0,ne:0,O:0,A:{Y:T(e.A.Y),C:T(e.A.C),G:T(e.A.G),H:T(e.A.H),u:T(e.A.u),L:T(e.A.L),V:T(e.A.V)},oe:[],W:e.W.map(e=>se(e))}),P=ie(ne),U={RUNNING:0,me:1,ie:2,de:3,WIN:4,le:5},de={pe:-1,runtime:0,B:0,ce:0,he:0,oe:[],ue:0},z={state:U.le,...de};var e=e=>({...e,$:1,size:10}),E=(e,n)=>(r,t,s)=>e.map((e,a)=>k.o(r+a,t+a,n,s??e)),C=(e,n)=>(r,t,s)=>e.map((e,a)=>k.m(r+a,t+a,n,s??e)),a=(e,n)=>(r,t,s)=>e.map((e,a)=>k.i(r+a,t+a,n,s??e)),le=e({C:10,Y:26,u:10,ae:1,I:E([j],10)}),pe=e({C:50,Y:26,u:15,ae:2,I:E([j,n],10)}),B=e({C:100,Y:30,u:20,ae:3,I:E([j,n,"#4a4"],10)}),E=e({C:1e3,Y:30,u:20,ae:100,size:20,I:E([n],20),fe:!0}),ce=e({C:20,Y:35,u:10,ae:2,I:C(["#999"],10)}),he=e({C:40,Y:35,u:20,ae:3,I:C(["#999",q],10)}),I=e({C:60,Y:35,u:30,ae:4,I:C(["#999",q,"#966"],10)}),C=e({C:3e3,Y:35,u:30,ae:200,fe:!0,ge:80,size:20,I:C([n],20)}),ue=e({C:10,Y:40,u:8,ae:3,I:a(["#999"],5)}),fe=e({C:20,Y:40,u:10,ae:4,I:a(["#999",q],5)}),ge=e({C:50,Y:40,u:20,ae:5,I:a(["#999",q,"#4ca"],5)}),a=e({C:5e3,Y:40,u:20,ae:300,fe:!0,ge:80,size:16,I:a([n],8)}),e=e({C:12e3,Y:55,u:50,ae:0,fe:!0,ge:1e3,size:50,I(e,a,r){k.i(e,a,25,r??n),k.o(e,a,25,r??q),k.m(e,a,23,r??n)}});let ve=(r,e,t=1)=>Array.from({length:d((e-r)/t)}).map((e,a)=>a*t+r);var Re,we=r=>()=>{var e=ve(P.x-m,P.x+m,2*r.size),a=ve(P.y-i,P.y+i,2*r.size);e.map(e=>ke(e,P.y-i,r)),e.map(e=>ke(e,P.y+i,r)),a.map(e=>ke(P.x-m,e,r)),a.map(e=>ke(P.x+m,e,r))};let be=[{ve:0,Re:[le],we:.2},{ve:30,Re:[le,ce],we:.2},{ve:80,Re:[le,ce],we:.2},{ve:120,Re:[ce],we:.2,fe:E},{ve:150,Re:[ce,ue],we:.2},{ve:180,Re:[ce,ue],we:.2},{ve:210,Re:[pe],we:.2,be:we(pe)},{ve:240,Re:[pe,he,ue],we:.2},{ve:270,Re:[he,ue],fe:C,we:.2},{ve:300,Re:[he,fe,pe],we:.2},{ve:330,Re:[fe,B],we:.2,be:(Re=fe,()=>{var e=g/40;ve(0,g,e).map(e=>{var a=P.x+l(e)*m,e=P.y+h(e)*i;ke(a,e,Re)})})},{ve:380,Re:[B,I],we:.2},{ve:400,Re:[B,I],we:.2},{ve:450,Re:[B,I,ge],we:.2},{ve:400,Re:[B,I],fe:a,we:.2},{ve:550,Re:[B,I,ge],we:.1,be:we(I)},{ve:600,Re:[],we:0,fe:e}],xe=(e,a,r)=>({x:e,y:a,type:r,C:r.C,$:0,P:0,U:0,T:0,fe:!!r.fe}),ke=(e,a,r)=>N.push(xe(e,a,r)),N=[],Se=[],De=()=>{var e=50*d((P.x-m)/50),r=50*d((P.y-i)/50),t=50*$((P.x+m)/50),s=50*$((P.y+i)/50);for(let a=e;a<t;a+=50)for(let e=r;e<s;e+=50)k.rect(a,e,50,50,a%100==0?e%100==0?"#000":"#111":e%100==0?"#111":"#000")},ye=()=>{for(var e of P.W)e.M.I(e,e.M.h[e.K]);k.rect(P.x-5,P.y-5,10,10,w)},Ae=()=>{for(var e of N){var a=e.type;a.I(e.x,e.y,0<e.T?w:void 0),a.fe&&(k.rect(e.x-20,e.y+15,40,3,"#333"),k.rect(e.x-20,e.y+15,e.C/a.C*40,3,"#f33"))}},Ee=()=>{for(var e of Se)k.o(e.x-3,e.y-3,10<=(e.ae??0)?8:6,0<(e.C??0)?"#0c0":(e.ae??0)<10?"#05f":"#ff0")},Ce=(e,a,r)=>{var s,n=[["Base damage",b(P.A.u.D)],["Attack speed",b(2-P.A.L.D,2)],["Health",d(P.A.C.D)],["Regeneration",b(P.A.G.D,2)+"/s"],["Speed",b(P.A.Y.D,2)],["Health Drop",b(100*P.A.V.D)+"%"]];for(s of P.W){let t=s.M.l;n.push([t+" level",s.K+1],...s.M.N(s,s.M.h[s.K]).map(([e,a,r=b])=>[t+" "+e,r(a)]))}ee(e,a,r,o-a-40,n)},Te=(e,a,r)=>{var t;for(t of[["Survived",X(z.runtime)],["Level",""+(P.K+1)],["Damage",b(z.B)],["DPS",""+b(z.B/z.runtime,2)],["Kills",""+z.ce]])k.text(e+r/2-5,a,t[0],"#ccc",H),k.text(e+r/2+5,a,t[1],w,R),a+=15;return a},Pe=()=>{if(k.rect(50,0,p-50,20,"#600"),k.rect(50,0,P.C/P.A.C.D*(p-50),20,"#f66"),k.text(52,10,d(P.C)+"/"+d(P.A.C.D),w,R,V),k.rect(50,20,p-50,12,"#999"),k.rect(50,20,P.ae/P.re*(p-50),12,w),k.text(52,27,P.ae+"/"+P.re,"#000",R,V),k.rect(0,0,50,32,"#000"),k.text(25,2,"level","#666",s,v),k.text(25,18,""+(P.K+1),w,s,v),k.text(m,35,X(z.runtime),w,s),z.runtime<20){let e=o-30-15*L.length;for(var a of L)k.text(10,e,a,w,R,v),e+=15}},Ue=()=>{switch(z.state!==U.le&&Pe(),z.state){case U.me:k.t(),k.text(m,100,"YOU'RE DEAD!","#f88",s,v,24),e=Te(50,145,p-100),e+=30,k.text(m,e,G,w,s);break;case U.ie:k.t(),k.text(m,10,"LEVEL UP",w,s,v);for(let e=0;e<z.oe.length;e++){let a=z.oe[e];var r=P.oe.filter(e=>e===a).length,t=50+50*e;k.rect(20,t,p-40,40,e===z.ue?"#333":"#222"),k.rect(20,t,p-40,40,e===z.ue?"#aa3":"#444",!0),k.text(25,5+t,a.l,w),k.text(25,22+t,"function"==typeof a.j?a.j():a.j,"#ccc"),k.text(20+p-50,20+t,r+"/"+a.X,"#ccc",H,V)}Ce(20,210,p-40);break;case U.de:k.t(),k.text(m,40,"PAUSED",w,s,V),Ce(20,80,p-40);break;case U.WIN:k.t(),k.text(m,100,"YOU WON",w,s,V);var e=Te(100,130,p-200);e+=30,k.text(m,e,G,w,s);break;case U.le:k.t(),k.text(m,i-40,"MICRO",w,s,"bottom",68),k.text(m,i-40,"SURVIVORS",w,s,v,38),k.text(m,o-5,"by Kamen","#ccc",s,"bottom",10),S.globalAlpha=.5+.5*(.5*l(performance.now()/1e3*5)+.5),k.text(m,i+50,Y,w,s),S.globalAlpha=1}},ze=()=>{var e=K(1,P.se/.5),e=(0<e&&(e=ae(80,"#f000",`rgba(255,0,0,${e})`),k.t(e)),K(1,P.ne/.1));0<e&&(e=ae(130,"#fff0",`rgba(255,255,255,${.15*e})`),k.t(e))},Be=r=>{let t=0;var s,n=[];for(s of N){var o=s.type;if(s.C<=0)Se.push({x:s.x,y:s.y,ae:o.ae}),c()<P.A.V.D&&Se.push({x:s.x-5+10*c(),y:s.y-5+10*c(),C:2}),z.ce+=1,n.push(t);else{0<s.T&&(s.T-=r);let e=s.P*r,a=s.U*r;var m,i=P.x-s.x,d=P.y-s.y,l=u(i,d);!s.fe&&3*p<l?n.push(t):(s.$<=0?(l<s.type.size-2&&(P.C-=o.u,P.se=.5,s.$=o.$),m=o.Y*r,e+=i/l*m,a+=d/l*m):s.$-=r,s.x+=e,s.y+=a,!(.1<f(s.P))||(i=(0<s.P?-1:1)*r*(o.ge??20),f(i)>f(s.P))?s.P=0:s.P+=i,!(.1<f(s.U))||(d=(0<s.U?-1:1)*r*(o.ge??20),f(d)>f(s.U))?s.U=0:s.U+=d)}t++}let a=0;for(let e of n)N.splice(e-a,1),a+=1},Ie=e=>{var a=c()*g,r=Math.max(p,o)/2,r=u(r,r)+15*c();N.push(xe(P.x+l(a)*r,P.y+h(a)*r,e))},Ne=()=>{Object.assign(P,ie(ne)),Object.assign(z,de),z.state=U.RUNNING,N.length=0,Se.length=0},Oe=e=>{switch(z.state){case U.RUNNING:z.runtime+=e,y.pause&&(z.state=U.de),P.C<=0&&(z.state=U.me);var a=be.findIndex(e=>e.ve>z.runtime)-1,r=be[a<0?be.length-1:a];if(-2==a&&0===N.length&&(z.state=U.WIN),r){for(a!==z.pe&&(z.pe=a,r.fe&&Ie(r.fe),r.be?.());r.we&&z.he>r.we;)0<r.Re.length&&Ie(Z(r.Re)),z.he-=r.we;z.he+=e}break;case U.WIN:case U.me:case U.le:D.enter&&Ne();break;case U.ie:y.up&&0<z.ue&&z.ue--,y.down&&z.ue<z.oe.length-1&&z.ue++,y.enter&&((a=z.oe[z.ue]).F(),P.oe.push(a),z.state=U.RUNNING);break;case U.de:(y.pause||y.enter)&&(z.state=U.RUNNING)}},Le=()=>{for(var e in y)y[e]=!1},$e=e=>{let a=0,r=0;D.up&&--r,D.down&&(r+=1),D.left&&--a,D.right&&(a+=1);var t,s,n=P.A.Y.D*e,o=u(a,r),o=(0<o&&(P.x+=a/o*n,P.y+=r/o*n),m),n=i;P.O=W(D.targetY-n,D.targetX-o),P.ae>=P.re&&(P.K+=1,P.ae-=P.re,P.re+=10,n=oe.filter(a=>!(a.condition&&!a.condition()||a.X&&P.oe.filter(e=>e===a).length>=a.X)),z.oe=Q(n).slice(0,3),0<z.oe.length&&(z.state=U.ie),P.C+=5),0<P.se&&(P.se-=e),0<P.ne&&(P.ne-=e),P.C=K(P.A.C.D,P.C+P.A.G.D*e);for(t of P.W)t.S+=e,t.$<=0?(s=t.M.h[t.K],t.M.S(t,s),t.$=s.R*P.A.L.D):t.$-=e},Me=e=>{let a=0;var r,t=[];for(r of Se){var s,n=P.x-r.x,o=P.y-r.y,m=u(n,o);m<10?(P.C=K(P.A.C.D,P.C+(r.C??0)),P.ae+=r.ae??0,P.ne=.1,t.push(a)):m<P.A.H.D&&(s=(P.A.H.D+10-m)*e*2,r.x+=n/m*s,r.y+=o/m*s),a++}let i=0;for(let e of t)Se.splice(e-i,1),i+=1},Ke=0,We=e=>{requestAnimationFrame(We);var a=(e-Ke)/1e3;Ke=e,S.reset(),S.clearRect(0,0,p,o),S.translate(-P.x+m,-P.y+i),De(),Ee(),ye(),Ae(),S.resetTransform(),ze(),Ue(),e=a,Oe(e),z.state===U.RUNNING&&(Be(e),Me(e),$e(e)),Le()};return O.appendChild(r),requestAnimationFrame(We),[P,z]}