function microSurvivors(O=document.body,l=400,o=400){let L=["WASD/Arrows to move","Mouse to aim","Survive","Kill end boss"],f=l/2,m=o/2,{floor:i,ceil:$,random:c,round:M,cos:d,sin:p,min:K,hypot:h,abs:u,atan2:W,PI:t}=Math,g=2*t;var e="Press ENTER to ";let Y=e+"start",G=e+"restart",s="center",v="top",R="left",w="right",H="middle";e="addEventListener";let V=(e,a=2,r="0")=>e.toString().padStart(a,r),j=e=>V(i(e/60))+":"+V(i(e%60));let q=e=>b(e*(180/t))+"Â°",b=(e,a=0)=>e.toFixed(a),F=(e,a,r,t)=>h(r-e,t-a),X=a=>{for(let e=a.length-1;0<=e;e--){var r=i(c()*(e+1));[a[e],a[r]]=[a[r],a[e]]}return a},_=e=>e[M(c()*(e.length-1))],x=e=>S.fillStyle=e,k={rect(e,a,r,t,s,n){S[n?"strokeStyle":"fillStyle"]=s,S[n?"strokeRect":"fillRect"](e,a,r,t)},t(e="#000000e5"){x(e),S.fillRect(0,0,l,o)},o(e,a,r,t){x(t),S.fillRect(e-r/2,a-r/2,r,r)},m(e,a,r,t){x(t),S.beginPath(),S.moveTo(e,a-r/2),S.lineTo(e-r/2,a+r/2),S.lineTo(e+r/2,a+r/2),S.fill()},text(e,a,r,t,s=R,n=v,o=14){S.font=o+"px monospace",x(t),S.textAlign=s,S.textBaseline=n,S.fillText(r,e,a)},i(e,a,r,t){x(t),S.beginPath(),S.arc(e,a,r,0,g),S.fill()}},J=(e,a,r,t,s)=>{var n,o,f=a,m=r/2;15*(s.length-1)<=t&&(e+=r/4);for([n,o]of s)k.text(e,a,n+":","#aaa"),k.text(e+m-5,a,""+o,"#fff",w),f+t<(a+=15)&&(a=f,e+=m)},Q=(e,a,r)=>{e=S.createRadialGradient(f,m,e,f,m,f);return e.addColorStop(0,a),e.addColorStop(1,r),e},r=document.createElement("canvas"),S=(r.width=l,r.height=o,r.getContext("2d")??(()=>{throw new Error})()),Z={arrowup:"up",arrowdown:"down",arrowleft:R,arrowright:w,w:"up",s:"down",a:R,d:w,enter:"enter",escape:"pause",p:"pause"},D={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1,targetX:0,targetY:0},n={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1},ee=(e,a)=>{e=Z[e.key.toLowerCase()];e&&(D[e]=a,n[e]=a)};document[e]("keydown",e=>ee(e,!0)),document[e]("keyup",e=>ee(e,!1)),r[e]("mousemove",e=>{var a=r.getBoundingClientRect();D.targetX=e.clientX-a.left,D.targetY=e.clientY-a.top});var e=e=>{let r=e[0],t=[e[0]];return e.forEach((e,a)=>{r={...r,...e},t[a]=r}),t},a={l:"Saw Blades",h:e([{u:10,g:50,v:t/1.5,R:.1,k:1,size:10},{k:2},{u:15,v:t/1.25},{v:+t,size:15},{k:3},{u:20},{k:4}]),S(e,a){var r=a.u+T.A.u.D,t=g/a.k,s=e.S*a.v;for(let e=0;e<a.k;e++){var n,o=s+t*e,f=T.x+d(o)*a.g,m=T.y+p(o)*a.g;for(n of I)F(n.x,n.y,f,m)<a.size/2+n.type.size+2&&(n.C-=r,n.T=.1,n.P=20*d(o),n.U=20*p(o),U.B+=r)}},I(e,a){var r=g/a.k,t=e.S*a.v;for(let e=0;e<a.k;e++){var s=t+r*e,n=T.x+d(s)*a.g,s=T.y+p(s)*a.g;k.i(n,s,a.size/2,"#fff")}},N:(e,a,r)=>[["damage",y(a.u,r?.u)],["range",y(a.g,r?.g)],["speed",y(a.v,r?.v),e=>q(e)+"/s"],["blades",y(a.k,r?.k)],["size",y(a.size,r?.size)]]};let y=(e,a)=>a?a-e:e;var A={l:"Sword",h:e([{u:8,angle:t/4,g:80,R:.5},{u:13},{angle:t/4*1.2,g:90},{u:18},{u:23},{u:28,angle:t/4*1.5},{u:33,angle:t/4*1.7,g:120}]),S(e,a){var r,t=a.u+T.A.u.D,s=a.angle/2,n=T.O-s,o=T.O+s;for(r of I){var f=r.x-T.x,m=r.y-T.y,i=W(m,f),f=h(f,m),m=W(r.type.size/2,f);n<i+m&&i-m<o&&f-r.type.size/2<a.g&&(r.C-=t,r.T=.1,r.P=25*d(i),r.U=25*p(i),U.B+=t)}},I(e,a){var r=a.R*T.A.L.D,e=.2*(e.$/r);0<e&&(r=a.angle/2,x(`rgba(255,255,255,${e})`),S.beginPath(),S.moveTo(T.x,T.y),S.lineTo(T.x+d(T.O-r)*a.g,T.y+p(T.O-r)*a.g),S.arc(T.x,T.y,a.g,T.O-r,T.O+r),S.lineTo(T.x,T.y),S.fill())},N:(e,a,r)=>[["damage",y(a.u,r?.u)],["range",y(a.g,r?.g)],["angle",y(a.angle,r?.angle),q]]},e={l:"Barbed Wire",h:e([{g:40,u:2,R:.75},{g:60},{u:3},{g:70},{g:80},{u:4}]),S(e,a){var r,t=a.u+T.A.u.D;for(r of I)F(T.x,T.y,r.x,r.y)<a.g&&(r.C-=t,r.T=.1,U.B+=t)},I(e,a){var r=a.R*T.A.L.D,e=e.$/r,r=.15+.02*d(2*e*t);k.i(T.x,T.y,a.g,`rgba(255,0,0,${r})`)},N:(e,a,r)=>[["damage",y(a.u,r?.u)],["range",y(a.g,r?.g)]]};let ae=e=>({M:e,S:0,$:0,K:0});var E=e=>()=>T.K*e;let re={W:[A],A:{C:[50,E(5)],Y:[45,E(.2)],G:[.05,E(.025)],H:[50],u:[E(.3)],L:[1],V:[.01]}};E=t=>{let s;return{l:t.l,j(){var e,a,r=s?.q??T.W.find(e=>e.M===t);return r?s?.K===r.K?s.j:(a=r.M.h[r.K],e=r.M.h[r.K+1],a=r.M.N(r,a,e).filter(e=>!!e[1]).map(([e,a,r=b])=>`+${r(a)} `+e).join(", "),s={K:r.K,q:r,j:a},a):"New weapon"},F(){var e=T.W.find(e=>e.M===t);e?e.K++:T.W.push(ae(t))},X:t.h.length-1}};let te=[{l:"Speed boost",j:"+25% speed",F(){T.A.Y._.push(.25)},X:5},{l:"Speed base",j:"+1 base speed",F(){T.A.Y.J.push(1)},X:5},{l:"Max health",j:"+25 max health, +5 health",F:()=>{T.A.C.J.push(25),T.C+=5},X:5},{l:"Health drop",j:"+1% health drop chance",F(){T.A.V.J.push(.01)},X:5},{l:"Regen",j:"+0.05/s health regen",F:()=>T.A.G.J.push(.05),X:5},{l:"Regen boost",j:"+10% health regen",F:()=>T.A.G._.push(.1),X:5},{l:"Pickup range",j:"+10 pickup range",F:()=>T.A.H.J.push(10),X:5},{l:"Damage",j:"+1 damage",F:()=>T.A.u.J.push(1),X:5},{l:"Attack speed",j:"+5% attack speed",F:()=>T.A.L.J.push(-.05),X:5},E(a),E(A),E(e)],se=e=>"function"==typeof e?e():e,C=(e=[],a=[])=>({J:[...e],_:[...a],Z:null,get D(){var e;return this.Z?.J===this.J&&this.Z?._===this._&&this.Z?.ee===T.K?this.Z.value:(e=this.J.reduce(e=(e,a)=>e+se(a),0)*this._.reduce(e,1),this.Z={J:this.J,_:this._,ee:T.K,value:e},e)}}),ne=e=>({type:e,x:0,y:0,K:0,ae:0,re:5,C:se(e.A.Y[0]),te:0,se:0,ne:0,O:0,A:{Y:C(e.A.Y),C:C(e.A.C),G:C(e.A.G),H:C(e.A.H),u:C(e.A.u),L:C(e.A.L),V:C(e.A.V)},oe:[],W:e.W.map(e=>ae(e))}),T=ne(re),P={RUNNING:0,fe:1,me:2,ie:3,WIN:4,de:5},oe={le:-1,runtime:0,B:0,ce:0,pe:0,oe:[],he:0},U={state:P.de,...oe};var a=e=>({...e,$:1,size:10}),A=(e,n)=>(r,t,s)=>e.map((e,a)=>k.o(r+a,t+a,n,s??e)),E=(e,n)=>(r,t,s)=>e.map((e,a)=>k.m(r+a,t+a,n,s??e)),e=(e,n)=>(r,t,s)=>e.map((e,a)=>k.i(r+a,t+a,n,s??e)),fe=a({C:10,Y:26,u:10,ae:1,I:A(["#aaa"],10)}),me=a({C:50,Y:26,u:15,ae:2,I:A(["#aaa","#faa"],10)}),z=a({C:100,Y:30,u:20,ae:3,I:A(["#aaa","#faa","#4a4"],10)}),A=a({C:1e3,Y:30,u:20,ae:100,size:20,I:A(["#faa"],20),ue:!0}),ie=a({C:20,Y:35,u:10,ae:2,I:E(["#999"],10)}),de=a({C:40,Y:35,u:20,ae:3,I:E(["#999","#0ac"],10)}),B=a({C:60,Y:35,u:30,ae:4,I:E(["#999","#0ac","#966"],10)}),E=a({C:3e3,Y:35,u:30,ae:200,ue:!0,ge:80,size:20,I:E(["#faa"],20)}),le=a({C:10,Y:40,u:8,ae:3,I:e(["#999"],5)}),ce=a({C:20,Y:40,u:10,ae:4,I:e(["#999","#0ac"],5)}),pe=a({C:50,Y:40,u:20,ae:5,I:e(["#999","#0ac","#4ca"],5)}),e=a({C:5e3,Y:40,u:20,ae:300,ue:!0,ge:80,size:16,I:e(["#faa"],8)}),a=a({C:12e3,Y:55,u:50,ae:0,ue:!0,ge:1e3,size:50,I(e,a,r){k.i(e,a,25,r??"#faa"),k.o(e,a,25,r??"#0ac"),k.m(e,a,23,r??"#faa")}});let he=(r,e,t=1)=>Array.from({length:i((e-r)/t)}).map((e,a)=>a*t+r);var ue,ge=r=>()=>{var e=he(T.x-f,T.x+f,2*r.size),a=he(T.y-m,T.y+m,2*r.size);e.map(e=>we(e,T.y-m,r)),e.map(e=>we(e,T.y+m,r)),a.map(e=>we(T.x-f,e,r)),a.map(e=>we(T.x+f,e,r))};let ve=[{ve:0,Re:[fe],we:.2},{ve:30,Re:[fe,ie],we:.2},{ve:80,Re:[fe,ie],we:.2},{ve:120,Re:[ie],we:.2,ue:A},{ve:150,Re:[ie,le],we:.2},{ve:180,Re:[ie,le],we:.2},{ve:210,Re:[me],we:.2,be:ge(me)},{ve:240,Re:[me,de,le],we:.2},{ve:270,Re:[de,le],ue:E,we:.2},{ve:300,Re:[de,ce,me],we:.2},{ve:330,Re:[ce,z],we:.2,be:(ue=ce,()=>{var e=g/40;he(0,g,e).map(e=>{var a=T.x+d(e)*f,e=T.y+p(e)*m;we(a,e,ue)})})},{ve:380,Re:[z,B],we:.2},{ve:400,Re:[z,B],we:.2},{ve:450,Re:[z,B,pe],we:.2},{ve:400,Re:[z,B],ue:e,we:.2},{ve:550,Re:[z,B,pe],we:.1,be:ge(B)},{ve:600,Re:[],we:0,ue:a}],Re=(e,a,r)=>({x:e,y:a,type:r,C:r.C,$:0,P:0,U:0,T:0,ue:!!r.ue}),we=(e,a,r)=>I.push(Re(e,a,r)),I=[],N=[],be=()=>{var e=50*i((T.x-f)/50),r=50*i((T.y-m)/50),t=50*$((T.x+f)/50),s=50*$((T.y+m)/50);for(let a=e;a<t;a+=50)for(let e=r;e<s;e+=50)k.rect(a,e,50,50,a%100==0?e%100==0?"#000":"#111":e%100==0?"#111":"#000")},xe=()=>{for(var e of T.W)e.M.I(e,e.M.h[e.K]);k.rect(T.x-5,T.y-5,10,10,"#fff")},ke=()=>{for(var e of I){var a=e.type;a.I(e.x,e.y,0<e.T?"#fff":void 0),a.ue&&(k.rect(e.x-20,e.y+15,40,3,"#333"),k.rect(e.x-20,e.y+15,e.C/a.C*40,3,"#f33"))}},Se=()=>{for(var e of N)k.o(e.x-3,e.y-3,10<=(e.ae??0)?8:6,0<(e.C??0)?"#0c0":(e.ae??0)<10?"#05f":"#ff0")},De=(e,a,r)=>{var s,n=[["Base damage",b(T.A.u.D)],["Attack speed",b(2-T.A.L.D,2)],["Health",i(T.A.C.D)],["Regeneration",b(T.A.G.D,2)+"/s"],["Speed",b(T.A.Y.D,2)],["Health Drop",b(100*T.A.V.D)+"%"]];for(s of T.W){let t=s.M.l;n.push([t+" level",s.K+1],...s.M.N(s,s.M.h[s.K]).map(([e,a,r=b])=>[t+" "+e,r(a)]))}J(e,a,r,o-a-40,n)},ye=(e,a,r)=>{var t;for(t of[["Survived",j(U.runtime)],["Level",""+(T.K+1)],["Damage",b(U.B)],["DPS",""+b(U.B/U.runtime,2)],["Kills",""+U.ce]])k.text(e+r/2-5,a,t[0],"#ccc",w),k.text(e+r/2+5,a,t[1],"#fff",R),a+=15;return a},Ae=()=>{if(k.rect(50,0,l-50,20,"#600"),k.rect(50,0,T.C/T.A.C.D*(l-50),20,"#f66"),k.text(52,10,i(T.C)+"/"+i(T.A.C.D),"#fff",R,H),k.rect(50,20,l-50,12,"#999"),k.rect(50,20,T.ae/T.re*(l-50),12,"#fff"),k.text(52,27,T.ae+"/"+T.re,"#000",R,H),k.rect(0,0,50,32,"#000"),k.text(25,2,"level","#666",s,v),k.text(25,18,""+(T.K+1),"#fff",s,v),k.text(f,35,j(U.runtime),"#fff",s),U.runtime<20){let e=o-30-15*L.length;for(var a of L)k.text(10,e,a,"#fff",R,v),e+=15}},Ee=()=>{switch(U.state!==P.de&&Ae(),U.state){case P.fe:k.t(),k.text(f,100,"YOU'RE DEAD!","#f88",s,v,24),e=ye(50,145,l-100),e+=30,k.text(f,e,G,"#fff",s);break;case P.me:k.t(),k.text(f,10,"LEVEL UP","#fff",s,v);for(let e=0;e<U.oe.length;e++){let a=U.oe[e];var r=T.oe.filter(e=>e===a).length,t=50+50*e;k.rect(20,t,l-40,40,e===U.he?"#333":"#222"),k.rect(20,t,l-40,40,e===U.he?"#aa3":"#444",!0),k.text(25,5+t,a.l,"#fff"),k.text(25,22+t,"function"==typeof a.j?a.j():a.j,"#ccc"),k.text(20+l-50,20+t,r+"/"+a.X,"#ccc",w,H)}De(20,210,l-40);break;case P.ie:k.t(),k.text(f,40,"PAUSED","#fff",s,H),De(20,80,l-40);break;case P.WIN:k.t(),k.text(f,100,"YOU WON","#fff",s,H);var e=ye(100,130,l-200);e+=30,k.text(f,e,G,"#fff",s);break;case P.de:k.t(),k.text(f,m-40,"MICRO","#fff",s,"bottom",68),k.text(f,m-40,"SURVIVORS","#fff",s,v,38),k.text(f,o-5,"by Kamen","#ccc",s,"bottom",10),S.globalAlpha=.5+.5*(.5*d(performance.now()/1e3*5)+.5),k.text(f,m+50,Y,"#fff",s),S.globalAlpha=1}},Ce=()=>{var e=K(1,T.se/.5),e=(0<e&&(e=Q(80,"#ff000000",`rgba(255,0,0,${e})`),k.t(e)),K(1,T.ne/.1));0<e&&(e=Q(130,"#ffffff00",`rgba(255,255,255,${.15*e})`),k.t(e))},Te=r=>{let t=0;var s,n=[];for(s of I){var o=s.type;if(s.C<=0)N.push({x:s.x,y:s.y,ae:o.ae}),c()<T.A.V.D&&N.push({x:s.x-5+10*c(),y:s.y-5+10*c(),C:2}),U.ce+=1,n.push(t);else{0<s.T&&(s.T-=r);let e=s.P*r,a=s.U*r;var f,m=T.x-s.x,i=T.y-s.y,d=h(m,i);!s.ue&&3*l<d?n.push(t):(s.$<=0?(d<s.type.size-2&&(T.C-=o.u,T.se=.5,s.$=o.$),f=o.Y*r,e+=m/d*f,a+=i/d*f):s.$-=r,s.x+=e,s.y+=a,!(.1<u(s.P))||(m=(0<s.P?-1:1)*r*(o.ge??20),u(m)>u(s.P))?s.P=0:s.P+=m,!(.1<u(s.U))||(i=(0<s.U?-1:1)*r*(o.ge??20),u(i)>u(s.U))?s.U=0:s.U+=i)}t++}let a=0;for(let e of n)I.splice(e-a,1),a+=1},Pe=e=>{var a=c()*g,r=Math.max(l,o)/2,r=h(r,r)+15*c();I.push(Re(T.x+d(a)*r,T.y+p(a)*r,e))},Ue=()=>{Object.assign(T,ne(re)),Object.assign(U,oe),U.state=P.RUNNING,I.length=0,N.length=0},ze=e=>{switch(U.state){case P.RUNNING:U.runtime+=e,n.pause&&(U.state=P.ie),T.C<=0&&(U.state=P.fe);var a=ve.findIndex(e=>e.ve>U.runtime)-1,r=ve[a<0?ve.length-1:a];if(-2==a&&0===I.length&&(U.state=P.WIN),r){for(a!==U.le&&(U.le=a,r.ue&&Pe(r.ue),r.be?.());r.we&&U.pe>r.we;)0<r.Re.length&&Pe(_(r.Re)),U.pe-=r.we;U.pe+=e}break;case P.WIN:case P.fe:case P.de:D.enter&&Ue();break;case P.me:n.up&&0<U.he&&U.he--,n.down&&U.he<U.oe.length-1&&U.he++,n.enter&&((a=U.oe[U.he]).F(),T.oe.push(a),U.state=P.RUNNING);break;case P.ie:(n.pause||n.enter)&&(U.state=P.RUNNING)}},Be=()=>{for(var e in n)n[e]=!1},Ie=e=>{let a=0,r=0;D.up&&--r,D.down&&(r+=1),D.left&&--a,D.right&&(a+=1);var t,s,n=T.A.Y.D*e,o=h(a,r),o=(0<o&&(T.x+=a/o*n,T.y+=r/o*n),f),n=m;T.O=W(D.targetY-n,D.targetX-o),T.ae>=T.re&&(T.K+=1,T.ae-=T.re,T.re+=10,n=te.filter(a=>!(a.condition&&!a.condition()||a.X&&T.oe.filter(e=>e===a).length>=a.X)),U.oe=X(n).slice(0,3),0<U.oe.length&&(U.state=P.me),T.C+=5),0<T.se&&(T.se-=e),0<T.ne&&(T.ne-=e),T.C=K(T.A.C.D,T.C+T.A.G.D*e);for(t of T.W)t.S+=e,t.$<=0?(s=t.M.h[t.K],t.M.S(t,s),t.$=s.R*T.A.L.D):t.$-=e},Ne=e=>{let a=0;var r,t=[];for(r of N){var s,n=T.x-r.x,o=T.y-r.y,f=h(n,o);f<10?(T.C=K(T.A.C.D,T.C+(r.C??0)),T.ae+=r.ae??0,T.ne=.1,t.push(a)):f<T.A.H.D&&(s=(T.A.H.D+10-f)*e*2,r.x+=n/f*s,r.y+=o/f*s),a++}let m=0;for(let e of t)N.splice(e-m,1),m+=1},Oe=0,Le=e=>{requestAnimationFrame(Le);var a=(e-Oe)/1e3;Oe=e,S.reset(),S.clearRect(0,0,l,o),S.translate(-T.x+f,-T.y+m),be(),Se(),xe(),ke(),S.resetTransform(),Ce(),Ee(),e=a,ze(e),U.state===P.RUNNING&&(Te(e),Ne(e),Ie(e)),Be()};return O.appendChild(r),requestAnimationFrame(Le),[T,U]}