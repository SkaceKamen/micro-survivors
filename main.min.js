function microSurvivors(O=document.body,i=400,o=400){let L=["WASD/Arrows to move","Mouse to aim","Survive","Kill end boss"],p=i/2,f=o/2,{floor:l,ceil:$,random:c,round:M,cos:m,sin:h,min:H,hypot:g,abs:v,atan2:K,PI:t}=Math,u=2*t;var e="Press ENTER to ";let W=e+"start",Y=e+"restart",s="center",d="top",y="left",b="right",G="middle",V=(e,a=2,r="0")=>e.toString().padStart(a,r),j=e=>V(l(e/60))+":"+V(l(e%60));let q=e=>k(e*(180/t)),k=(e,a=0)=>e.toFixed(a),F=a=>{for(let e=a.length-1;0<=e;e--){var r=l(c()*(e+1));[a[e],a[r]]=[a[r],a[e]]}return a},X=e=>e[M(c()*(e.length-1))],x={rect(e,a,r,t,s){w.fillStyle=s,w.fillRect(e,a,r,t)},t(e="#000000e5"){w.fillStyle=e,w.fillRect(0,0,i,o)},o(e,a,r,t){w.fillStyle=t,w.fillRect(e-r/2,a-r/2,r,r)},l(e,a,r,t){w.fillStyle=t,w.beginPath(),w.moveTo(e,a-r/2),w.lineTo(e-r/2,a+r/2),w.lineTo(e+r/2,a+r/2),w.fill()},text(e,a,r,t,s=y,n=d,o=14){w.font=o+"px monospace",w.fillStyle=t,w.textAlign=s,w.textBaseline=n,w.fillText(r,e,a)},i(e,a,r,t){w.fillStyle=t,w.beginPath(),w.arc(e,a,r,0,u),w.fill()}},_=(e,a,r,t,s)=>{var n,o,p=a,f=r/2;15*s.length<t&&(e+=r/4);for([n,o]of s)x.text(e,a,n+":","#aaa"),x.text(e+f-5,a,""+o,"#fff",b),p+t<(a+=15)&&(a=p,e+=f)},J=(e,a,r)=>{e=w.createRadialGradient(p,f,e,p,f,p);return e.addColorStop(0,a),e.addColorStop(1,r),e},r=document.createElement("canvas"),w=(r.width=i,r.height=o,r.getContext("2d")??(()=>{throw new Error})()),Q={arrowup:"up",arrowdown:"down",arrowleft:y,arrowright:b,w:"up",s:"down",a:y,d:b,enter:"enter",escape:"pause",p:"pause"},R={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1,targetX:0,targetY:0},n={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1},Z=(e,a)=>{e=Q[e.key.toLowerCase()];e&&(R[e]=a,n[e]=a)};var e="addEventListener",e=(document[e]("keydown",e=>Z(e,!0)),document[e]("keyup",e=>Z(e,!1)),r[e]("mousemove",e=>{var a=r.getBoundingClientRect();R.targetX=e.clientX-a.left,R.targetY=e.clientY-a.top}),a=>{let r=a[0];var t=[a[0]];for(let e=1;e<a.length;e++)r={...r,...a[e]},t[e]=r;return t}),a={name:"Saw Blades",m:e([{damage:5,range:50,rotationSpeed:t/2,h:.1,blades:1,size:10},{blades:2},{damage:10,rotationSpeed:t/1.5},{rotationSpeed:t/1.25,size:15},{blades:3},{damage:15},{blades:4}]),g(e,a){var r,t,s,n,o=a.damage+T.v.damage.value,p=u/a.blades,f=e.g*a.rotationSpeed;for(let e=0;e<a.blades;e++){var l,d=f+p*e,i=T.x+m(d)*a.range,c=T.y+h(d)*a.range;for(l of I)r=l.x,t=l.y,s=i,n=c,g(s-r,n-t)<a.size/2+l.type.size+2&&(l.health-=o,l.u=.1,l.k=20*m(d),l.R=20*h(d),U.S+=o)}},D(e,a){var r=u/a.blades,t=e.g*a.rotationSpeed;for(let e=0;e<a.blades;e++){var s=t+r*e,n=T.x+m(s)*a.range,s=T.y+h(s)*a.range;x.i(n,s,a.size/2,"#fff")}},A:(e,a)=>[[e.name+" damage",k(a.damage)],[e.name+" range",k(a.range)],[e.name+" blades",k(a.blades)],[e.name+" size",k(a.size)]]},S={name:"Sword",m:e([{damage:8,angle:t/4,range:80,C:.5},{damage:13},{angle:t/4*1.2,range:90},{damage:18},{damage:23},{damage:28,angle:t/4*1.5},{damage:33,angle:t/4*1.7,range:120}]),g(e,a){var r,t=a.damage+T.v.damage.value,s=a.angle/2,n=T.T-s,o=T.T+s;for(r of I){var p=r.x-T.x,f=r.y-T.y,l=K(f,p),p=g(p,f),f=K(r.type.size/2,p);n<l+f&&l-f<o&&p-r.type.size/2<a.range&&(r.health-=t,r.u=.1,r.k=25*m(l),r.R=25*h(l),U.S+=t)}},D(e,a){var r=a.C*T.v.attackSpeed.value,e=.2*(e.P/r);0<e&&(r=a.angle/2,w.fillStyle=`rgba(255,255,255,${e})`,w.beginPath(),w.moveTo(T.x,T.y),w.lineTo(T.x+m(T.T-r)*a.range,T.y+h(T.T-r)*a.range),w.arc(T.x,T.y,a.range,T.T-r,T.T+r),w.lineTo(T.x,T.y),w.fill())},A:(e,a)=>[[e.name+" damage",k(a.damage)],[e.name+" range",k(a.range)],[e.name+" angle",q(a.angle)+"°"]]},e={name:"Barbed Wire",m:e([{range:40,damage:2,C:.75},{range:60},{damage:3},{range:70},{range:80},{damage:4}]),g(e,a){var r,t=a.damage+T.v.damage.value;for(r of I){var s=r.x-T.x,n=r.y-T.y;g(s,n)<a.range&&(r.health-=t,r.u=.1,U.S+=t)}},D(e,a){var r=a.C*T.v.attackSpeed.value,e=e.P/r,r=.15+.02*m(2*e*t);x.i(T.x,T.y,a.range,`rgba(255,0,0,${r})`)},A:(e,a)=>[[e.name+" damage",k(a.damage)],[e.name+" range",k(a.range)]]};let ee=e=>({type:e,g:0,P:0,level:0});var D=e=>()=>T.level*e;let ae={U:[S],v:{health:[100,D(10)],speed:[45,D(.2)],healthRegen:[.1,D(.025)],pickupDistance:[50],damage:[D(.3)],attackSpeed:[1],healthDrop:[.01]}};var D=(a,r)=>e=>e.v[a].base.push(r),A=(a,r)=>e=>e.v[a].base.push(r),C=p=>{let f;return{name:p.name,description:()=>{var e=f?.B??T.U.find(e=>e.type===p);if(!e)return"New weapon";if(f?.level===e.level)return f.I;var a,r,t=e.type.m[e.level],s=e.type.m[e.level+1],n=[];for(a in s)s[a]!==t[a]&&(r=s[a]-t[a],r="angle"===a?q(r)+"°":k(r),n.push(`+${r} `+a));var o=n.join(", ");return f={level:e.level,B:e,I:o},o},apply:e=>{var a=e.U.find(e=>e.type===p);a?a.level++:e.U.push(ee(p))},N:p.m.length}};let re=[{name:"Speed boost",description:"+25% speed",apply:A("speed",1.25),N:5},{name:"Speed base",description:"+1 base speed",apply:D("speed",1),N:5},{name:"Heal",description:"+25 health",O:e=>e.health+25<e.v.health.value,apply:e=>e.health+=25,N:5},{name:"Max health",description:"+25 max health, +5 health",apply:e=>{e.v.health.base.push(25),e.health+=5},N:5},{name:"Health drop",description:"+1% health drop chance",apply:D("healthDrop",.01),N:5},{name:"Regen",description:"+0.1/s health regen",apply:D("healthRegen",.1),N:5},{name:"Regen boost",description:"+10% health regen",apply:A("healthRegen",1.1),N:5},{name:"Pickup range",description:"+10 pickup range",apply:D("pickupDistance",10),N:5},{name:"Damage",description:"+1 damage",apply:D("damage",1),N:5},{name:"Attack speed",description:"+5% attack speed",apply:D("attackSpeed",-.05),N:5},C(a),C(S),C(e)],te=e=>"function"==typeof e?e():e,E=(e=[],a=[])=>({base:[...e],multiplier:[...a],L:null,get value(){var e;return this.L?.base===this.base&&this.L?.multiplier===this.multiplier&&this.L?.$===T.level?this.L.value:(e=this.base.reduce(e=(e,a)=>e+te(a),0)*this.multiplier.reduce(e,1),this.L={base:this.base,multiplier:this.multiplier,$:T.level,value:e},e)}}),se=e=>({type:e,x:0,y:0,level:0,M:0,H:5,health:100,K:0,W:0,Y:0,T:0,v:{speed:E(e.v.speed),health:E(e.v.health),healthRegen:E(e.v.healthRegen),pickupDistance:E(e.v.pickupDistance),damage:E(e.v.damage),attackSpeed:E(e.v.attackSpeed),healthDrop:E(e.v.healthDrop)},G:[],U:e.U.map(e=>ee(e))}),T=se(ae),P={RUNNING:0,V:1,j:2,q:3,WIN:4,F:5},ne={X:-1,runtime:0,S:0,_:0,J:0,G:[],Z:0},U={state:P.F,...ne};var A=e=>({...e,P:1,size:10}),D=(e,n)=>(r,t,s)=>e.map((e,a)=>x.o(r+a,t+a,n,s??e)),a=(e,n)=>(r,t,s)=>e.map((e,a)=>x.l(r+a,t+a,n,s??e)),S=(e,n)=>(r,t,s)=>e.map((e,a)=>x.i(r+a,t+a,n,s??e)),C=A({health:10,speed:26,damage:1,M:1,D:D(["#aaa"],10)}),e=A({health:50,speed:26,damage:1,M:2,D:D(["#aaa","#faa"],10)}),z=A({health:100,speed:30,damage:2,M:3,D:D(["#aaa","#faa","#4a4"],10)}),D=A({health:500,speed:30,damage:10,M:20,size:20,D:D(["#faa"],20),ee:!0}),oe=A({health:20,speed:35,damage:2,M:2,D:a(["#999"],10)}),pe=A({health:40,speed:35,damage:2,M:3,D:a(["#999","#0ac"],10)}),B=A({health:60,speed:35,damage:3,M:4,D:a(["#999","#0ac","#966"],10)}),a=A({health:1e3,speed:35,damage:10,M:50,ee:!0,ae:80,size:20,D:a(["#faa"],20)}),fe=A({health:10,speed:40,damage:1,M:3,D:S(["#999"],5)}),le=A({health:20,speed:40,damage:1,M:4,D:S(["#999","#0ac"],5)}),de=A({health:50,speed:40,damage:1,M:5,D:S(["#999","#0ac","#4ca"],5)}),S=A({health:1e3,speed:40,damage:5,M:4,ee:!0,ae:80,size:16,D:S(["#faa"],8)}),A=A({health:1e4,speed:55,damage:5,M:0,ee:!0,ae:1e3,size:50,D(e,a,r){x.i(e,a,25,r??"#faa"),x.o(e,a,25,r??"#0ac"),x.l(e,a,23,r??"#faa")}});let ie=(r,e,t=1)=>Array.from({length:l((e-r)/t)}).map((e,a)=>a*t+r);var ce,me=r=>()=>{var e=ie(T.x-p,T.x+p,2*r.size),a=ie(T.y-f,T.y+f,2*r.size);e.map(e=>ve(e,T.y-f,r)),e.map(e=>ve(e,T.y+f,r)),a.map(e=>ve(T.x-p,e,r)),a.map(e=>ve(T.x+p,e,r))};let he=[{from:0,types:[C],rate:.4},{from:30,types:[C,oe],rate:.5},{from:80,types:[C,oe],rate:.4},{from:120,types:[oe],rate:.3,ee:D},{from:150,types:[oe,fe],rate:.4},{from:200,types:[oe,fe],rate:.3},{from:250,types:[e],rate:.3,re:me(e)},{from:300,types:[e,pe,fe],rate:.3},{from:330,types:[pe,fe],ee:a,rate:.3},{from:380,types:[pe,le,e],rate:.3},{from:450,types:[le,z],rate:.4,re:(ce=le,()=>{var e=u/40;ie(0,u,e).map(e=>{var a=T.x+m(e)*p,e=T.y+h(e)*f;ve(a,e,ce)})})},{from:500,types:[z,B],rate:.3},{from:550,types:[z,B],rate:.25},{from:600,types:[z,B,de],rate:.25},{from:650,types:[z,B],ee:S,rate:.4},{from:700,types:[z,B,de],rate:.25,re:me(B)},{from:720,types:[],rate:0,ee:A}],ge=(e,a,r)=>({x:e,y:a,type:r,health:r.health,P:0,k:0,R:0,u:0,ee:!!r.ee}),ve=(e,a,r)=>I.push(ge(e,a,r)),I=[],N=[],ue=()=>{var e=50*l((T.x-p)/50),r=50*l((T.y-f)/50),t=50*$((T.x+p)/50),s=50*$((T.y+f)/50);for(let a=e;a<t;a+=50)for(let e=r;e<s;e+=50)x.rect(a,e,50,50,a%100==0?e%100==0?"#000":"#111":e%100==0?"#111":"#000")},ye=()=>{for(var e of T.U)e.type.D(e,e.type.m[e.level]);x.rect(T.x-5,T.y-5,10,10,"#fff")},be=()=>{for(var e of I){var a=e.type;a.D(e.x,e.y,0<e.u?"#fff":void 0),a.ee&&(x.rect(e.x-20,e.y+15,40,3,"#333"),x.rect(e.x-20,e.y+15,e.health/a.health*40,3,"#f33"))}},ke=()=>{for(var e of N)x.o(e.x-3,e.y-3,10<=(e.M??0)?8:6,0<(e.health??0)?"#0c0":(e.M??0)<10?"#05f":"#ff0")},xe=(e,a,r)=>{var t,s=[["Base damage",k(T.v.damage.value)],["Attack speed",k(T.v.attackSpeed.value,2)],["Health",l(T.v.health.value)],["Regeneration",k(T.v.healthRegen.value,2)+"/s"],["Speed",k(T.v.speed.value,2)],["Health Drop",k(100*T.v.healthDrop.value)+"%"]];for(t of T.U){var n=t.type.name;s.push([n+" level",t.level+1],...t.type.A(t,t.type.m[t.level]))}_(e,a,r,o-a-20,s)},we=(e,a,r)=>{var t;for(t of[["Survived",j(U.runtime)],["Level",""+(T.level+1)],["Damage",k(U.S)],["DPS",""+k(U.S/U.runtime,2)],["Kills",""+U._]])x.text(e+r/2-5,a,t[0],"#ccc",b),x.text(e+r/2+5,a,t[1],"#fff",y),a+=15;return a},Re=()=>{if(x.rect(50,0,i-50,20,"#600"),x.rect(50,0,T.health/T.v.health.value*(i-50),20,"#f66"),x.text(52,10,l(T.health)+"/"+l(T.v.health.value),"#fff",y,G),x.rect(50,20,i-50,12,"#999"),x.rect(50,20,T.M/T.H*(i-50),12,"#fff"),x.text(52,27,T.M+"/"+T.H,"#000",y,G),x.rect(0,0,50,32,"#000"),x.text(25,2,"level","#666",s,d),x.text(25,18,""+(T.level+1),"#fff",s,d),x.text(p,35,j(U.runtime),"#fff",s),U.runtime<20){let e=o-30-15*L.length;for(var a of L)x.text(10,e,a,"#fff",y,d),e+=15}},Se=()=>{switch(U.state!==P.F&&Re(),U.state){case P.V:x.t(),x.text(p,100,"YOU'RE DEAD!","#f88",s,d,24),e=we(50,145,i-100),e+=30,x.text(p,e,Y,"#fff",s);break;case P.j:x.t(),x.text(p,10,"LEVEL UP","#fff",s,d);for(let e=0;e<U.G.length;e++){let a=U.G[e];var r=T.G.filter(e=>e===a).length,t=50+50*e;w.textAlign=y,w.textBaseline=d,w.fillStyle=e===U.Z?"#333":"#222",w.fillRect(20,t,i-40,40),w.strokeStyle=e===U.Z?"#aa3":"#444",w.strokeRect(20,t,i-40,40),w.fillStyle="#fff",w.fillText(a.name,25,5+t),w.fillStyle="#ccc",w.fillText("function"==typeof a.description?a.description():a.description,25,22+t),x.text(20+i-50,20+t,r+"/"+a.N,"#ccc",b,G)}xe(20,210,i-40);break;case P.q:x.t(),x.text(p,100,"PAUSED","#fff",s,G),xe(20,110,i-40);break;case P.WIN:x.t(),x.text(p,100,"YOU WON","#fff",s,G);var e=we(100,130,i-200);e+=30,x.text(p,e,Y,"#fff",s);break;case P.F:x.t(),x.text(p,f-40,"MICRO","#fff",s,"bottom",68),x.text(p,f-40,"SURVIVORS","#fff",s,d,38),x.text(p,o-5,"by Kamen","#ccc",s,"bottom",10),w.globalAlpha=.5+.5*(.5*m(performance.now()/1e3*5)+.5),x.text(p,f+50,W,"#fff",s),w.globalAlpha=1}},De=()=>{var e=H(1,T.W/.5),e=(0<e&&(e=J(80,"#ff000000",`rgba(255,0,0,${e})`),x.t(e)),H(1,T.Y/.1));0<e&&(e=J(130,"#ffffff00",`rgba(255,255,255,${.15*e})`),x.t(e))},Ae=r=>{let t=0;var s,n=[];for(s of I){var o=s.type;if(s.health<=0)N.push({x:s.x,y:s.y,M:o.M}),c()<T.v.healthDrop.value&&N.push({x:s.x-5+10*c(),y:s.y-5+10*c(),health:10}),U._+=1,n.push(t);else{0<s.u&&(s.u-=r);let e=s.k*r,a=s.R*r;var p,f=T.x-s.x,l=T.y-s.y,d=g(f,l);!s.ee&&3*i<d?n.push(t):(s.P<=0?(d<s.type.size-2&&(T.health-=o.health,T.W=.5,s.P=o.P),p=o.speed*r,e+=f/d*p,a+=l/d*p):s.P-=r,s.x+=e,s.y+=a,!(.1<v(s.k))||(f=(0<s.k?-1:1)*r*(o.ae??20),v(f)>v(s.k))?s.k=0:s.k+=f,!(.1<v(s.R))||(l=(0<s.R?-1:1)*r*(o.ae??20),v(l)>v(s.R))?s.R=0:s.R+=l)}t++}let a=0;for(let e of n)I.splice(e-a,1),a+=1},Ce=e=>{var a=c()*u,r=Math.max(i,o)/2,r=g(r,r)+15*c();I.push(ge(T.x+m(a)*r,T.y+h(a)*r,e))},Ee=()=>{Object.assign(T,se(ae)),Object.assign(U,ne),U.state=P.RUNNING,I.length=0,N.length=0},Te=e=>{switch(U.state){case P.RUNNING:U.runtime+=e,n.pause&&(U.state=P.q),T.health<=0&&(U.state=P.V);var a=he.findIndex(e=>e.from>U.runtime)-1,r=he[a<0?he.length-1:a];-2==a&&0===I.length&&(U.state=P.WIN),r&&(a!==U.X&&(U.X=a,r.ee&&Ce(r.ee),r.re?.()),U.J>r.rate?(0<r.types.length&&Ce(X(r.types)),U.J=0):U.J+=e);break;case P.WIN:case P.V:case P.F:R.enter&&Ee();break;case P.j:n.up&&0<U.Z&&U.Z--,n.down&&U.Z<U.G.length-1&&U.Z++,n.enter&&((a=U.G[U.Z]).apply(T),T.G.push(a),U.state=P.RUNNING);break;case P.q:(n.pause||n.enter)&&(U.state=P.RUNNING)}},Pe=()=>{for(var e in n)n[e]=!1},Ue=e=>{let a=0,r=0;R.up&&--r,R.down&&(r+=1),R.left&&--a,R.right&&(a+=1);var t,s,n=T.v.speed.value*e,o=g(a,r),o=(0<o&&(T.x+=a/o*n,T.y+=r/o*n),p),n=f;T.T=K(R.targetY-n,R.targetX-o),T.M>=T.H&&(T.level+=1,T.M-=T.H,T.H+=10,n=re.filter(a=>!(a.O&&!a.O(T)||a.N&&T.G.filter(e=>e===a).length>=a.N)),U.G=F(n).slice(0,3),0<U.G.length&&(U.state=P.j),T.health+=5),0<T.W&&(T.W-=e),0<T.Y&&(T.Y-=e),T.health=H(T.v.health.value,T.health+T.v.healthRegen.value*e);for(t of T.U)t.g+=e,t.P<=0?(s=t.type.m[t.level],t.type.g(t,s),t.P=s.h*T.v.attackSpeed.value):t.P-=e},ze=e=>{let a=0;var r,t=[];for(r of N){var s,n=T.x-r.x,o=T.y-r.y,p=g(n,o);p<10?(T.health=H(T.v.health.value,T.health+(r.health??0)),T.M+=r.M??0,T.Y=.1,t.push(a)):p<T.v.pickupDistance.value&&(s=(T.v.pickupDistance.value+10-p)*e*2,r.x+=n/p*s,r.y+=o/p*s),a++}let f=0;for(let e of t)N.splice(e-f,1),f+=1},Be=0,Ie=e=>{requestAnimationFrame(Ie);var a=(e-Be)/1e3;Be=e,w.reset(),w.clearRect(0,0,r.width,r.height),w.translate(-T.x+p,-T.y+f),ue(),ke(),ye(),be(),w.resetTransform(),De(),Se(),e=a,Te(e),U.state===P.RUNNING&&(Ae(e),ze(e),Ue(e)),Pe()};return O.appendChild(r),requestAnimationFrame(Ie),[T,U]}