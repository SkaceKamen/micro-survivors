function microSurvivors(O=document.body,l=400,s=400){let L=["WASD/Arrows to move","Mouse to aim","Survive","Kill end boss"],o=l/2,m=s/2,{floor:f,ceil:$,random:c,round:M,cos:d,sin:p,min:K,hypot:u,abs:h,atan2:W,PI:t}=Math,i=2*t;var e="Press ENTER to ";let Y=e+"start",G=e+"restart",n="center",g="top",v="left",R="right",w="middle";e="addEventListener";let H=(e,a=2,r="0")=>e.toString().padStart(a,r),V=e=>H(f(e/60))+":"+H(f(e%60));let j=e=>b(e*(180/t))+"Â°",b=(e,a=0)=>e.toFixed(a),q=(e,a,r,t)=>u(r-e,t-a),F=a=>{for(let e=a.length-1;0<=e;e--){var r=f(c()*(e+1));[a[e],a[r]]=[a[r],a[e]]}return a},X=e=>e[M(c()*(e.length-1))],x=e=>S.fillStyle=e,k={rect(e,a,r,t,n,s){S[s?"strokeStyle":"fillStyle"]=n,S[s?"strokeRect":"fillRect"](e,a,r,t)},t(e="#000000e5"){x(e),S.fillRect(0,0,l,s)},o(e,a,r,t){x(t),S.fillRect(e-r/2,a-r/2,r,r)},m(e,a,r,t){x(t),S.beginPath(),S.moveTo(e,a-r/2),S.lineTo(e-r/2,a+r/2),S.lineTo(e+r/2,a+r/2),S.fill()},text(e,a,r,t,n=v,s=g,f=14){S.font=f+"px monospace",x(t),S.textAlign=n,S.textBaseline=s,S.fillText(r,e,a)},i(e,a,r,t){x(t),S.beginPath(),S.arc(e,a,r,0,i),S.fill()}},_=(e,a,r,t,n)=>{var s,f,o=a,m=r/2;15*(n.length-1)<=t&&(e+=r/4);for([s,f]of n)k.text(e,a,s+":","#aaa"),k.text(e+m-5,a,""+f,"#fff",R),o+t<(a+=15)&&(a=o,e+=m)},J=(e,a,r)=>{e=S.createRadialGradient(o,m,e,o,m,o);return e.addColorStop(0,a),e.addColorStop(1,r),e},r=document.createElement("canvas"),S=(r.width=l,r.height=s,r.getContext("2d")??(()=>{throw new Error})()),Q={l:"up",p:"down",u:v,h:R,w:"up",s:"down",a:v,d:R,g:"enter",escape:"pause",v:"pause"},D={R:!1,k:!1,left:!1,right:!1,g:!1,pause:!1,targetX:0,targetY:0},y={R:!1,k:!1,left:!1,right:!1,g:!1,pause:!1},Z=(e,a)=>{e=Q[e.key.toLowerCase()];e&&(D[e]=a,y[e]=a)};document[e]("keydown",e=>Z(e,!0)),document[e]("keyup",e=>Z(e,!1)),r[e]("mousemove",e=>{var a=r.getBoundingClientRect();D.targetX=e.clientX-a.left,D.targetY=e.clientY-a.top});var e=e=>{let r=e[0],t=[e[0]];return e.forEach((e,a)=>{r={...r,...e},t[a]=r}),t},a={S:"Saw Blades",D:e([{A:10,range:50,C:t/1.5,T:.1,P:1,size:10},{P:2},{A:15,C:t/1.25},{C:+t,size:15},{P:3},{A:20},{P:4}]),U(e,a){var r=a.A+T.I.A.B,t=i/a.P,n=e.U*a.C;for(let e=0;e<a.P;e++){var s,f=n+t*e,o=T.x+d(f)*a.range,m=T.y+p(f)*a.range;for(s of I)q(s.x,s.y,o,m)<a.size/2+s.type.size+2&&(s.N-=r,s.O=.1,s.L=20*d(f),s.$=20*p(f),U.M+=r)}},K(e,a){var r=i/a.P,t=e.U*a.C;for(let e=0;e<a.P;e++){var n=t+r*e,s=T.x+d(n)*a.range,n=T.y+p(n)*a.range;k.i(s,n,a.size/2,"#fff")}},W:(e,a)=>[["damage",b(a.A)],["range",b(a.range)],["speed",j(a.C)+"/s"],["blades",b(a.P)],["size",b(a.size)]]},A={S:"Sword",D:e([{A:8,angle:t/4,range:80,T:.5},{A:13},{angle:t/4*1.2,range:90},{A:18},{A:23},{A:28,angle:t/4*1.5},{A:33,angle:t/4*1.7,range:120}]),U(e,a){var r,t=a.A+T.I.A.B,n=a.angle/2,s=T.Y-n,f=T.Y+n;for(r of I){var o=r.x-T.x,m=r.y-T.y,i=W(m,o),o=u(o,m),m=W(r.type.size/2,o);s<i+m&&i-m<f&&o-r.type.size/2<a.range&&(r.N-=t,r.O=.1,r.L=25*d(i),r.$=25*p(i),U.M+=t)}},K(e,a){var r=a.T*T.I.G.B,e=.2*(e.H/r);0<e&&(r=a.angle/2,x(`rgba(255,255,255,${e})`),S.beginPath(),S.moveTo(T.x,T.y),S.lineTo(T.x+d(T.Y-r)*a.range,T.y+p(T.Y-r)*a.range),S.arc(T.x,T.y,a.range,T.Y-r,T.Y+r),S.lineTo(T.x,T.y),S.fill())},W:(e,a)=>[["damage",b(a.A)],["range",b(a.range)],["angle",j(a.angle)]]},e={S:"Barbed Wire",D:e([{range:40,A:2,T:.75},{range:60},{A:3},{range:70},{range:80},{A:4}]),U(e,a){var r,t=a.A+T.I.A.B;for(r of I)q(T.x,T.y,r.x,r.y)<a.range&&(r.N-=t,r.O=.1,U.M+=t)},K(e,a){var r=a.T*T.I.G.B,e=e.H/r,r=.15+.02*d(2*e*t);k.i(T.x,T.y,a.range,`rgba(255,0,0,${r})`)},W:(e,a)=>[["damage",b(a.A)],["range",b(a.range)]]};let ee=e=>({V:e,U:0,H:0,j:0});var E=e=>()=>T.j*e;let ae={q:[A],I:{N:[50,E(5)],F:[45,E(.2)],X:[.05,E(.025)],_:[50],A:[E(.3)],G:[1],J:[.01]}};E=o=>{let m;return{S:o.S,Z(){var e=m?.ee??T.q.find(e=>e.V===o);if(!e)return"New weapon";if(m?.level===e.j)return m.Z;var a,r,t=e.V.D[e.j],n=e.V.D[e.j+1],s=[];for(a in n)n[a]!==t[a]&&(r=n[a]-t[a],r=("angle"===a?j:b)(r),s.push(`+${r} `+a));var f=s.join(", ");return m={level:e.j,ee:e,Z:f},f},ae(){var e=T.q.find(e=>e.V===o);e?e.j++:T.q.push(ee(o))},re:o.D.length-1}};let re=[{S:"Speed boost",Z:"+25% speed",ae(){T.I.F.te.push(.25)},re:5},{S:"Speed base",Z:"+1 base speed",ae(){T.I.F.ne.push(1)},re:5},{S:"Max health",Z:"+25 max health, +5 health",ae:()=>{T.I.N.ne.push(25),T.N+=5},re:5},{S:"Health drop",Z:"+1% health drop chance",ae(){T.I.J.ne.push(.01)},re:5},{S:"Regen",Z:"+0.05/s health regen",ae:()=>T.I.X.ne.push(.05),re:5},{S:"Regen boost",Z:"+10% health regen",ae:()=>T.I.X.te.push(.1),re:5},{S:"Pickup range",Z:"+10 pickup range",ae:()=>T.I._.ne.push(10),re:5},{S:"Damage",Z:"+1 damage",ae:()=>T.I.A.ne.push(1),re:5},{S:"Attack speed",Z:"+5% attack speed",ae:()=>T.I.G.ne.push(-.05),re:5},E(a),E(A),E(e)],te=e=>"function"==typeof e?e():e,C=(e=[],a=[])=>({ne:[...e],te:[...a],se:null,get B(){var e;return this.se?.ne===this.ne&&this.se?.te===this.te&&this.se?.fe===T.j?this.se.value:(e=this.ne.reduce(e=(e,a)=>e+te(a),0)*this.te.reduce(e,1),this.se={ne:this.ne,te:this.te,fe:T.j,value:e},e)}}),ne=e=>({type:e,x:0,y:0,j:0,oe:0,me:5,N:te(e.I.F[0]),ie:0,de:0,le:0,Y:0,I:{F:C(e.I.F),N:C(e.I.N),X:C(e.I.X),_:C(e.I._),A:C(e.I.A),G:C(e.I.G),J:C(e.I.J)},ce:[],q:e.q.map(e=>ee(e))}),T=ne(ae),P={RUNNING:0,pe:1,ue:2,he:3,WIN:4,ge:5},se={ve:-1,runtime:0,M:0,Re:0,we:0,ce:[],be:0},U={state:P.ge,...se};var a=e=>({...e,H:1,size:10}),A=(e,s)=>(r,t,n)=>e.map((e,a)=>k.o(r+a,t+a,s,n??e)),E=(e,s)=>(r,t,n)=>e.map((e,a)=>k.m(r+a,t+a,s,n??e)),e=(e,s)=>(r,t,n)=>e.map((e,a)=>k.i(r+a,t+a,s,n??e)),fe=a({N:10,F:26,A:10,oe:1,K:A(["#aaa"],10)}),oe=a({N:50,F:26,A:15,oe:2,K:A(["#aaa","#faa"],10)}),z=a({N:100,F:30,A:20,oe:3,K:A(["#aaa","#faa","#4a4"],10)}),A=a({N:1e3,F:30,A:20,oe:100,size:20,K:A(["#faa"],20),xe:!0}),me=a({N:20,F:35,A:10,oe:2,K:E(["#999"],10)}),ie=a({N:40,F:35,A:20,oe:3,K:E(["#999","#0ac"],10)}),B=a({N:60,F:35,A:30,oe:4,K:E(["#999","#0ac","#966"],10)}),E=a({N:3e3,F:35,A:30,oe:200,xe:!0,ke:80,size:20,K:E(["#faa"],20)}),de=a({N:10,F:40,A:8,oe:3,K:e(["#999"],5)}),le=a({N:20,F:40,A:10,oe:4,K:e(["#999","#0ac"],5)}),ce=a({N:50,F:40,A:20,oe:5,K:e(["#999","#0ac","#4ca"],5)}),e=a({N:5e3,F:40,A:20,oe:300,xe:!0,ke:80,size:16,K:e(["#faa"],8)}),a=a({N:12e3,F:55,A:50,oe:0,xe:!0,ke:1e3,size:50,K(e,a,r){k.i(e,a,25,r??"#faa"),k.o(e,a,25,r??"#0ac"),k.m(e,a,23,r??"#faa")}});let pe=(r,e,t=1)=>Array.from({length:f((e-r)/t)}).map((e,a)=>a*t+r);var ue,he=r=>()=>{var e=pe(T.x-o,T.x+o,2*r.size),a=pe(T.y-m,T.y+m,2*r.size);e.map(e=>Re(e,T.y-m,r)),e.map(e=>Re(e,T.y+m,r)),a.map(e=>Re(T.x-o,e,r)),a.map(e=>Re(T.x+o,e,r))};let ge=[{Se:0,De:[fe],ye:.2},{Se:30,De:[fe,me],ye:.2},{Se:80,De:[fe,me],ye:.2},{Se:120,De:[me],ye:.2,xe:A},{Se:150,De:[me,de],ye:.2},{Se:180,De:[me,de],ye:.2},{Se:210,De:[oe],ye:.2,Ae:he(oe)},{Se:240,De:[oe,ie,de],ye:.2},{Se:270,De:[ie,de],xe:E,ye:.2},{Se:300,De:[ie,le,oe],ye:.2},{Se:330,De:[le,z],ye:.2,Ae:(ue=le,()=>{var e=i/40;pe(0,i,e).map(e=>{var a=T.x+d(e)*o,e=T.y+p(e)*m;Re(a,e,ue)})})},{Se:380,De:[z,B],ye:.2},{Se:400,De:[z,B],ye:.2},{Se:450,De:[z,B,ce],ye:.2},{Se:400,De:[z,B],xe:e,ye:.2},{Se:550,De:[z,B,ce],ye:.1,Ae:he(B)},{Se:600,De:[],ye:0,xe:a}],ve=(e,a,r)=>({x:e,y:a,type:r,N:r.N,H:0,L:0,$:0,O:0,xe:!!r.xe}),Re=(e,a,r)=>I.push(ve(e,a,r)),I=[],N=[],we=()=>{var e=50*f((T.x-o)/50),r=50*f((T.y-m)/50),t=50*$((T.x+o)/50),n=50*$((T.y+m)/50);for(let a=e;a<t;a+=50)for(let e=r;e<n;e+=50)k.rect(a,e,50,50,a%100==0?e%100==0?"#000":"#111":e%100==0?"#111":"#000")},be=()=>{for(var e of T.q)e.V.K(e,e.V.D[e.j]);k.rect(T.x-5,T.y-5,10,10,"#fff")},xe=()=>{for(var e of I){var a=e.type;a.K(e.x,e.y,0<e.O?"#fff":void 0),a.xe&&(k.rect(e.x-20,e.y+15,40,3,"#333"),k.rect(e.x-20,e.y+15,e.N/a.N*40,3,"#f33"))}},ke=()=>{for(var e of N)k.o(e.x-3,e.y-3,10<=(e.oe??0)?8:6,0<(e.N??0)?"#0c0":(e.oe??0)<10?"#05f":"#ff0")},Se=(e,a,r)=>{var t,n=[["Base damage",b(T.I.A.B)],["Attack speed",b(2-T.I.G.B,2)],["Health",f(T.I.N.B)],["Regeneration",b(T.I.X.B,2)+"/s"],["Speed",b(T.I.F.B,2)],["Health Drop",b(100*T.I.J.B)+"%"]];for(t of T.q){let r=t.V.S;n.push([r+" level",t.j+1],...t.V.W(t,t.V.D[t.j]).map(([e,a])=>[r+" "+e,a]))}_(e,a,r,s-a-40,n)},De=(e,a,r)=>{var t;for(t of[["Survived",V(U.runtime)],["Level",""+(T.j+1)],["Damage",b(U.M)],["DPS",""+b(U.M/U.runtime,2)],["Kills",""+U.Re]])k.text(e+r/2-5,a,t[0],"#ccc",R),k.text(e+r/2+5,a,t[1],"#fff",v),a+=15;return a},ye=()=>{if(k.rect(50,0,l-50,20,"#600"),k.rect(50,0,T.N/T.I.N.B*(l-50),20,"#f66"),k.text(52,10,f(T.N)+"/"+f(T.I.N.B),"#fff",v,w),k.rect(50,20,l-50,12,"#999"),k.rect(50,20,T.oe/T.me*(l-50),12,"#fff"),k.text(52,27,T.oe+"/"+T.me,"#000",v,w),k.rect(0,0,50,32,"#000"),k.text(25,2,"level","#666",n,g),k.text(25,18,""+(T.j+1),"#fff",n,g),k.text(o,35,V(U.runtime),"#fff",n),U.runtime<20){let e=s-30-15*L.length;for(var a of L)k.text(10,e,a,"#fff",v,g),e+=15}},Ae=()=>{switch(U.state!==P.ge&&ye(),U.state){case P.pe:k.t(),k.text(o,100,"YOU'RE DEAD!","#f88",n,g,24),e=De(50,145,l-100),e+=30,k.text(o,e,G,"#fff",n);break;case P.ue:k.t(),k.text(o,10,"LEVEL UP","#fff",n,g);for(let e=0;e<U.ce.length;e++){let a=U.ce[e];var r=T.ce.filter(e=>e===a).length,t=50+50*e;k.rect(20,t,l-40,40,e===U.be?"#333":"#222"),k.rect(20,t,l-40,40,e===U.be?"#aa3":"#444",!0),k.text(25,5+t,a.S,"#fff"),k.text(25,22+t,"function"==typeof a.Z?a.Z():a.Z,"#ccc"),k.text(20+l-50,20+t,r+"/"+a.re,"#ccc",R,w)}Se(20,210,l-40);break;case P.he:k.t(),k.text(o,40,"PAUSED","#fff",n,w),Se(20,80,l-40);break;case P.WIN:k.t(),k.text(o,100,"YOU WON","#fff",n,w);var e=De(100,130,l-200);e+=30,k.text(o,e,G,"#fff",n);break;case P.ge:k.t(),k.text(o,m-40,"MICRO","#fff",n,"bottom",68),k.text(o,m-40,"SURVIVORS","#fff",n,g,38),k.text(o,s-5,"by Kamen","#ccc",n,"bottom",10),S.globalAlpha=.5+.5*(.5*d(performance.now()/1e3*5)+.5),k.text(o,m+50,Y,"#fff",n),S.globalAlpha=1}},Ee=()=>{var e=K(1,T.de/.5),e=(0<e&&(e=J(80,"#ff000000",`rgba(255,0,0,${e})`),k.t(e)),K(1,T.le/.1));0<e&&(e=J(130,"#ffffff00",`rgba(255,255,255,${.15*e})`),k.t(e))},Ce=r=>{let t=0;var n,s=[];for(n of I){var f=n.type;if(n.N<=0)N.push({x:n.x,y:n.y,oe:f.oe}),c()<T.I.J.B&&N.push({x:n.x-5+10*c(),y:n.y-5+10*c(),N:2}),U.Re+=1,s.push(t);else{0<n.O&&(n.O-=r);let e=n.L*r,a=n.$*r;var o,m=T.x-n.x,i=T.y-n.y,d=u(m,i);!n.xe&&3*l<d?s.push(t):(n.H<=0?(d<n.type.size-2&&(T.N-=f.A,T.de=.5,n.H=f.H),o=f.F*r,e+=m/d*o,a+=i/d*o):n.H-=r,n.x+=e,n.y+=a,!(.1<h(n.L))||(m=(0<n.L?-1:1)*r*(f.ke??20),h(m)>h(n.L))?n.L=0:n.L+=m,!(.1<h(n.$))||(i=(0<n.$?-1:1)*r*(f.ke??20),h(i)>h(n.$))?n.$=0:n.$+=i)}t++}let a=0;for(let e of s)I.splice(e-a,1),a+=1},Te=e=>{var a=c()*i,r=Math.max(l,s)/2,r=u(r,r)+15*c();I.push(ve(T.x+d(a)*r,T.y+p(a)*r,e))},Pe=()=>{Object.assign(T,ne(ae)),Object.assign(U,se),U.state=P.RUNNING,I.length=0,N.length=0},Ue=e=>{switch(U.state){case P.RUNNING:U.runtime+=e,y.pause&&(U.state=P.he),T.N<=0&&(U.state=P.pe);var a=ge.findIndex(e=>e.Se>U.runtime)-1,r=ge[a<0?ge.length-1:a];if(-2==a&&0===I.length&&(U.state=P.WIN),r){for(a!==U.ve&&(U.ve=a,r.xe&&Te(r.xe),r.Ae?.());r.ye&&U.we>r.ye;)0<r.De.length&&Te(X(r.De)),U.we-=r.ye;U.we+=e}break;case P.WIN:case P.pe:case P.ge:D.g&&Pe();break;case P.ue:y.R&&0<U.be&&U.be--,y.k&&U.be<U.ce.length-1&&U.be++,y.g&&((a=U.ce[U.be]).ae(),T.ce.push(a),U.state=P.RUNNING);break;case P.he:(y.pause||y.g)&&(U.state=P.RUNNING)}},ze=()=>{for(var e in y)y[e]=!1},Be=e=>{let a=0,r=0;D.R&&--r,D.k&&(r+=1),D.left&&--a,D.right&&(a+=1);var t,n,s=T.I.F.B*e,f=u(a,r),f=(0<f&&(T.x+=a/f*s,T.y+=r/f*s),o),s=m;T.Y=W(D.targetY-s,D.targetX-f),T.oe>=T.me&&(T.j+=1,T.oe-=T.me,T.me+=10,s=re.filter(a=>!(a.condition&&!a.condition()||a.re&&T.ce.filter(e=>e===a).length>=a.re)),U.ce=F(s).slice(0,3),0<U.ce.length&&(U.state=P.ue),T.N+=5),0<T.de&&(T.de-=e),0<T.le&&(T.le-=e),T.N=K(T.I.N.B,T.N+T.I.X.B*e);for(t of T.q)t.U+=e,t.H<=0?(n=t.V.D[t.j],t.V.U(t,n),t.H=n.T*T.I.G.B):t.H-=e},Ie=e=>{let a=0;var r,t=[];for(r of N){var n,s=T.x-r.x,f=T.y-r.y,o=u(s,f);o<10?(T.N=K(T.I.N.B,T.N+(r.N??0)),T.oe+=r.oe??0,T.le=.1,t.push(a)):o<T.I._.B&&(n=(T.I._.B+10-o)*e*2,r.x+=s/o*n,r.y+=f/o*n),a++}let m=0;for(let e of t)N.splice(e-m,1),m+=1},Ne=0,Oe=e=>{requestAnimationFrame(Oe);var a=(e-Ne)/1e3;Ne=e,S.reset(),S.clearRect(0,0,l,s),S.translate(-T.x+o,-T.y+m),we(),ke(),be(),xe(),S.resetTransform(),Ee(),Ae(),e=a,Ue(e),U.state===P.RUNNING&&(Ce(e),Ie(e),Be(e)),ze()};return O.appendChild(r),requestAnimationFrame(Oe),[T,U]}