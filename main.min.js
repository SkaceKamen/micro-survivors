function microSurvivors(N=document.body,h=400,s=400){let U=["WASD to move","Mouse to aim","Survive","Kill end boss"],o=h/2,l=s/2,{floor:n,ceil:C,random:m,round:K,cos:i,sin:c,min:Y,hypot:g,abs:$,atan2:G,PI:t,max:j}=Math,v=2*t;var e="Press ENTER to ";let H=e+"restart",r="center",p="top",u="left",V="right",d="middle",f="#fff",X="#aaa",_="#ccc",R="#faa",q="#0ac",k="#999",F=(e,a=2,r="0")=>e.toString().padStart(a,r),z=e=>F(n(e/60))+":"+F(n(e%60)),J=e=>b(e*(180/t))+"Â°",b=(e,a=0)=>e?.toFixed(a)??"",Q=e=>b(e,2),Z=(e,a,r,t)=>g(r-e,t-a),ee=(e,a)=>{for(var r=[];e.length&&a--;){var t=(r=>{var e=r.map(e=>e.weight).reduce((e,a)=>e+a),t=m()*e;for(let e=0,a=0;;e++)if(a+=r[e].weight,t<=a)return e})(e);r.push(e[t].A),e.splice(t,1)}return r};let ae=e=>e[K(m()*(e.length-1))],w=e=>S.fillStyle=e,x={rect(e,a,r,t,s,n){S[n?"strokeStyle":"fillStyle"]=s,S[n?"strokeRect":"fillRect"](e,a,r,t)},t(e="#000000e5"){w(e),S.fillRect(0,0,h,s)},o(e,a,r,t){w(t),S.fillRect(e-r/2,a-r/2,r,r)},m(e,a,r,t){w(t),S.beginPath(),S.moveTo(e,a-r/2),S.lineTo(e-r/2,a+r/2),S.lineTo(e+r/2,a+r/2),S.fill()},text(e,a,r,t,s=u,n=p,d=14){S.font=d+"px monospace",w(t),S.textAlign=s,S.textBaseline=n,S.fillText(r,e,a)},i(e,a,r,t){w(t),S.beginPath(),S.arc(e,a,r,0,v),S.fill()},Se(e){S.globalAlpha=e}},re=(e,a,r,t,s,n=!0)=>{var d,o,l=a,p=n?r/2:r;n&&15*(s.length-1)<=t&&(e+=r/4);for([d,o]of s)(d||o)&&(x.text(e,a,d+":",X),x.text(e+p-5,a,""+o,f,V)),l+t<(a+=15)&&(a=l,e+=p)},te=(e,a,r)=>{e=S.createRadialGradient(o,l,e,o,l,o);return e.addColorStop(0,a),e.addColorStop(1,r),e},se=document.createElement("canvas"),S=(se.width=h,se.height=s,se.getContext`2d`),ne={arrowup:"up",arrowdown:"down",arrowleft:u,arrowright:V,w:"up",s:"down",a:u,d:V,enter:"enter",escape:"pause",p:"pause"},D={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1,targetX:0,targetY:0,touched:!1,touchX:0,touchY:0},A={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1},de=(e,a)=>{e=ne[e.key.toLowerCase()];e&&(D[e]=a,A[e]=a)};onkeydown=e=>de(e,!0),onkeyup=e=>de(e,!1),onmousemove=e=>{var a=se.getBoundingClientRect();D.targetX=e.clientX-a.left,D.targetY=e.clientY-a.top};var e=e=>{let r=e[0],t=[e[0]];return e.forEach((e,a)=>{r={...r,...e},t[a]=r}),t},a={l:"Orbs",q:"Orbiting orbs",u:e([{h:10,g:50,v:t/1.5,R:.1,Ee:1,S:10},{Ee:2},{h:15,v:t/1.25},{v:+t,S:15},{Ee:3},{h:20},{Ee:4}]),D(e,a){var r=a.h+L.C.h.A,t=a.S*L.C.g.A,s=e.D*(a.v*L.C.$.A),n=v/a.Ee;for(let e=0;e<a.Ee;e++){var d,o=s+n*e,l=L.x+i(o)*a.g,p=L.y+c(o)*a.g;for(d of B)Z(d.x,d.y,l,p)<t/2+d.type.S+2&&(d.T-=r,d.P=.1,d.U=20*i(o),d.B=20*c(o),W.I+=r)}},N(e,a){var r=v/a.Ee,t=e.D*(a.v*L.C.$.A),s=a.S*L.C.g.A;for(let e=0;e<a.Ee;e++){var n=t+r*e,d=L.x+i(n)*a.g,n=L.y+c(n)*a.g;x.i(d,n,s/2,f)}},O:(e,a,r)=>[["damage",P(a.h,r?.h)],["range",P(a.g,r?.g)],["speed",P(a.v,r?.v),e=>J(e)+"/s"],["count",P(a.Ee,r?.Ee)],["size",P(a.S,r?.S)]]};let P=(e,a)=>a?a-e:e;var y={l:"Sword",q:"melee weapon",u:e([{h:8,angle:t/4,g:80,R:.5},{h:13},{angle:t/4*1.2,g:90},{h:18},{h:23},{h:28,angle:t/4*1.5},{h:33,angle:t/4*1.7,g:120}]),D(e,a){var r,t=a.h+L.C.h.A,s=a.g*L.C.g.A,a=a.angle/2,n=L.L-a,d=L.L+a;for(r of B){var o=r.x-L.x,l=r.y-L.y,p=G(l,o),o=g(o,l),l=G(r.type.S/2,o);n<p+l&&p-l<d&&o-r.type.S/2<s&&(r.T-=t,r.P=.1,r.U=25*i(p),r.B=25*c(p),W.I+=t)}},N(e,a){var r=a.R*L.C.$.A,t=a.g*L.C.g.A,e=.2*(e.M/r);0<e&&(r=a.angle/2,w(`rgba(255,255,255,${e})`),S.beginPath(),S.moveTo(L.x,L.y),S.lineTo(L.x+i(L.L-r)*t,L.y+c(L.L-r)*t),S.arc(L.x,L.y,t,L.L-r,L.L+r),S.lineTo(L.x,L.y),S.fill())},O:(e,a,r)=>[["damage",P(a.h,r?.h)],["range",P(a.g,r?.g)],["angle",P(a.angle,r?.angle),J]]},e={l:"Barbed Wire",q:"area damage",u:e([{g:40,h:2,R:.75},{g:60},{h:3},{g:70},{g:80},{h:4}]),D(e,a){var r,t=a.h+L.C.h.A,s=a.g*L.C.g.A;for(r of B)Z(L.x,L.y,r.x,r.y)<s&&(r.T-=t,r.P=.1,W.I+=t)},N(e,a){var r=a.R*L.C.$.A,a=a.g*L.C.g.A,e=e.M/r,r=.15+.04*i(2*e*t);x.i(L.x,L.y,a,`rgba(255,0,0,${r})`)},O:(e,a,r)=>[["damage",P(a.h,r?.h)],["range",P(a.g,r?.g)]]};let oe=e=>({K:e,D:0,M:0,W:0}),le=e=>()=>L.W*e,pe=[{l:"Warrior",Y:[y],C:{T:50,G:45,H:.05,V:50,h:0,$:1,j:.01,De:1,g:1},ye:{G:.2,H:.025,h:.3},N:(e,a)=>x.o(e,a,10,f)},{l:"Monk",Y:[e],C:{T:50,G:60,H:.05,V:50,h:0,$:1,j:.01,De:0,g:1},ye:{H:.03,V:1,g:.025},N:(e,a)=>x.m(e,a,10,f)},{l:"Magic Man",Y:[a],C:{T:50,G:45,H:.05,V:50,h:0,$:1,j:.01,De:0,g:1},ye:{G:.2,$:-.026,H:.03,De:.25,g:.02},N:(e,a)=>x.i(e,a,5,f)}],ie=100;var E=t=>{let s;return{l:t.l,q(){var e,a,r=s?.F??L.Y.find(e=>e.K===t);return r?s?.W===r.W?s.q:(a=r.K.u[r.W],e=r.K.u[r.W+1],a=r.K.O(r,a,e).filter(e=>!!e[1]).map(([e,a,r=b])=>`+${r(a)} `+e).join(", "),s={W:r.W,F:r,q:a},a):t.q},X(){var e=L.Y.find(e=>e.K===t);e?e.W++:L.Y.push(oe(t))},Ae:()=>L.Y.some(e=>e.K===t)?ie:25,_:t.u.length-1}};let he=[{l:"Speed boost",q:"+5% speed",X(){L.C.G.J.push(.05)}},{l:"Speed base",q:"+1 base speed",X(){L.C.G.Z.push(1)}},{l:"Max health",q:"+25 max health, +5 health",X(){L.C.T.Z.push(25),L.T+=5}},{l:"Health drop",q:"+1% health drop chance",X:()=>{L.C.j.Z.push(.01)}},{l:"Regen",q:"+0.05/s health regen",X:()=>L.C.H.Z.push(.05)},{l:"Regen boost",q:"+10% health regen",X:()=>L.C.H.J.push(.1)},{l:"Pickup range",q:"+10 pickup range",X:()=>L.C.V.Z.push(10)},{l:"Damage",q:"+1 damage",X:()=>L.C.h.Z.push(1)},{l:"Attack speed",q:"+5% attack speed",X:()=>L.C.$.Z.push(-.05)},{l:"Armor",q:"+1 armor",X:()=>L.C.De.Z.push(1)},{l:"Area",q:"+10% area",X:()=>L.C.g.Z.push(.1)},E(a),E(y),E(e)],me=e=>"function"==typeof e?e():e,O=(e=[],a=[])=>({Z:[...e],J:[...a],ee:null,get A(){var e;return this.ee?.Z===this.Z&&this.ee?.J===this.J&&this.ee?.ae===L.W?this.ee.value:(e=this.Z.reduce(e=(e,a)=>e+me(a),0)*this.J.reduce(e,1),this.ee={Z:this.Z,J:this.J,ae:L.W,value:e},e)}}),T=(e,a)=>[e,...a?[le(a)]:[]],ce=e=>({K:e,x:0,y:0,W:0,re:0,te:5,T:e.C.T,se:0,ne:0,oe:0,L:0,C:{h:O(T(e.C.h,e.ye.h)),$:O(T(e.C.$,e.ye.$)),g:O(T(e.C.g,e.ye.g)),G:O(T(e.C.G,e.ye.G)),T:O(T(e.C.T,e.ye.T)),H:O(T(e.C.H,e.ye.H)),De:O(T(e.C.De,e.ye.De)),V:O(T(e.C.V,e.ye.V)),j:O(T(e.C.j,e.ye.j))},me:[],Y:e.Y.map(e=>oe(e))}),L=ce(pe[0]),I={Oe:0,de:1,ie:2,le:3,Le:4,pe:5,Pe:6},ge={ce:-1,Te:0,I:0,ue:0,he:0,me:[],Ie:0,Me:0},W={ge:I.pe,...ge},ve=e=>Object.assign(L,ce(e));var a=e=>({...e,M:1,S:10}),y=(e,n)=>(r,t,s)=>e.map((e,a)=>x.o(r+a,t+a,n,s??e)),E=(e,n)=>(r,t,s)=>e.map((e,a)=>x.m(r+a,t+a,n,s??e)),e=(e,n)=>(r,t,s)=>e.map((e,a)=>x.i(r+a,t+a,n,s??e)),ue=a({T:10,G:26,h:10,re:1,N:y([X],10)}),fe=a({T:50,G:26,h:20,re:2,N:y([X,R],10)}),Re=a({T:100,G:30,h:30,re:3,N:y([X,R,"#4a4"],10)}),y=a({T:1e3,G:30,h:30,re:100,S:20,N:y([R],20),ve:!0}),ke=a({T:20,G:35,h:10,re:2,N:E([k],10)}),be=a({T:40,G:35,h:20,re:3,N:E([k,q],10)}),we=a({T:60,G:35,h:40,re:4,N:E([k,q,"#966"],10)}),E=a({T:3e3,G:35,h:40,re:200,ve:!0,Re:80,S:20,N:E([R],20)}),xe=a({T:10,G:40,h:10,re:3,N:e([k],5)}),Se=a({T:20,G:40,h:20,re:4,N:e([k,q],5)}),De=a({T:50,G:40,h:40,re:5,N:e([k,q,"#4ca"],5)}),e=a({T:5e3,G:40,h:50,re:300,ve:!0,Re:80,S:16,N:e([R],8)}),a=a({T:8e3,G:60,h:100,re:0,ve:!0,Re:1e3,S:50,N(e,a,r){x.i(e,a,25,r??R),x.o(e,a,25,r??q),x.m(e,a,23,r??R)}});let Ae=(r,e,t=1)=>Array.from({length:n((e-r)/t)}).map((e,a)=>a*t+r);var Pe,ye=r=>()=>{var e=Ae(L.x-o,L.x+o,2*r.S),a=Ae(L.y-l,L.y+l,2*r.S);e.map(e=>Le(e,L.y-l,r)),e.map(e=>Le(e,L.y+l,r)),a.map(e=>Le(L.x-o,e,r)),a.map(e=>Le(L.x+o,e,r))};let Ee=[{be:[ue],xe:.2},{be:[ue,ke],xe:.2},{be:[ue,ke],xe:.2},{be:[ke],xe:.2,ve:y},{be:[ke,xe],xe:.2},{be:[ke,xe],xe:.2},{be:[fe],xe:.2,ke:ye(fe)},{be:[fe,be,xe],xe:.2},{be:[be,xe],ve:E,xe:.2},{be:[be,Se,fe],xe:.2},{be:[Se,Re],xe:.2,ke:(Pe=Se,()=>{var e=v/40;Ae(0,v,e).map(e=>{var a=L.x+i(e)*o,e=L.y+c(e)*l;Le(a,e,Pe)})})},{be:[Re,we],xe:.2},{be:[Re,we],xe:.2},{be:[Re,we,De],xe:.2},{be:[Re,we],ve:e,xe:.2},{be:[Re,we,De],xe:.1,ke:ye(we)},{be:[],xe:0,ve:a}],Oe=600,Te=Oe/(Ee.length-1),Le=(e,a,r)=>B.push({x:e,y:a,type:r,T:r.T,M:0,U:0,B:0,P:0,ve:!!r.ve}),B=[],Ie=[],M=50,We=2*M,Be=()=>{var e=n((L.x-o)/M)*M,r=n((L.y-l)/M)*M,t=C((L.x+o)/M)*M,s=C((L.y+l)/M)*M;for(let a=e;a<t;a+=M)for(let e=r;e<s;e+=M)x.rect(a,e,M,M,a%We==0?e%We==0?"#000":"#111":e%We==0?"#111":"#000")},Me=()=>{for(var e of L.Y)e.K.N(e,e.K.u[e.W]);L.K.N(L.x,L.y)},Ne=()=>{for(var e of B){var a=e.type;a.N(e.x,e.y,0<e.P?f:void 0),a.ve&&(x.rect(e.x-20,e.y+15,40,3,"#333"),x.rect(e.x-20,e.y+15,e.T/a.T*40,3,"#f33"))}},Ue=()=>{for(var e of Ie)x.o(e.x-3,e.y-3,10<=(e.re??0)?8:6,0<(e.T??0)?"#0c0":(e.re??0)<10?"#05f":"#ff0")},Ce={h:"Base damage",$:"Attack speed",g:"Area",T:"Health",H:"Regen",De:"Armor",G:"Speed",j:"Health Drop",V:"Pickup Distance"},Ke={$:e=>Q(2-e),T:n,g:Q,G:Q,H:e=>Q(e)+"/s",j:e=>b(100*e)+"%"},Ye=e=>e+"/level",$e=(e,a)=>{var r,t=Object.entries(e.C).map(([e,a])=>[Ce[e],(Ke[e]??b)(a.A)]),s=t.push.bind(t);a&&(s([]),s(...Object.entries(e.K.ye).map(([e,a])=>[Ce[e],Ye(b($(a),2))])),s([]));for(r of e.Y){let t=r.K.l;s([t+" level",r.W+1],...r.K.O(r,r.K.u[r.W]).map(([e,a,r=b])=>[t+" "+e,r(a)]))}return t},Ge=(e,a,r)=>{var t=$e(L);re(e,a,r,s-a-40,t)},je=(e,a,r)=>{var t;for(t of[["Survived",z(W.Te)],["Level",""+(L.W+1)],["Damage",b(W.I)],["DPS",""+b(W.I/W.Te,2)],["Kills",""+W.ue]])x.text(e+r/2-5,a,t[0],_,V),x.text(e+r/2+5,a,t[1],f,u),a+=15;return a},He=()=>{if(x.rect(50,0,h-50,20,"#600"),x.rect(50,0,L.T/L.C.T.A*(h-50),20,"#f66"),x.text(52,10,n(L.T)+"/"+n(L.C.T.A),f,u,d),x.rect(50,20,h-50,12,k),x.rect(50,20,L.re/L.te*(h-50),12,f),x.text(52,27,L.re+"/"+L.te,"#000",u,d),x.rect(0,0,50,32,"#000"),x.text(25,2,"level","#666",r,p),x.text(25,18,""+(L.W+1),f,r,p),x.text(o,35,z(W.Te),f,r),W.Te<20){let e=s-30-15*U.length;for(var a of U)x.text(10,e,a,f,u,p),e+=15}},Ve=(a,r,t,s,n,d)=>{for(let e=0;e<d.length;e++)x.rect(a,r,t,s,e===W.Ie?"#333":"#222"),x.rect(a,r,t,s,e===W.Ie?"#aa3":"#444",!0),n(a,r,d[e]),r+=s+5;return r},Xe={[I.de](){var e;x.t(),x.text(o,100,"YOU'RE DEAD!","#f88",r,p,24),e=je(50,145,h-100),e+=30,x.text(o,e,H,f,r)},[I.le](){x.t(),x.text(o,40,"PAUSED",f,r,d),Ge(20,80,h-40)},[I.Pe](){x.t(),x.text(o,10,"PICK CLASS",f,r,p),Ve(20,50,100,20,(e,a,r)=>{r.N(e+10,a+10),x.text(e+20,a+10,r.l,f,u,d)},pe);var e=$e(L,!0);re(140,30,h-140-20,s-60,e,!1)},[I.ie](){x.t(),x.text(o,10,"LEVEL UP",f,r,p),Ve(20,50,h-40,40,(e,a,r)=>{var t=L.me.filter(e=>e===r).length;x.text(e+5,a+5,r.l,f),x.text(e+5,a+22,me(r.q),_),x.text(e+h-50,a+20,t+"/"+(r._??5),_,V,d)},W.me),Ge(20,210,h-40)},[I.pe](){x.t(),x.text(o,l-40,"MICRO",f,r,"bottom",68),x.text(o,l-40,"SURVIVORS",f,r,p,38),x.text(o,s-5,"by Kamen",_,r,"bottom",10),x.Se(.75+.25*i(performance.now()/1e3*5)),x.text(o,l+50,"Press ENTER to start",f,r),x.Se(1)},[I.Le](){x.t(),x.text(o,100,"YOU WON",f,r,d);var e=je(100,130,h-200);e+=30,x.text(o,e,H,f,r)}},_e=()=>{W.ge!==I.pe&&W.ge!==I.Pe&&He(),Xe[W.ge]?.()},qe=()=>{var e=Y(1,L.ne/.5),e=(0<e&&(e=te(80,"#f000",`rgba(255,0,0,${e})`),x.t(e)),Y(1,L.oe/.1));0<e&&(e=te(130,"#fff0",`rgba(255,255,255,${.15*e})`),x.t(e))},Fe=r=>{let t=0;var s,n=[];for(s of B){var d=s.type;if(s.T<=0)Ie.push({x:s.x,y:s.y,re:d.re}),m()<L.C.j.A&&Ie.push({x:s.x-5+10*m(),y:s.y-5+10*m(),T:2}),W.ue+=1,n.push(t);else{0<s.P&&(s.P-=r);let e=s.U*r,a=s.B*r;var o,l=L.x-s.x,p=L.y-s.y,i=g(l,p);!s.ve&&3*h<i?n.push(t):(s.M<=0?(i<s.type.S-2&&(L.T-=j(0,d.h-L.C.De.A),L.ne=.5,s.M=d.M),o=d.G*r,e+=l/i*o,a+=p/i*o):s.M-=r,s.x+=e,s.y+=a,l=(0<s.U?-1:1)*r*(d.Re??20),$(l)>$(s.U)?s.U=0:s.U+=l,l=(0<s.B?-1:1)*r*(d.Re??20),$(l)>$(s.B)?s.B=0:s.B+=l)}t++}let a=0;for(let e of n)B.splice(e-a,1),a+=1},ze=e=>{var a=m()*v,r=j(h,s)/2,r=g(r,r)+15*m();Le(L.x+i(a)*r,L.y+c(a)*r,e)},Je=e=>{ve(e),Object.assign(W,ge),W.ge=I.Oe,B.length=0,Ie.length=0},Qe=()=>{A.up&&0<W.Ie&&W.Ie--,A.down&&W.Ie<W.Me&&W.Ie++},Ze=e=>{switch(W.ge){case I.Oe:W.Te+=e,A.pause&&(W.ge=I.le),L.T<=0&&(W.ge=I.de);var a=n(W.Te/Te),r=Ee[a];if(W.Te>Oe&&0===B.length&&(W.ge=I.Le),r){for(a!==W.ce&&(W.ce=a,r.ve&&ze(r.ve),r.ke?.());r.xe&&W.he>r.xe;)0<r.be.length&&ze(ae(r.be)),W.he-=r.xe;W.he+=e}break;case I.Le:case I.de:case I.pe:D.enter&&(W.Ie=0,W.Me=pe.length-1,ve(pe[0]),W.ge=I.Pe);break;case I.Pe:Qe();a=pe[W.Ie];L.K!==a&&ve(a),A.enter&&Je(pe[W.Ie]);break;case I.ie:Qe(),A.enter&&((a=W.me[W.Ie]).X(),L.me.push(a),W.ge=I.Oe);break;case I.le:(A.pause||A.enter)&&(W.ge=I.Oe)}},ea=()=>{for(var e in A)A[e]=!1},aa=e=>{let a=0,r=0;D.up&&--r,D.down&&(r+=1),D.left&&--a,D.right&&(a+=1);var t,s,n=L.C.G.A*e,d=g(a,r);0<d&&(L.x+=a/d*n,L.y+=r/d*n),L.L=G(D.targetY-o,D.targetX-l),L.re>=L.te&&(L.W+=1,L.re-=L.te,L.te+=10,d=he.filter(a=>!(a.cond&&!a.cond()||L.me.filter(e=>e===a).length>=(a._??5))).map(e=>({A:e,weight:e.Ae?.()??ie})),W.me=ee(d,3),0<W.me.length&&(W.ge=I.ie,W.Ie=0,W.Me=W.me.length-1),L.T+=5),0<L.ne&&(L.ne-=e),0<L.oe&&(L.oe-=e),L.T=Y(L.C.T.A,L.T+L.C.H.A*e);for(t of L.Y)t.D+=e,t.M<=0?(s=t.K.u[t.W],t.K.D(t,s),t.M=s.R*L.C.$.A):t.M-=e},ra=e=>{let a=0;var r,t=[];for(r of Ie){var s,n=L.x-r.x,d=L.y-r.y,o=g(n,d);o<10?(L.T=Y(L.C.T.A,L.T+(r.T??0)),L.re+=r.re??0,L.oe=.1,t.push(a)):o<L.C.V.A&&(s=(L.C.V.A+10-o)*e*2,r.x+=n/o*s,r.y+=d/o*s),a++}let l=0;for(let e of t)Ie.splice(e-l,1),l+=1},ta=0,sa=e=>{requestAnimationFrame(sa);var a=(e-ta)/1e3;ta=e,S.reset(),S.clearRect(0,0,h,s),S.translate(-L.x+o,-L.y+l),Be(),Ue(),Me(),Ne(),S.resetTransform(),qe(),_e(),e=a,Ze(e),W.ge===I.Oe&&(Fe(e),ra(e),aa(e)),ea()};return N.appendChild(se),requestAnimationFrame(sa),[L,W]}