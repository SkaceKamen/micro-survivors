function microSurvivors(y=document.body){let s=["WASD/Arrows to move","Mouse to aim","Survive","Kill end boss"];function n(e){var a=Math.floor(e/60),e=Math.floor(e%60);return a.toString().padStart(2,"0")+":"+e.toString().padStart(2,"0")}let p=e=>c(e*(180/Math.PI)),c=(e,a=0)=>e.toFixed(a),_=(e,a,t,r)=>Math.hypot(t-e,r-a),N=()=>Math.random();let j=e=>e[Math.round(N()*(e.length-1))],v={rect(e,a,t,r,s){b.fillStyle=s,b.fillRect(e,a,t,r)},t(e="rgba(0,0,0,0.9)"){b.fillStyle=e,b.fillRect(0,0,L,U)},i(e,a,t,r){b.fillStyle=r,b.fillRect(e-t/2,a-t/2,t,t)},o(e,a,t,r){b.fillStyle=r,b.beginPath(),b.moveTo(e,a-t/2),b.lineTo(e-t/2,a+t/2),b.lineTo(e+t/2,a+t/2),b.fill()},text(e,a,t,r,s="left",n="top",i=14){b.font=i+"px monospace",b.fillStyle=r,b.textAlign=s,b.textBaseline=n,b.fillText(t,e,a)},h(e,a,t,r){b.fillStyle=r,b.beginPath(),b.arc(e,a,t,0,2*Math.PI),b.fill()}},w=(e,a,t,r,s)=>{var n,i,o=a,h=t/2;15*s.length<r&&(e+=t/4);for([n,i]of s)v.text(e,a,n+":","#aaa"),v.text(e+h-5,a,""+i,"#fff","right"),o+r<(a+=15)&&(a=o,e+=h)},M=(e,a,t)=>{e=b.createRadialGradient(L/2,U/2,e,L/2,U/2,L/2);return e.addColorStop(0,a),e.addColorStop(1,t),e},L=400,U=400,k=document.createElement("canvas"),b=(k.width=L,k.height=U,k.getContext("2d")??(()=>{throw new Error})()),x={arrowup:"up",arrowdown:"down",arrowleft:"left",arrowright:"right",w:"up",s:"down",a:"left",d:"right",enter:"enter",escape:"pause",p:"pause"},I={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1,targetX:0,targetY:0},H={up:!1,down:!1,left:!1,right:!1,enter:!1,pause:!1},a=(e,a)=>{e=x[e.key.toLowerCase()];e&&(I[e]=a,H[e]=a)};var e="addEventListener";document[e]("keydown",e=>a(e,!0)),document[e]("keyup",e=>a(e,!1)),k[e]("mousemove",e=>{var a=k.getBoundingClientRect();I.targetX=e.clientX-a.left,I.targetY=e.clientY-a.top});let W={l:0,m:1,g:2};var e=a=>{let t=a[0];var r=[a[0]];for(let e=1;e<a.length;e++)t={...t,...a[e]},r[e]=t;return r},t={name:"Saw Blades",type:W.l,u:e([{damage:5,range:50,rotationSpeed:Math.PI/2,v:.1,blades:1,size:10},{blades:2},{damage:10,rotationSpeed:Math.PI/1.5},{rotationSpeed:Math.PI/1.25,size:15},{blades:3},{damage:15},{blades:4}])},r={name:"Sword",type:W.m,u:e([{damage:8,angle:Math.PI/4,range:80,M:.5},{damage:13},{angle:Math.PI/4*1.2,range:90},{damage:18},{damage:23},{damage:28,angle:Math.PI/4*1.5},{damage:33,angle:Math.PI/4*1.7,range:120}])},e={name:"Barbed Wire",type:W.g,u:e([{range:40,damage:2,M:.75},{range:60},{damage:3},{range:70},{range:80},{damage:4}])};let i=e=>({type:e,k:0,R:0,level:0});var o=t=>(e,a)=>a+e.level*t,h=e=>()=>e;let $={S:[r],T:{health:[h(100),o(10)],speed:[h(45),o(.2)],healthRegen:[h(.1),o(.01)],pickupDistance:[h(50)],damage:[o(.3)],attackSpeed:[h(1)],healthDrop:[h(.01)]}};var o=(a,t)=>e=>e.T[a].push("base",(e,a)=>a+t),h=(a,t)=>e=>e.T[a].push("multiplier",(e,a)=>a*t),f=(o,e)=>{let h;return{name:e,description:()=>{var e=h?.D??O.S.find(e=>e.type===o);if(!e)return"New weapon";if(h?.level===e.level)return h.A;var a,t,r=e.type.u[e.level],s=e.type.u[e.level+1],n=[];for(a in s)s[a]!==r[a]&&(t=s[a]-r[a],t="angle"===a?p(t)+"°":c(t),n.push(`+${t} `+a));var i=n.join(", ");return h={level:e.level,D:e,A:i},i},weight:1,apply:e=>{var a=e.S.find(e=>e.type===o);a?a.level++:e.S.push(i(o))},C:o.u.length}};let J=[{name:"Speed boost",description:"+25% speed",weight:1,apply:h("speed",1.25),C:5},{name:"Speed base",description:"+1 base speed",weight:1,apply:o("speed",1),C:5},{name:"Heal",description:"+25 health",weight:1,P:e=>e.health+25<e.T.health.value,apply:e=>e.health+=25,C:5},{name:"Max health",description:"+25 max health, +5 health",weight:1,apply:e=>{e.T.health.push("base",(e,a)=>a+25),e.health+=5},C:5},{name:"Health drop",description:"+1% health drop chance",weight:1,apply:o("healthDrop",.01),C:5},{name:"Regen",description:"+0.1/s health regen",weight:1,apply:o("healthRegen",.1),C:5},{name:"Regen boost",description:"+5% health regen",weight:1,apply:h("healthRegen",1.05),C:5},{name:"Pickup range",description:"+10 pickup range",weight:1,apply:o("pickupDistance",10),C:5},{name:"Damage",description:"+1 damage",weight:1,apply:o("damage",1),C:5},{name:"Attack speed",description:"+5% attack speed",weight:1,apply:o("attackSpeed",-.05),C:5},f(t,"Saw Blades"),f(r,"Sword"),f(e,"Barbed Wire")],l=(e=[],a=[])=>({push(e,a){this[e]=[...this[e],a]},base:[...e],multiplier:[...a],B:null,get value(){var e;return this.B?.base===this.base&&this.B?.multiplier===this.multiplier&&this.B?.N===O.level?this.B.value:(e=this.base.reduce((e,a)=>a(O,e),0)*this.multiplier.reduce((e,a)=>a(O,e),1),this.B={base:this.base,multiplier:this.multiplier,N:O.level,value:e},e)}}),Q=e=>({type:e,x:0,y:0,level:0,L:0,U:5,health:100,I:0,H:0,W:0,$:0,T:{speed:l(e.T.speed),health:l(e.T.health),healthRegen:l(e.T.healthRegen),pickupDistance:l(e.T.pickupDistance),damage:l(e.T.damage),attackSpeed:l(e.T.attackSpeed),healthDrop:l(e.T.healthDrop)},O:[],S:e.S.map(e=>i(e))}),O=Q($),K={RUNNING:0,K:1,Y:2,G:3,WIN:4,V:5},Y={X:-1,runtime:0,q:0,F:0,_:0,O:[],j:0},G={state:K.V,...Y};let d=(e,n)=>(t,r,s)=>{e.forEach((e,a)=>{v.i(t+a,r+a,n,s??e)})};var h=(e,n)=>(t,r,s)=>{e.forEach((e,a)=>{v.o(t+a,r+a,n,s??e)})},o=(e,n)=>(t,r,s)=>{e.forEach((e,a)=>{v.h(t+a,r+a,n,s??e)})},t={health:10,speed:26,damage:1,R:1,L:1,size:10,J:d(["#aaa"],10)},r={health:50,speed:26,damage:1,R:1,L:2,size:10,J:d(["#aaa","#faa"],10)},f={health:100,speed:30,damage:2,R:1,L:3,size:10,J:d(["#aaa","#faa","#4a4"],10)},e={health:20,speed:35,damage:2,R:1,L:2,size:10,J:h(["#999"],10)},m={health:40,speed:35,damage:2,R:1,L:3,size:10,J:h(["#999","#0ac"],10)},g={health:60,speed:35,damage:3,R:1,L:4,size:10,J:h(["#999","#0ac","#966"],10)},u={health:10,speed:40,damage:1,R:1,L:3,size:10,J:o(["#999"],5)},E={health:20,speed:40,damage:1,R:1,L:4,size:10,J:o(["#999","#0ac"],5)},R={health:50,speed:40,damage:1,R:1,L:5,size:10,J:o(["#999","#0ac","#4ca"],5)};let V=[{from:0,types:[t],rate:.4},{from:30,types:[t,e],rate:.4},{from:80,types:[t,e],rate:.1},{from:120,types:[e],rate:.2,Z:{health:500,speed:30,damage:10,R:1,L:20,size:20,J:(e,a,t)=>d(["#faa"],20),Z:!0}},{from:150,types:[e,u],rate:.3},{from:200,types:[e,u],rate:.15},{from:250,types:[r],rate:.2},{from:300,types:[r,m,u],rate:.2},{from:330,types:[m,u],Z:{health:1e3,speed:35,damage:10,R:1,L:50,Z:!0,ee:80,size:20,J:h(["#faa"],20)},rate:.2},{from:380,types:[m,E,r],rate:.15},{from:450,types:[E,f],rate:.15},{from:500,types:[f,g],rate:.1},{from:550,types:[f,g],rate:.1},{from:600,types:[f,g,R],rate:.1},{from:650,types:[f,g],Z:{health:1e3,speed:40,damage:5,R:1,L:4,Z:!0,ee:80,size:16,J:o(["#faa"],8)},rate:.15},{from:700,types:[f,g,R],rate:.1},{from:720,types:[],rate:0,Z:{health:1e4,speed:55,damage:5,R:1,L:0,Z:!0,ee:1e3,size:50,J:(e,a,t)=>{v.h(e,a,25,t??"#faa"),v.i(e,a,25,t??"#0ac"),v.o(e,a,23,t??"#faa")}}}],S=(e,a,t)=>({x:e,y:a,type:t,health:t.health,R:0,ae:0,te:0,re:0,Z:!!t.Z}),X=[],q={se:0,ne:1},F=[];function T(e,a,t){var r,s=[["Base damage",c(O.T.damage.value)],["Attack speed",c(O.T.attackSpeed.value,2)],["Health",Math.floor(O.T.health.value)],["Regeneration",c(O.T.healthRegen.value,2)+"/s"],["Speed",c(O.T.speed.value,2)],["Health Drop",c(100*O.T.healthDrop.value)+"%"]];for(r of O.S){var n=r.type.name;switch(r.type.type){case W.m:var i=r.type.u[r.level];s.push([n+" level",r.level+1]),s.push([n+" damage",c(i.damage)]),s.push([n+" range",c(i.range)]),s.push([n+" angle",p(i.angle)+"°"]);break;case W.l:i=r.type.u[r.level];s.push([n+" level",r.level+1]),s.push([n+" damage",c(i.damage)]),s.push([n+" range",c(i.range)]),s.push([n+" blades",c(i.blades)]),s.push([n+" size",c(i.size)]);break;case W.g:var o=r.type.u[r.level];s.push([n+" level",r.level+1]),s.push([n+" damage",c(o.damage)]),s.push([n+" range",c(o.range)])}}w(e,a,t,U-a-20,s)}function D(e,a,t){var r;for(r of[["Survived for",n(G.runtime)],["Level",""+(O.level+1)],["Damage done",c(G.q)],["DPS",""+c(G.q/G.runtime,2)],["Kills",""+G.F]])v.text(e+t/2-5,a,r[0],"#ccc","right"),v.text(e+t/2+5,a,r[1],"#fff","left"),a+=15;return a}function A(){if(G.state!==K.V&&(v.rect(50,0,L-50,20,"#600"),v.rect(50,0,O.health/O.T.health.value*(L-50),20,"#f66"),v.text(52,10,Math.floor(O.health)+" / "+Math.floor(O.T.health.value),"#fff","left","middle"),v.rect(50,20,L-50,12,"#999"),v.rect(50,20,O.L/O.U*(L-50),12,"#fff"),v.text(52,27,O.L+" / "+O.U,"#000","left","middle"),v.rect(0,0,50,32,"#000"),v.text(25,2,"level","#666","center","top"),v.text(25,18,""+(O.level+1),"#fff","center","top"),v.text(L/2,35,n(G.runtime),"#fff","center"),G.runtime<20)){let e=U-30-15*s.length;for(var a of s)v.text(10,e,a,"#fff","left","top"),e+=15}switch(G.state){case K.K:v.t(),v.text(L/2,100,"YOU'RE DEAD!","#f88","center","top",24),e=D(50,145,L-100),e+=30,v.text(L/2,e,"Press ENTER to restart","#fff","center");break;case K.Y:v.t(),v.text(L/2,10,"LEVEL UP","#fff","center","top");for(let e=0;e<G.O.length;e++){let a=G.O[e];var t=O.O.filter(e=>e===a).length,r=50+50*e;b.textAlign="left",b.textBaseline="top",b.fillStyle=e===G.j?"#333":"#222",b.fillRect(20,r,L-40,40),b.strokeStyle=e===G.j?"#aa3":"#444",b.strokeRect(20,r,L-40,40),b.fillStyle="#fff",b.fillText(a.name,25,5+r),b.fillStyle="#ccc",b.fillText("function"==typeof a.description?a.description():a.description,25,22+r),v.text(20+L-50,20+r,t+"/"+a.C,"#ccc","right","middle")}T(20,210,L-40);break;case K.G:v.t(),v.text(L/2,100,"PAUSED","#fff","center","middle"),T(20,110,L-40);break;case K.WIN:v.t(),v.text(L/2,100,"YOU WON","#fff","center","middle");var e=D(100,130,L-200);e+=30,v.text(L/2,e,"Press ENTER to restart","#fff","center");break;case K.V:v.t(),v.text(L/2,U/2-40,"MICRO","#fff","center","bottom",68),v.text(L/2,U/2-40,"SURVIVORS","#fff","center","top",38),v.text(L/2,U-5,"by Kamen","#ccc","center","bottom",10),b.globalAlpha=.5+.5*(.5*Math.cos(performance.now()/1e3*5)+.5),v.text(L/2,U/2+50,"Press ENTER to start","#fff","center"),b.globalAlpha=1}}function z(){b.reset(),b.clearRect(0,0,k.width,k.height),b.translate(-O.x+L/2,-O.y+U/2);var e,a,t,r=50*Math.floor((O.x-L/2)/50),s=50*Math.floor((O.y-U/2)/50),n=50*Math.ceil((O.x+L/2)/50),i=50*Math.ceil((O.y+U/2)/50);for(let a=r;a<n;a+=50)for(let e=s;e<i;e+=50)v.rect(a,e,50,50,a%100==0?e%100==0?"#000":"#111":e%100==0?"#111":"#000");for(e of F)v.i(e.x-3,e.y-3,10<=(e.L??0)?8:6,0<(e.health??0)?"#0c0":(e.L??0)<10?"#05f":"#ff0");for(a of O.S)switch(a.type.type){case W.l:var o=a.type.u[a.level],h=2*Math.PI/o.blades,p=a.k*o.rotationSpeed;for(let e=0;e<o.blades;e++){var c=p+h*e,f=O.x+Math.cos(c)*o.range,c=O.y+Math.sin(c)*o.range;v.h(f,c,o.size/2,"#fff")}break;case W.m:var l=a.type.u[a.level],d=l.M*O.T.attackSpeed.value,d=.2*(a.R/d);0<d&&(m=l.angle/2,b.fillStyle=`rgba(255,255,255,${d})`,b.beginPath(),b.moveTo(O.x,O.y),b.lineTo(O.x+Math.cos(O.$-m)*l.range,O.y+Math.sin(O.$-m)*l.range),b.arc(O.x,O.y,l.range,O.$-m,O.$+m),b.lineTo(O.x,O.y),b.fill());break;case W.g:var d=a.type.u[a.level],l=d.M*O.T.attackSpeed.value,m=a.R/l,g=.15+.02*Math.cos(2*m*Math.PI);v.h(O.x,O.y,d.range,`rgba(255,0,0,${g})`)}v.rect(O.x-5,O.y-5,10,10,"#fff");for(t of X){var u=t.type;u.J(t.x,t.y,0<t.re?"#fff":void 0),u.Z&&(v.rect(t.x-20,t.y+15,40,3,"#333"),v.rect(t.x-20,t.y+15,t.health/u.health*40,3,"#f33"))}b.resetTransform(),0<(r=Math.min(1,O.H/.5))&&(r=M(80,"rgba(255,0,0,0)",`rgba(255,0,0,${r})`),v.t(r)),0<(r=Math.min(1,O.W/.1))&&(r=M(130,"rgba(255,255,255,0)",`rgba(255,255,255,${.15*r})`),v.t(r)),A()}function C(s){var e,a,t,r=s;switch(G.state){case K.RUNNING:(G.runtime+=r,H.pause)?G.state=K.G:O.health<=0?G.state=K.K:(a=V.findIndex(e=>e.from>G.runtime)-1,e=V[a<0?V.length-1:a],-2==a&&0===X.length&&(G.state=K.WIN),e&&(a!==G.X&&(G.X=a,e.Z)&&Z(e.Z),G._>e.rate?(0<e.types.length&&Z(j(e.types)),G._=0):G._+=r));break;case K.WIN:case K.K:case K.V:I.enter&&(()=>{for(var e in O=Q($),Y)G[e]=Y[e];G.state=K.RUNNING,X.length=0,F.length=0})();break;case K.Y:H.up&&0<G.j&&G.j--,H.down&&G.j<G.O.length-1&&G.j++,H.enter&&((a=G.O[G.j]).apply(O),O.O.push(a),G.state=K.RUNNING);break;case K.G:(H.pause||H.enter)&&(G.state=K.RUNNING)}if(G.state===K.RUNNING){{var n,i=s;let t=0,r=[];for(n of X){var o=n.type;if(n.health<=0)F.push({x:n.x,y:n.y,type:q.ne,L:o.L}),N()<O.T.healthDrop.value&&F.push({x:n.x-5+10*N(),y:n.y-5+10*N(),type:q.se,health:10}),G.F+=1,r.push(t);else{0<n.re&&(n.re-=i);let e=n.ae*i,a=n.te*i;var h,p=O.x-n.x,c=O.y-n.y,f=Math.sqrt(p*p+c*c);!n.Z&&f>3*L?r.push(t):(n.R<=0?(f<n.type.size-2&&(O.health-=o.health,O.H=.5,n.R=o.R),h=o.speed*i,e+=p/f*h,a+=c/f*h):n.R-=i,n.x+=e,n.y+=a,!(.1<Math.abs(n.ae))||(p=(0<n.ae?-1:1)*i*(o.ee??20),Math.abs(p)>Math.abs(n.ae))?n.ae=0:n.ae+=p,!(.1<Math.abs(n.te))||(c=(0<n.te?-1:1)*i*(o.ee??20),Math.abs(c)>Math.abs(n.te))?n.te=0:n.te+=c)}t++}let a=0;for(let e of r)X.splice(e-a,1),a+=1}{var l,d=s;let e=0,a=[];for(l of F){var m,g=O.x-l.x,u=O.y-l.y,v=Math.sqrt(g*g+u*u);if(v<10){switch(l.type){case q.se:O.health=Math.min(O.T.health.value,O.health+(l.health??0));break;case q.ne:O.L+=l.L??0}O.W=.1,a.push(e)}else v<O.T.pickupDistance.value&&(m=(O.T.pickupDistance.value+10-v)*d*2,l.x+=g/v*m,l.y+=u/v*m);e++}let t=0;for(let e of a)F.splice(e-t,1),t+=1}{var M=s;let e=0,a=0;I.up&&--a,I.down&&(a+=1),I.left&&--e,I.right&&(e+=1);var k,s=O.T.speed.value*M,b=Math.sqrt(e*e+a*a);0<b&&(O.x+=e/b*s,O.y+=a/b*s),b=L/2,s=U/2,O.$=Math.atan2(I.targetY-s,I.targetX-b),O.L>=O.U&&(O.level+=1,O.L-=O.U,O.U+=10,s=J.filter(a=>!(a.P&&!a.P(O)||a.C&&O.O.filter(e=>e===a).length>=a.C)),G.O=(a=>{for(let e=a.length-1;0<=e;e--){var t=Math.floor(N()*(e+1));[a[e],a[t]]=[a[t],a[e]]}return a})(s).slice(0,3),0<G.O.length&&(G.state=K.Y),O.health+=5),0<O.H&&(O.H-=M),0<O.W&&(O.W-=M),O.health=Math.min(O.T.health.value,O.health+O.T.healthRegen.value*M);for(k of O.S)switch(k.k+=M,k.type.type){case W.l:var y=k.type.u[k.level],w=y.damage+O.T.damage.value;if(k.R<=0){k.R=y.v*O.T.attackSpeed.value;var x=2*Math.PI/y.blades,E=k.k*y.rotationSpeed;for(let e=0;e<y.blades;e++){var R,S=E+x*e,T=O.x+Math.cos(S)*y.range,D=O.y+Math.sin(S)*y.range;for(R of X)_(R.x,R.y,T,D)<y.size/2+R.type.size+2&&(R.health-=w,R.re=.1,R.ae=20*Math.cos(S),R.te=20*Math.sin(S),G.q+=w)}}else k.R-=M;break;case W.m:0<k.R?k.R-=M:(((e,a)=>{var t,r=a.u[e.level],s=r.damage+O.T.damage.value,a=r.angle/2,n=O.$-a,i=O.$+a;for(t of X){var o=t.x-O.x,h=t.y-O.y,p=Math.atan2(h,o),o=Math.sqrt(o*o+h*h),h=Math.atan2(t.type.size/2,o);n<p+h&&p-h<i&&o-t.type.size/2<r.range&&(t.health-=s,t.re=.1,t.ae=25*Math.cos(p),t.te=25*Math.sin(p),G.q+=s)}})(k,k.type),k.R=k.type.u[k.level].M*O.T.attackSpeed.value);break;case W.g:if(0<k.R)k.R-=M;else{var A,z=k.type.u[k.level],C=z.damage+O.T.damage.value;for(A of X){var P=A.x-O.x,B=A.y-O.y;let e=Math.sqrt(P*P+B*B);e<z.range&&(A.health-=C,A.re=.1,G.q+=C)}k.R=k.type.u[k.level].M*O.T.attackSpeed.value}}}}for(t in H)H[t]=!1}function Z(e){var a=N()*Math.PI*2,t=Math.max(L,U)/2,t=Math.sqrt(t*t*2)+15*N();X.push(S(O.x+Math.cos(a)*t,O.y+Math.sin(a)*t,e))}let P=0;return y.appendChild(k),requestAnimationFrame(function e(a){requestAnimationFrame(e);var t=(a-P)/1e3;P=a,z(),C(t)}),[O,G]}